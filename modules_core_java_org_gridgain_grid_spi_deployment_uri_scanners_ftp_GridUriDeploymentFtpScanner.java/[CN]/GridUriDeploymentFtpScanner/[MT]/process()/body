{
  Collection<GridUriDeploymentFtpFile> foundFiles=new HashSet<>(cache.size());
  long start=U.currentTimeMillis();
  processFtp(foundFiles);
  if (getLogger().isDebugEnabled())   getLogger().debug("FTP scanner time in milliseconds: " + (U.currentTimeMillis() - start));
  if (!isFirstScan()) {
    Collection<GridUriDeploymentFtpFile> delFiles=new HashSet<>(cache.keySet());
    delFiles.removeAll(foundFiles);
    if (!delFiles.isEmpty()) {
      List<String> uris=new ArrayList<>();
      for (      GridUriDeploymentFtpFile file : delFiles) {
        Long tstamp=cache.get(file);
        if (tstamp != null && tstamp != UNKNOWN_FILE_TSTAMP)         uris.add(getFileUri(file.getName()));
      }
      cache.keySet().removeAll(delFiles);
      getListener().onDeletedFiles(uris);
    }
  }
}
