{
  if (writer.tryWriteAsHandle(obj))   return false;
  if (registered) {
    PortableUtils.writeHeader(writer,typeId,obj instanceof CacheObjectImpl ? 0 : obj.hashCode(),null);
  }
 else {
    PortableUtils.writeHeader(writer,GridPortableMarshaller.UNREGISTERED_TYPE_ID,obj instanceof CacheObjectImpl ? 0 : obj.hashCode(),cls.getName());
  }
  return true;
}
