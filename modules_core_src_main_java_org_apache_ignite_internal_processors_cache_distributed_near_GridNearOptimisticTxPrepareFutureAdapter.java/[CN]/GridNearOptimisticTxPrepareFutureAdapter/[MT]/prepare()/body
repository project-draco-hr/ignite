{
  long threadId=Thread.currentThread().getId();
  AffinityTopologyVersion topVer=cctx.mvcc().lastExplicitLockTopologyVersion(threadId);
  if (topVer == null && tx != null && tx.system()) {
    IgniteInternalTx tx0=cctx.tm().anyActiveThreadTx(threadId,tx);
    if (tx0 != null)     topVer=tx0.topologyVersionSnapshot();
  }
  if (topVer != null) {
    tx.topologyVersion(topVer);
    cctx.mvcc().addFuture(this);
    prepare0(false,true);
    return;
  }
  prepareOnTopology(false,null);
}
