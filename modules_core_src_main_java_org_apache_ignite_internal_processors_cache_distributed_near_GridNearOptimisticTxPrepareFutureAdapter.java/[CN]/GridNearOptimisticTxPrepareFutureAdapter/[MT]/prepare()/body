{
  long threadId=Thread.currentThread().getId();
  AffinityTopologyVersion topVer=null;
  if (tx.system())   topVer=tx.topologyVersionSnapshot();
  if (topVer == null)   topVer=cctx.mvcc().lastExplicitLockTopologyVersion(threadId);
  if (topVer == null && tx.system())   topVer=cctx.tm().lockedTopologyVersion(threadId,tx);
  if (topVer != null) {
    tx.topologyVersion(topVer);
    cctx.mvcc().addFuture(this);
    prepare0(false,true);
    return;
  }
  prepareOnTopology(false,null);
}
