{
  if (ses.isWithinTransaction()) {
    TransactionStatus tx=ses.<String,TransactionStatus>properties().remove(TX_STATUS_KEY);
    if (tx != null) {
      try {
        if (commit)         txMgr.commit(tx);
 else         txMgr.rollback(tx);
      }
 catch (      TransactionException e) {
        throw new CacheWriterException("Failed to end store session [tx=" + ses.transaction() + ']',e);
      }
    }
  }
}
