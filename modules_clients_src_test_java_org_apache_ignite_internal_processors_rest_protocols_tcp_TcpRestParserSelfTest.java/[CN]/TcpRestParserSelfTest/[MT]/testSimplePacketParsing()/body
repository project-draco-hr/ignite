{
  GridNioSession ses=new MockNioSession();
  GridTcpRestParser parser=new GridTcpRestParser(false);
  byte hdr=MEMCACHE_REQ_FLAG;
  byte[] opCodes={0x01,0x02,0x03};
  byte[] opaque=new byte[]{0x01,0x02,0x03,(byte)0xFF};
  String key="key";
  String val="value";
  for (  byte opCode : opCodes) {
    ByteBuffer raw=rawPacket(hdr,opCode,opaque,key.getBytes(),val.getBytes(),EXTRAS);
    GridClientMessage msg=parser.decode(ses,raw);
    assertTrue(msg instanceof GridMemcachedMessage);
    GridMemcachedMessage packet=(GridMemcachedMessage)msg;
    assertEquals("Parser leaved unparsed bytes",0,raw.remaining());
    assertEquals("Invalid opcode",opCode,packet.operationCode());
    assertEquals("Invalid key",key,packet.key());
    assertEquals("Invalid value",val,packet.value());
  }
}
