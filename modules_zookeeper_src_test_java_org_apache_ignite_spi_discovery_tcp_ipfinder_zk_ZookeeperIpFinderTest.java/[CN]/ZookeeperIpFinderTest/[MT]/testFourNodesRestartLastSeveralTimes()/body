{
  setAllowDuplicateRegistrations(false);
  System.setProperty(TcpDiscoveryZookeeperIpFinder.PROP_ZK_CONNECTION_STRING,zkCluster.getConnectString());
  startGrids(4);
  waitForRemoteNodes(grid(0),3);
  assertEquals(4,zkCurator.getChildren().forPath(SERVICES_IGNITE_ZK_PATH).size());
  for (int i=0; i < 5; i++) {
    stopGrid(2);
    assertEquals(3,zkCurator.getChildren().forPath(SERVICES_IGNITE_ZK_PATH).size());
    startGrid(2);
    assertEquals(4,zkCurator.getChildren().forPath(SERVICES_IGNITE_ZK_PATH).size());
  }
  stopAllGrids();
  assertEquals(0,zkCurator.getChildren().forPath(SERVICES_IGNITE_ZK_PATH).size());
}
