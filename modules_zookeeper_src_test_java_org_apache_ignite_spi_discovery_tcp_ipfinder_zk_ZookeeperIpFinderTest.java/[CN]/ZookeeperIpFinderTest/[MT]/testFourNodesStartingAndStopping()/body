{
  startGrid(0);
  CountDownLatch latch=expectJoinEvents(grid(0),3);
  startGrid(1);
  System.setProperty(TcpDiscoveryZookeeperIpFinder.PROP_ZK_CONNECTION_STRING,zkCluster.getConnectString());
  startGrid(2);
  startGrid(3);
  waitForRemoteNodes(grid(0),3);
  assertEquals(4,grid(0).cluster().metrics().getTotalNodes());
  assertEquals(4,grid(1).cluster().metrics().getTotalNodes());
  assertEquals(4,grid(2).cluster().metrics().getTotalNodes());
  assertEquals(4,grid(3).cluster().metrics().getTotalNodes());
  latch.await(1,TimeUnit.SECONDS);
  stopGrid(0);
  assertEquals(3,grid(1).cluster().metrics().getTotalNodes());
  assertEquals(3,grid(2).cluster().metrics().getTotalNodes());
  assertEquals(3,grid(3).cluster().metrics().getTotalNodes());
  stopGrid(1);
  stopGrid(2);
  stopGrid(3);
  assertEquals(0,zkCurator.getChildren().forPath(SERVICES_IGNITE_ZK_PATH).size());
}
