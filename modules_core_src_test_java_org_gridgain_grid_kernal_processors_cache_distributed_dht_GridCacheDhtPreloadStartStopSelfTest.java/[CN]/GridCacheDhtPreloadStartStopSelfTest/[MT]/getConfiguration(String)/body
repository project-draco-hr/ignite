{
  GridConfiguration cfg=super.getConfiguration(gridName);
  GridCacheConfiguration[] cacheCfgs=new GridCacheConfiguration[cacheCnt];
  for (int i=0; i < cacheCnt; i++) {
    GridCacheConfiguration cacheCfg=defaultCacheConfiguration();
    cacheCfg.setName("partitioned-" + i);
    cacheCfg.setCacheMode(PARTITIONED);
    cacheCfg.setPreloadBatchSize(preloadBatchSize);
    cacheCfg.setWriteSynchronizationMode(GridCacheWriteSynchronizationMode.FULL_SYNC);
    cacheCfg.setPreloadMode(preloadMode);
    cacheCfg.setAffinity(new GridCacheConsistentHashAffinityFunction(false,partitions));
    cacheCfg.setBackups(backups);
    cacheCfg.setAtomicityMode(TRANSACTIONAL);
    cacheCfgs[i]=cacheCfg;
  }
  GridTcpDiscoverySpi disco=new GridTcpDiscoverySpi();
  disco.setIpFinder(ipFinder);
  cfg.setDiscoverySpi(disco);
  cfg.setCacheConfiguration(cacheCfgs);
  cfg.setDeploymentMode(CONTINUOUS);
  return cfg;
}
