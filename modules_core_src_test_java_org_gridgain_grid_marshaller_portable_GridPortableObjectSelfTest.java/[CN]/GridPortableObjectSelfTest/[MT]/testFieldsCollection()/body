{
  Type1 t1=new Type1();
  t1.c=new Type2();
  GridPortableMetadataCollectingWriter writer=new GridPortableMetadataCollectingWriter();
  Map<Integer,List<String>> fields=writer.writeAndCollect(t1);
  assertEquals(2,fields.size());
  assertEquals(F.asList("a","b","c","d"),fields.get(TYPE1));
  assertEquals(F.asList("a","b","c"),fields.get(TYPE2));
  t1=new Type1();
  t1.c=new Type1();
  fields=writer.writeAndCollect(t1);
  assertEquals(1,fields.size());
  assertEquals(F.asList("a","b","c","d"),fields.get(TYPE1));
}
