{
  CacheAffinity<Object> aff=grid(0).cache(null).affinity();
  for (int i=0; i < gridCount(); i++) {
    for (    GridCacheEntryEx e : ((IgniteKernal)grid(i)).context().cache().internalCache().map().allEntries0()) {
      if (aff.isPrimary(grid(i).localNode(),e.key()) && e.key() instanceof GridCacheQueueHeaderKey)       return i;
    }
  }
  fail("Failed to find primary node for queue header.");
  return -1;
}
