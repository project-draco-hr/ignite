{
  lock();
  try {
    int idx=hash & (tbl.length - 1);
    HashEntry bin=tbl[idx];
    if (bin == null)     return null;
    HashEntry prev=null;
    HashEntry e=bin;
    while (e != null && (e.mapEntry.hash() != hash || !key.equals(e.mapEntry.key))) {
      prev=e;
      e=e.next;
    }
    if (e != null) {
      if (filter != null && !filter.apply(e.mapEntry))       return null;
      if (prev == null)       tbl[idx]=e.next;
 else       prev.next=e.next;
synchronized (e) {
        if (!e.mapEntry.isInternal() && !e.mapEntry.deleted()) {
          mapPubSize.decrement();
          pubSize.decrement();
        }
      }
      mapSize.decrement();
      --size;
      return e.mapEntry;
    }
    return null;
  }
  finally {
    if (DEBUG)     checkSegmentConsistency();
    unlock();
  }
}
