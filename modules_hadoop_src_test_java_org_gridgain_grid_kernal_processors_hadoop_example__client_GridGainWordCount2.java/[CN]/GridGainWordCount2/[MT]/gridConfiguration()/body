{
  GridConfiguration cfg=new GridConfiguration();
  cfg.setRestEnabled(true);
  cfg.setRestTcpPort(11212);
  GridTcpDiscoverySpi discoSpi=new GridTcpDiscoverySpi();
  discoSpi.setIpFinder(new GridTcpDiscoveryVmIpFinder(true));
  cfg.setDiscoverySpi(discoSpi);
  cfg.setLocalHost("127.0.0.1");
  GridCacheConfiguration dataCacheCfg=new GridCacheConfiguration();
  dataCacheCfg.setStartSize(1024);
  dataCacheCfg.setQueryIndexEnabled(true);
  dataCacheCfg.setAtomicityMode(TRANSACTIONAL);
  dataCacheCfg.setDistributionMode(NEAR_PARTITIONED);
  dataCacheCfg.setWriteSynchronizationMode(FULL_SYNC);
  dataCacheCfg.setEvictionPolicy(null);
  dataCacheCfg.setName("partitioned");
  dataCacheCfg.setCacheMode(PARTITIONED);
  dataCacheCfg.setDistributionMode(GridCacheDistributionMode.PARTITIONED_ONLY);
  dataCacheCfg.setWriteSynchronizationMode(GridCacheWriteSynchronizationMode.FULL_SYNC);
  dataCacheCfg.setAffinityMapper(new GridGgfsGroupDataBlocksKeyMapper(128));
  dataCacheCfg.setBackups(0);
  dataCacheCfg.setQueryIndexEnabled(false);
  dataCacheCfg.setAtomicityMode(TRANSACTIONAL);
  GridCacheConfiguration metaCacheCfg=new GridCacheConfiguration();
  metaCacheCfg.setStartSize(1024);
  metaCacheCfg.setQueryIndexEnabled(true);
  metaCacheCfg.setAtomicityMode(TRANSACTIONAL);
  metaCacheCfg.setDistributionMode(NEAR_PARTITIONED);
  metaCacheCfg.setWriteSynchronizationMode(FULL_SYNC);
  metaCacheCfg.setEvictionPolicy(null);
  metaCacheCfg.setName("replicated");
  metaCacheCfg.setCacheMode(REPLICATED);
  metaCacheCfg.setWriteSynchronizationMode(GridCacheWriteSynchronizationMode.FULL_SYNC);
  metaCacheCfg.setQueryIndexEnabled(false);
  metaCacheCfg.setAtomicityMode(TRANSACTIONAL);
  GridCacheConfiguration hadoopCacheCfg=new GridCacheConfiguration();
  hadoopCacheCfg.setCacheMode(REPLICATED);
  hadoopCacheCfg.setAtomicWriteOrderMode(GridCacheAtomicWriteOrderMode.PRIMARY);
  hadoopCacheCfg.setWriteSynchronizationMode(FULL_SYNC);
  hadoopCacheCfg.setName("hadoop-sys");
  cfg.setCacheConfiguration(metaCacheCfg,dataCacheCfg,hadoopCacheCfg);
  GridGgfsConfiguration ggfsCfg=new GridGgfsConfiguration();
  ggfsCfg.setDataCacheName("partitioned");
  ggfsCfg.setMetaCacheName("replicated");
  ggfsCfg.setName("ggfs");
  ggfsCfg.setPrefetchBlocks(1);
  ggfsCfg.setDefaultMode(PRIMARY);
  ggfsCfg.setBlockSize(512 * 1024);
  ggfsCfg.setManagementPort(-1);
  ggfsCfg.setIpcEndpointEnabled(true);
  ggfsCfg.setIpcEndpointConfiguration("{type:'tcp', port:" + DFLT_IPC_PORT + "}");
  cfg.setGgfsConfiguration(ggfsCfg);
  GridHadoopConfiguration hadoopCfg=new GridHadoopConfiguration();
  hadoopCfg.setSystemCacheName("hadoop-sys");
  hadoopCfg.setJobFactory(new GridHadoopDefaultJobFactory());
  cfg.setHadoopConfiguration(hadoopCfg);
  return cfg;
}
