{
  String ggWork0=ggWork;
  if (ggWork0 == null) {
synchronized (GridUtils.class) {
      ggWork0=ggWork;
      if (ggWork0 != null)       return;
      File workDir;
      if (!F.isEmpty(userWorkDir))       workDir=new File(userWorkDir);
 else       if (!F.isEmpty(userGgHome))       workDir=new File(userGgHome,"work");
 else {
        String tmpDirPath=System.getProperty("java.io.tmpdir");
        if (tmpDirPath == null)         throw new GridException("Failed to create work directory in OS temp " + "(property 'java.io.tmpdir' is null).");
        workDir=new File(tmpDirPath,"gridgain" + File.separator + "work");
      }
      if (!workDir.isAbsolute())       throw new GridException("Work directory path must be absolute: " + workDir);
      if (!mkdirs(workDir))       throw new GridException("Work directory does not exist and cannot be created: " + workDir);
      if (!workDir.canRead())       throw new GridException("Cannot read from work directory: " + workDir);
      if (!workDir.canWrite())       throw new GridException("Cannot write to work directory: " + workDir);
      ggWork=workDir.getAbsolutePath();
    }
  }
}
