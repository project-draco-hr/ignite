{
  GridNearTxPrepareFutureAdapter fut=(GridNearTxPrepareFutureAdapter)prepFut.get();
  if (fut == null) {
    if (optimistic()) {
      fut=serializable() ? new GridNearOptimisticSerializableTxPrepareFuture(cctx,this) : new GridNearOptimisticTxPrepareFuture(cctx,this);
    }
 else     fut=new GridNearPessimisticTxPrepareFuture(cctx,this);
    if (!prepFut.compareAndSet(null,fut))     return prepFut.get();
  }
 else   return fut;
  mapExplicitLocks();
  fut.prepare();
  return fut;
}
