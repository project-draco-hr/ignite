{
  GridNearTxPrepareFutureAdapter fut=(GridNearTxPrepareFutureAdapter)prepFut.get();
  if (fut == null) {
    fut=optimistic() ? new GridNearOptimisticTxPrepareFuture(cctx,this) : new GridNearPessimisticTxPrepareFuture(cctx,this);
    if (!prepFut.compareAndSet(null,fut))     return prepFut.get();
  }
 else   return fut;
  mapExplicitLocks();
  fut.prepare();
  return fut;
}
