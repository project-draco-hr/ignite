{
  if (log.isDebugEnabled())   log.debug("Rolling back colocated tx locally: " + this);
  final GridDhtTxFinishFuture<K,V> fut=new GridDhtTxFinishFuture<>(cctx,this,false);
  cctx.mvcc().addFuture(fut);
  IgniteInternalFuture<IgniteInternalTx<K,V>> prep=prepFut.get();
  if (prep == null || prep.isDone()) {
    try {
      if (prep != null)       prep.get();
    }
 catch (    IgniteCheckedException e) {
      if (log.isDebugEnabled())       log.debug("Failed to prepare transaction during rollback (will ignore) [tx=" + this + ", msg="+ e.getMessage()+ ']');
    }
    fut.finish();
  }
 else   prep.listenAsync(new CI1<IgniteInternalFuture<IgniteInternalTx<K,V>>>(){
    @Override public void apply(    IgniteInternalFuture<IgniteInternalTx<K,V>> f){
      try {
        f.get();
      }
 catch (      IgniteCheckedException e) {
        log.debug("Failed to prepare transaction during rollback (will ignore) [tx=" + this + ", msg="+ e.getMessage()+ ']');
      }
      fut.finish();
    }
  }
);
  return fut;
}
