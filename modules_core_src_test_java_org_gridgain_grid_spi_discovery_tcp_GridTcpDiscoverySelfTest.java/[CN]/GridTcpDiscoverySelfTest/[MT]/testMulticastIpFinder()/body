{
  try {
    for (int i=0; i < 5; i++) {
      Grid g=startGrid("MulticastIpFinder-" + i);
      assertEquals(i + 1,g.cluster().nodes().size());
      GridTcpDiscoverySpi spi=(GridTcpDiscoverySpi)g.configuration().getDiscoverySpi();
      GridTcpDiscoveryMulticastIpFinder ipFinder=(GridTcpDiscoveryMulticastIpFinder)spi.getIpFinder();
      boolean found=false;
      for (      GridPortRecord rec : ((GridKernal)g).context().ports().records()) {
        if ((rec.protocol() == UDP) && rec.port() == ipFinder.getMulticastPort()) {
          found=true;
          break;
        }
      }
      assertTrue("GridTcpDiscoveryMulticastIpFinder should register port.",found);
    }
  }
  finally {
    stopAllGrids();
  }
}
