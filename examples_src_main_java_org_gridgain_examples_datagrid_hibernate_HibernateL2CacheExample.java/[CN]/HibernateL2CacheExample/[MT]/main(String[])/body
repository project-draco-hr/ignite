{
  try (Grid g=GridGain.start(HibernateL2CacheExampleNodeStartup.configuration())){
    System.out.println();
    System.out.println(">>> Hibernate L2 cache example started.");
    URL hibernateCfg=ExamplesUtils.url(HIBERNATE_CFG);
    SessionFactory sesFactory=createHibernateSessionFactory(hibernateCfg);
    System.out.println();
    System.out.println(">>> Creating objects.");
    final long userId;
    Session ses=sesFactory.openSession();
    try {
      Transaction tx=ses.beginTransaction();
      User user=new User("jedi","Luke","Skywalker");
      user.getPosts().add(new Post(user,"Let the Force be with you."));
      ses.save(user);
      tx.commit();
      userId=user.getId();
    }
  finally {
      ses.close();
    }
    printStats(sesFactory);
    System.out.println();
    System.out.println(">>> Querying object by ID.");
    for (int i=0; i < 3; i++) {
      ses=sesFactory.openSession();
      try {
        Transaction tx=ses.beginTransaction();
        User user=(User)ses.get(User.class,userId);
        System.out.println("User: " + user);
        for (        Post post : user.getPosts())         System.out.println("\tPost: " + post);
        tx.commit();
      }
  finally {
        ses.close();
      }
    }
    printStats(sesFactory);
  }
 }
