{
  try {
    onAccess();
    if (ctx.isLocal() || ctx.isReplicated()) {
      GridConcurrentHashSet<GridCacheSetItemKey> set=ctx.dataStructures().setData(id);
      return set != null ? set.size() : 0;
    }
    CacheQuery qry=new GridCacheQueryAdapter<>(ctx,SET,null,null,new GridSetQueryPredicate<>(id,collocated),false,false);
    Collection<ClusterNode> nodes=dataNodes(ctx.affinity().affinityTopologyVersion());
    qry.projection(ctx.grid().cluster().forNodes(nodes));
    int sum=F.reduce((Iterable<Object>)qry.execute().get(),new SumReducer());
    return sum;
  }
 catch (  IgniteCheckedException e) {
    throw U.convertException(e);
  }
}
