{
  if (ctx.isLocal() || ctx.isReplicated())   return Collections.singleton(ctx.localNode());
  Collection<ClusterNode> nodes;
  if (collocated) {
    List<ClusterNode> nodes0=ctx.affinity().nodes(hdrPart,topVer);
    nodes=!nodes0.isEmpty() ? Collections.singleton(nodes0.contains(ctx.localNode()) ? ctx.localNode() : F.first(nodes0)) : nodes0;
  }
 else   nodes=CU.affinityNodes(ctx,topVer);
  if (nodes.isEmpty())   throw new IgniteCheckedException("Failed to get set data, all cache nodes left grid.");
  return nodes;
}
