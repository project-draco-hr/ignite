{
  if (ses.isWithinTransaction()) {
    Map<Object,Object> props=ses.properties();
    Connection conn=(Connection)props.get(ATTR_NAME);
    if (conn == null) {
      conn=openConnection(false);
      props.put(ATTR_NAME,conn);
    }
    return conn;
  }
 else   return openConnection(true);
}
