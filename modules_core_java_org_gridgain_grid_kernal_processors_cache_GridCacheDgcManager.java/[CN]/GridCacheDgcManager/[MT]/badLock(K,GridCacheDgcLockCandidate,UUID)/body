{
  if (cand.near() && cctx.isColocated()) {
    GridCacheTxManager<K,V> tm=cctx.tm();
    if (tm.tx(cand.nearVersion()) == null && cctx.mvcc().explicitLock(key,cand.nearVersion()) == null) {
      if (traceLog.isDebugEnabled()) {
        traceLog.debug("Failed to find explicit lock or active transaction for remote " + "candidate [cand=" + cand + ", rmtNodeId="+ sndId+ ']');
      }
      return true;
    }
  }
 else {
    GridCacheVersion ver=cand.near() ? cand.nearVersion() : cand.version();
    while (true) {
      GridCacheEntryEx<K,V> cached=cand.near() ? cctx.dht().near().peekEx(key) : cctx.cache().peekEx(key);
      try {
        if (cached == null || !cached.hasLockCandidate(ver)) {
          if (traceLog.isDebugEnabled()) {
            traceLog.debug("Failed to find main lock for remote candidate [cand=" + cand + ", entry="+ cached+ ", rmtNodeId="+ sndId+ ']');
          }
          return true;
        }
        break;
      }
 catch (      GridCacheEntryRemovedException ignore) {
        if (log.isDebugEnabled())         log.debug("Found remove entry during DGC check (will retry): " + cached);
      }
    }
  }
  return false;
}
