{
  if (key != null && GridGgfsBlockKey.class.equals(key.getClass())) {
    GridGgfsBlockKey blockKey=(GridGgfsBlockKey)key;
    if (blockKey.affinityKey() != null)     return blockKey.affinityKey();
    long grpId=blockKey.getBlockId() / grpSize;
    return blockKey.getFileId().hashCode() + (int)(grpId ^ (grpId >>> 32));
  }
  return super.affinityKey(key);
}
