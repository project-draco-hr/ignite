{
  awaitPartitionMapExchange();
  GridCache<String,Integer> cache=cache();
  int keyCnt=10;
  for (int i=0; i < keyCnt; i++)   cache.put("key" + i,i);
  for (int g=0; g < gridCount(); g++) {
    GridCache<String,Integer> cache0=cache(g);
    ClusterNode locNode=grid(g).localNode();
    for (int i=0; i < keyCnt; i++) {
      String key="key" + i;
      if (cache.affinity().mapKeyToPrimaryAndBackups(key).contains(locNode)) {
        info("Node is reported as affinity node for key [key=" + key + ", nodeId="+ locNode.id()+ ']');
        assertEquals((Integer)i,cache0.peek(key));
      }
 else {
        info("Node is reported as NOT affinity node for key [key=" + key + ", nodeId="+ locNode.id()+ ']');
        if (distributionMode() == NEAR_PARTITIONED && cache == cache0)         assertEquals((Integer)i,cache0.peek(key));
 else         assertNull(cache0.peek(key));
      }
      assertEquals((Integer)i,cache0.get(key));
    }
  }
  info("Removing values from cache.");
  for (int i=0; i < keyCnt; i++)   assertEquals((Integer)i,cache.remove("key" + i));
  for (int g=0; g < gridCount(); g++) {
    GridCache<String,Integer> cache0=cache(g);
    for (int i=0; i < keyCnt; i++) {
      String key="key" + i;
      assertNull(cache0.peek(key));
      assertNull(cache0.get(key));
    }
  }
}
