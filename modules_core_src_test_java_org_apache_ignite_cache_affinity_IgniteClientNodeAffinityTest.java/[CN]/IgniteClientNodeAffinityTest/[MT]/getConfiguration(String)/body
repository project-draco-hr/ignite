{
  IgniteConfiguration cfg=super.getConfiguration(gridName);
  ((TcpDiscoverySpi)cfg.getDiscoverySpi()).setIpFinder(ipFinder);
  if (gridName.equals(getTestGridName(NODE_CNT - 1)))   cfg.setClientMode(true);
  CacheConfiguration ccfg1=new CacheConfiguration();
  ccfg1.setBackups(1);
  ccfg1.setName(CACHE1);
  ccfg1.setAffinity(new RendezvousAffinityFunction());
  ccfg1.setNodeFilter(new TestNodesFilter());
  CacheConfiguration ccfg2=new CacheConfiguration();
  ccfg2.setBackups(1);
  ccfg2.setName(CACHE2);
  ccfg2.setAffinity(new RendezvousAffinityFunction());
  CacheConfiguration ccfg3=new CacheConfiguration();
  ccfg3.setBackups(1);
  ccfg3.setName(CACHE3);
  ccfg3.setAffinity(new FairAffinityFunction());
  ccfg3.setNodeFilter(new TestNodesFilter());
  CacheConfiguration ccfg4=new CacheConfiguration();
  ccfg4.setCacheMode(REPLICATED);
  ccfg4.setName(CACHE4);
  ccfg4.setNodeFilter(new TestNodesFilter());
  cfg.setCacheConfiguration(ccfg1,ccfg2,ccfg3,ccfg4);
  return cfg;
}
