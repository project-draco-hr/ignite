{
  IgniteConfiguration cfg=super.getConfiguration(gridName);
  CacheConfiguration cacheCfg=cacheConfiguration(CACHE_NAME);
  TestTpcCommunicationSpi commSpi=new TestTpcCommunicationSpi();
  commSpi.setLocalPort(GridTestUtils.getNextCommPort(getClass()));
  commSpi.setTcpNoDelay(true);
  if (gridName.endsWith(String.valueOf(CLN_GRD)))   cfg.setClientMode(true);
  cacheCfg.setRebalanceMode(SYNC);
  cacheCfg.setWriteSynchronizationMode(FULL_SYNC);
  cacheCfg.setBackups(1);
  cfg.setCommunicationSpi(commSpi);
  cfg.setDiscoverySpi(new TcpDiscoverySpi().setIpFinder(finder).setForceServerMode(true));
  cfg.setCacheConfiguration(cacheCfg);
  return cfg;
}
