{
  OptimizedObjectOutputStream objOut=null;
  try {
    objOut=OptimizedObjectStreamRegistry.out();
    objOut.context(ctx);
    objOut.requireSerializable(requireSer);
    objOut.writeObject(obj);
    return objOut.out().array();
  }
 catch (  IOException e) {
    throw new IgniteCheckedException("Failed to serialize object: " + obj,e);
  }
 finally {
    OptimizedObjectStreamRegistry.closeOut(objOut);
  }
}
