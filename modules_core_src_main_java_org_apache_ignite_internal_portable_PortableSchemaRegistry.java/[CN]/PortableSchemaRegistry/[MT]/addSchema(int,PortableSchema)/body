{
synchronized (this) {
    if (inline) {
      if (schemaId == schemaId1 || schemaId == schemaId2 || schemaId == schemaId3 || schemaId == schemaId4)       return;
      if (schemaId1 == EMPTY) {
        schemaId1=schemaId;
        schema1=schema;
        inline=true;
        return;
      }
      if (schemaId2 == EMPTY) {
        schemaId2=schemaId;
        schema2=schema;
        inline=true;
        return;
      }
      if (schemaId3 == EMPTY) {
        schemaId3=schemaId;
        schema3=schema;
        inline=true;
        return;
      }
      if (schemaId4 == EMPTY) {
        schemaId4=schemaId;
        schema4=schema;
        inline=true;
        return;
      }
      HashMap<Integer,PortableSchema> newSchemas=new HashMap<>();
      newSchemas.put(schemaId1,schema1);
      newSchemas.put(schemaId2,schema2);
      newSchemas.put(schemaId3,schema3);
      newSchemas.put(schemaId4,schema4);
      newSchemas.put(schemaId,schema);
      schemas=newSchemas;
      inline=false;
    }
 else {
      HashMap<Integer,PortableSchema> newSchemas=new HashMap<>(schemas);
      newSchemas.put(schemaId,schema);
      schemas=newSchemas;
    }
  }
}
