{
  GridClientConfiguration cfg=clientConfiguration();
  cfg.setMarshaller(new GridClientMarshaller(){
    @Override public ByteBuffer marshal(    Object obj,    int off){
      throw new UnsupportedOperationException();
    }
    @Override public <T>T unmarshal(    byte[] bytes){
      throw new UnsupportedOperationException();
    }
  }
);
  GridClient c=GridClientFactory.start(cfg);
  Exception err=null;
  try {
    c.compute().refreshTopology(false,false);
  }
 catch (  Exception e) {
    err=e;
  }
  assertNotNull(err);
  assertTrue(X.hasCause(err,GridClientHandshakeException.class));
}
