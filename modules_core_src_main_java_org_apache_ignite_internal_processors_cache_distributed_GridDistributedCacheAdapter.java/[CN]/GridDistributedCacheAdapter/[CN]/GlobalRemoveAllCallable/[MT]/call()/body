{
  GridCacheAdapter<K,V> cacheAdapter=((IgniteKernal)ignite).context().cache().internalCache(cacheName);
  final GridCacheContext<K,V> ctx=cacheAdapter.context();
  ctx.affinity().affinityReadyFuture(topVer).get();
  ctx.gate().enter();
  try {
    if (ctx.affinity().affinityTopologyVersion() != topVer)     return null;
    GridDhtCacheAdapter<K,V> dht;
    if (cacheAdapter instanceof GridNearCacheAdapter)     dht=((GridNearCacheAdapter<K,V>)cacheAdapter).dht();
 else     dht=(GridDhtCacheAdapter<K,V>)cacheAdapter;
    try (IgniteDataLoader<KeyCacheObject,Object> dataLdr=ignite.dataLoader(cacheName)){
      ((IgniteDataLoaderImpl)dataLdr).maxRemapCount(0);
      dataLdr.updater(GridDataLoadCacheUpdaters.<KeyCacheObject,Object>batched());
      for (      GridDhtLocalPartition locPart : dht.topology().currentLocalPartitions()) {
        if (!locPart.isEmpty() && locPart.primary(topVer)) {
          for (          GridDhtCacheEntry o : locPart.entries()) {
            if (!o.obsoleteOrDeleted())             dataLdr.removeData(o.key());
          }
        }
      }
      Iterator<KeyCacheObject> it=dht.context().swap().offHeapKeyIterator(true,false,topVer);
      while (it.hasNext())       dataLdr.removeData(it.next());
      it=dht.context().swap().swapKeyIterator(true,false,topVer);
      while (it.hasNext())       dataLdr.removeData(it.next());
    }
   }
  finally {
    ctx.gate().leave();
  }
  return null;
}
