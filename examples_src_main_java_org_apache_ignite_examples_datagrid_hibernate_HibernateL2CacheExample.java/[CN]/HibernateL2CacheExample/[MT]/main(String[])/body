{
  try (Ignite ignite=Ignition.start("examples/config/example-ignite.xml")){
    System.out.println();
    System.out.println(">>> Hibernate L2 cache example started.");
    try (IgniteCache c1=createCache("org.hibernate.cache.spi.UpdateTimestampsCache",ATOMIC);IgniteCache c2=createCache("org.hibernate.cache.internal.StandardQueryCache",ATOMIC);IgniteCache c3=createCache("org.apache.ignite.examples.datagrid.hibernate.User",TRANSACTIONAL);IgniteCache c4=createCache("org.apache.ignite.examples.datagrid.hibernate.User.posts",TRANSACTIONAL);IgniteCache c5=createCache("org.apache.ignite.examples.datagrid.hibernate.Post",TRANSACTIONAL)){
      URL hibernateCfg=ExamplesUtils.url(HIBERNATE_CFG);
      SessionFactory sesFactory=createHibernateSessionFactory(hibernateCfg);
      System.out.println();
      System.out.println(">>> Creating objects.");
      final long userId;
      Session ses=sesFactory.openSession();
      try {
        Transaction tx=ses.beginTransaction();
        User user=new User("jedi","Luke","Skywalker");
        user.getPosts().add(new Post(user,"Let the Force be with you."));
        ses.save(user);
        tx.commit();
        userId=user.getId();
      }
  finally {
        ses.close();
      }
      printStats(sesFactory);
      System.out.println();
      System.out.println(">>> Querying object by ID.");
      for (int i=0; i < 3; i++) {
        ses=sesFactory.openSession();
        try {
          Transaction tx=ses.beginTransaction();
          User user=(User)ses.get(User.class,userId);
          System.out.println("User: " + user);
          for (          Post post : user.getPosts())           System.out.println("\tPost: " + post);
          tx.commit();
        }
  finally {
          ses.close();
        }
      }
      printStats(sesFactory);
    }
   }
 }
