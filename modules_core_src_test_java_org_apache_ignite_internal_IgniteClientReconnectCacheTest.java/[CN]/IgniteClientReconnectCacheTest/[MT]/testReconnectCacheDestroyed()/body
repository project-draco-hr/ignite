{
  clientMode=true;
  final IgniteEx client=startGrid(SRV_CNT);
  assertTrue(client.cluster().localNode().isClient());
  final Ignite srv=clientRouter(client);
  final IgniteCache<Object,Object> clientCache=client.getOrCreateCache(new CacheConfiguration<>());
  reconnectClientNode(client,srv,new Runnable(){
    @Override public void run(){
      srv.destroyCache(null);
    }
  }
);
  GridTestUtils.assertThrows(log,new Callable<Object>(){
    @Override public Object call() throws Exception {
      return clientCache.get(1);
    }
  }
,IllegalStateException.class,null);
  checkCacheDiscoveryData(srv,client,null,false,false,false);
  IgniteCache<Object,Object> clientCache0=client.getOrCreateCache(new CacheConfiguration<>());
  checkCacheDiscoveryData(srv,client,null,true,true,false);
  clientCache0.put(1,1);
  assertEquals(1,clientCache0.get(1));
}
