{
  if (spi.getSpiContext().isStopping()) {
    if (!getLocalNodeId().equals(msg.creatorNodeId()) && getLocalNodeId().equals(msg.failedNodeId())) {
      if (leaveLatch.getCount() > 0) {
        log.debug("Remote node fail this node while node is stopping [locNode=" + getLocalNodeId() + ", rmtNode="+ msg.creatorNodeId()+ ']');
        leaveLatch.countDown();
      }
    }
    return;
  }
  if (!getLocalNodeId().equals(msg.creatorNodeId())) {
    TcpDiscoveryNode node=rmtNodes.remove(msg.failedNodeId());
    if (node == null) {
      if (log.isDebugEnabled())       log.debug("Discarding node failed message since node is not found [msg=" + msg + ']');
      return;
    }
    NavigableSet<ClusterNode> top=updateTopologyHistory(msg.topologyVersion());
    if (!pending && joinLatch.getCount() > 0) {
      if (log.isDebugEnabled())       log.debug("Discarding node failed message (join process is not finished): " + msg);
      return;
    }
    notifyDiscovery(EVT_NODE_FAILED,msg.topologyVersion(),node,top);
    spi.stats.onNodeFailed();
  }
}
