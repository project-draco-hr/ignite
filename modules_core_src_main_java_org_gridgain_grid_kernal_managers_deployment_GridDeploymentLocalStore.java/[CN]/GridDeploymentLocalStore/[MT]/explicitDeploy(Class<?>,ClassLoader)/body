{
  try {
    if (clsLdr.getClass().equals(GridDeploymentClassLoader.class))     clsLdr=clsLdr.getParent();
    spi.register(clsLdr,cls);
    GridDeployment dep=deployment(cls.getName());
    if (dep == null) {
      GridDeploymentResource rsrc=spi.findResource(cls.getName());
      if (rsrc != null && rsrc.getClassLoader() == clsLdr)       dep=deploy(ctx.config().getDeploymentMode(),rsrc.getClassLoader(),rsrc.getResourceClass(),rsrc.getName(),true);
    }
    return dep;
  }
 catch (  GridSpiException e) {
    recordDeployFailed(cls,clsLdr,true);
    if (e.getCause() instanceof GridException)     throw (GridException)e.getCause();
    throw new GridDeploymentException("Failed to deploy class: " + cls.getName(),e);
  }
}
