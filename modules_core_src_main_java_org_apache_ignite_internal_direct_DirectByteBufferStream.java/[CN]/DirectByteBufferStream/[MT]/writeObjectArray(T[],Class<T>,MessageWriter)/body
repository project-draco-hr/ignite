{
  if (arr != null) {
    if (it == null) {
      writeInt(arr.length);
      if (!lastFinished)       return;
      it=arrayIterator(arr);
    }
    MessageWriteState state=MessageWriteState.get();
    Type itemType=type(itemCls);
    while (it.hasNext() || cur != NULL) {
      if (cur == NULL) {
        cur=it.next();
      }
      write(itemType,cur,state);
      if (!lastFinished)       return;
      cur=NULL;
    }
    it=null;
  }
 else   writeInt(-1);
}
