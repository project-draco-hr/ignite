{
  GridConfiguration cfg=super.getConfiguration(gridName);
  cfg.setDiscoverySpi(new GridTcpDiscoverySpi());
  GridCacheConfiguration ccfg=defaultCacheConfiguration();
  ccfg.setCacheMode(PARTITIONED);
  ccfg.setDistributionMode(distroMode);
  ccfg.setWriteBehindEnabled(writeBehind);
  ccfg.setCacheMode(GridCacheMode.PARTITIONED);
  ccfg.setName(CACHE_NAME);
  TestStore store=new TestStore();
  ccfg.setStore(store);
  lifecycleAwares.add(store);
  TestAffinityFunction affinity=new TestAffinityFunction();
  ccfg.setAffinity(affinity);
  lifecycleAwares.add(affinity);
  TestTxLookup txLookup=new TestTxLookup();
  ccfg.setTransactionManagerLookup(txLookup);
  lifecycleAwares.add(txLookup);
  TestEvictionPolicy evictionPlc=new TestEvictionPolicy();
  ccfg.setEvictionPolicy(evictionPlc);
  lifecycleAwares.add(evictionPlc);
  TestEvictionPolicy nearEvictionPlc=new TestEvictionPolicy();
  ccfg.setNearEvictionPolicy(nearEvictionPlc);
  lifecycleAwares.add(nearEvictionPlc);
  TestEvictionFilter evictionFilter=new TestEvictionFilter();
  ccfg.setEvictionFilter(evictionFilter);
  lifecycleAwares.add(evictionFilter);
  TestCloner cloner=new TestCloner();
  ccfg.setCloner(cloner);
  lifecycleAwares.add(cloner);
  TestAffinityKeyMapper mapper=new TestAffinityKeyMapper();
  ccfg.setAffinityMapper(mapper);
  lifecycleAwares.add(mapper);
  cfg.setCacheConfiguration(ccfg);
  return cfg;
}
