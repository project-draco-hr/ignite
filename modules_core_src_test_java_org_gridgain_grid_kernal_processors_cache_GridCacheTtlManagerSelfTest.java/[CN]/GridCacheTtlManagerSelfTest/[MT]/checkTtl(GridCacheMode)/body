{
  cacheMode=mode;
  final GridKernal g=(GridKernal)startGrid(0);
  try {
    final String key="key";
    final GridCache<Object,Object> cache=g.cache(null);
    GridCacheEntry<Object,Object> entry=cache.entry(key);
    entry.timeToLive(1000);
    entry.setValue(1);
    U.sleep(1100);
    GridTestUtils.retryAssert(log,10,100,new CAX(){
      @Override public void applyx(){
        try {
          assertNull(g.cache(null).get(key));
        }
 catch (        GridException ignore) {
        }
        if (!g.internalCache().context().deferredDelete())         assertNull(g.internalCache().map().getEntry(key));
      }
    }
);
  }
  finally {
    stopAllGrids();
  }
}
