{
  cacheMode=mode;
  final GridKernal g=(GridKernal)startGrid(0);
  try {
    final String key="key";
    g.jcache(null).withExpiryPolicy(new TouchedExpiryPolicy(new Duration(TimeUnit.MILLISECONDS,1000))).put(key,1);
    assertEquals(1,g.jcache(null).get(key));
    U.sleep(1100);
    GridTestUtils.retryAssert(log,10,100,new CAX(){
      @Override public void applyx(){
        assertNull(g.jcache(null).get(key));
        if (!g.internalCache().context().deferredDelete())         assertNull(g.internalCache().map().getEntry(key));
      }
    }
);
  }
  finally {
    stopAllGrids();
  }
}
