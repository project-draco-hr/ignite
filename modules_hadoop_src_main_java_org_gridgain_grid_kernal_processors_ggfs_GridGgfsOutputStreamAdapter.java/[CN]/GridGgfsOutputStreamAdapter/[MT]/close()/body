{
  if (closed)   return;
  try {
    try {
      flush();
    }
  finally {
      onClose();
    }
  }
  finally {
    closed=true;
  }
}
