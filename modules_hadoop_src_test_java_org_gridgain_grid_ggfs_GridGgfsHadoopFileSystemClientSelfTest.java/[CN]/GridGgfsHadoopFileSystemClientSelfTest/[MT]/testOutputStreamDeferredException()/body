{
  final byte[] data="test".getBytes();
  try {
    switchHandlerErrorFlag(true);
    GridGgfsHadoop client=new GridGgfsHadoop(LOG,ENDPOINT);
    GridGgfsPath path=new GridGgfsPath("/test.file");
    Long streamId=client.create(path,true,false,1,1024,null).get();
    final GridGgfsHadoopOutputStream ggfsOut=new GridGgfsHadoopOutputStream(client,streamId,LOG,GridGgfsHadoopLogger.disabledLogger(),0);
    ggfsOut.write(data);
    U.sleep(500);
    GridTestUtils.assertThrows(null,new Callable<Object>(){
      @Override public Object call() throws Exception {
        ggfsOut.write(data);
        return null;
      }
    }
,IOException.class,"Failed to write data to server (test).");
  }
  finally {
    switchHandlerErrorFlag(false);
  }
}
