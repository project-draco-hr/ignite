{
  CacheConfiguration ccfg=new CacheConfiguration();
  ccfg.setReadThrough(true);
  ccfg.setWriteThrough(true);
  ccfg.setCacheStoreFactory(cacheStoreFactory());
  ccfg.setWriteSynchronizationMode(FULL_SYNC);
  ccfg.setAtomicityMode(atomicityMode);
  ccfg.setCacheMode(cacheMode);
  ccfg.setAffinity(new RendezvousAffinityFunction(false,32));
  ccfg.setAtomicWriteOrderMode(PRIMARY);
  ccfg.setMemoryMode(memoryMode);
  if (nearCache)   ccfg.setNearConfiguration(new NearCacheConfiguration());
  if (cacheMode == PARTITIONED)   ccfg.setBackups(backups);
  return ccfg;
}
