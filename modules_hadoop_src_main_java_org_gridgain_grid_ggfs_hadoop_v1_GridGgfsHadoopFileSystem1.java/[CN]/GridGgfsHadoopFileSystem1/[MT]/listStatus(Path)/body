{
  A.notNull(f,"f");
  enterBusy();
  try {
    GridGgfsPath path=convert(f);
    GridGgfsMode mode=mode(path);
    if (mode == PROXY) {
      if (secondaryFs == null) {
        assert mgmt;
        return EMPTY_FILE_STATUS;
      }
      FileStatus[] arr=secondaryFs.listStatus(toSecondary(f));
      if (arr != null) {
        for (int i=0; i < arr.length; i++)         arr[i]=toPrimary(arr[i]);
      }
      if (clientLog.isLogEnabled()) {
        String[] fileArr=null;
        if (arr != null) {
          fileArr=new String[arr.length];
          for (int i=0; i < arr.length; i++)           fileArr[i]=arr[i].getPath().toString();
        }
        clientLog.logListDirectory(path,PROXY,fileArr);
      }
      return arr;
    }
 else {
      Collection<GridGgfsFile> list=rmtClient.listFiles(path).get();
      if (list == null)       return null;
      List<GridGgfsFile> files=new ArrayList<>(list);
      FileStatus[] arr=new FileStatus[files.size()];
      for (int i=0; i < arr.length; i++)       arr[i]=convert(files.get(i));
      if (clientLog.isLogEnabled()) {
        String[] fileArr=new String[arr.length];
        for (int i=0; i < arr.length; i++)         fileArr[i]=arr[i].getPath().toString();
        clientLog.logListDirectory(path,mode,fileArr);
      }
      return arr;
    }
  }
 catch (  GridGgfsFileNotFoundException ignored) {
    return null;
  }
catch (  GridException e) {
    throw new IOException("Failed to list file status for path: " + f,e);
  }
 finally {
    leaveBusy();
  }
}
