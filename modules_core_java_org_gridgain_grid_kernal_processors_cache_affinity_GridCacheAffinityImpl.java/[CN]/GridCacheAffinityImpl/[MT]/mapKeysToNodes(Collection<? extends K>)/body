{
  A.notNull(keys,"keys");
  long topVer=cctx.discovery().topologyVersion();
  int nodesCnt=cctx.discovery().cacheAffinityNodes(cctx.name(),topVer).size();
  Map<GridNode,Collection<K>> res=new HashMap<>(nodesCnt,1.0f);
  for (  K key : keys) {
    GridNode primary=cctx.affinity().primary(key);
    if (primary != null) {
      Collection<K> mapped=res.get(primary);
      if (mapped == null) {
        mapped=new ArrayList<>(Math.max(keys.size() / nodesCnt,16));
        res.put(primary,mapped);
      }
      mapped.add(key);
    }
  }
  return res;
}
