{
  Collection<GridClientNode> nodes=new ArrayList<>();
  Collection<ClusterNode> srvNodes=new ArrayList<>();
  GridClientPartitionAffinity aff=new GridClientPartitionAffinity();
  getTestResources().inject(aff);
  aff.setHashIdResolver(HASH_ID_RSLVR);
  CacheRendezvousAffinityFunction srvAff=new CacheRendezvousAffinityFunction();
  getTestResources().inject(srvAff);
  srvAff.setHashIdResolver(new CacheAffinityNodeIdHashResolver());
  Collection<String> keys=new ArrayList<>(Arrays.asList("","1","12","asdf","Hadoop\u3092\u6bba\u3059"));
  for (int i=0; i < 10; i++)   keys.add(UUID.randomUUID().toString());
  for (int i=0; i < 20; i++) {
    addNodes(1 + (int)Math.round(Math.random() * 50),nodes,srvNodes);
    for (    String key : keys)     assertSameAffinity(key,aff,srvAff,nodes,srvNodes);
  }
}
