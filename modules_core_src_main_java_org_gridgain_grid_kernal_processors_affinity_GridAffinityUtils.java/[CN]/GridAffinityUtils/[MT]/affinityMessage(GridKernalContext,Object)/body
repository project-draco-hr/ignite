{
  Class cls=o.getClass();
  GridDeployment dep=ctx.deploy().deploy(cls,cls.getClassLoader());
  if (dep == null)   throw new IgniteDeploymentException("Failed to deploy affinity object with class: " + cls.getName());
  return new GridAffinityMessage(ctx.config().getMarshaller().marshal(o),cls.getName(),dep.classLoaderId(),dep.deployMode(),dep.userVersion(),dep.participants());
}
