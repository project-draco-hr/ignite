{
  init();
  QueryCache type=entryQtyCache.get(typeKey(key));
  if (type == null)   throw new IgniteCheckedException("Failed to find metadata for type: " + key.getClass());
  if (log.isDebugEnabled())   log.debug("Start put value in db: (" + key + ", "+ val);
  Connection conn=null;
  PreparedStatement stmt=null;
  try {
    conn=connection(tx);
    if (dialect.hasMerge()) {
      stmt=conn.prepareStatement(type.mergeQry);
      int i=fillKeyParameters(stmt,type,key);
      fillValueParameters(stmt,i,type,val);
      stmt.executeUpdate();
    }
 else {
      stmt=conn.prepareStatement(type.updQry);
      int i=fillValueParameters(stmt,1,type,val);
      fillKeyParameters(stmt,i,type,key);
      if (stmt.executeUpdate() == 0) {
        stmt.close();
        stmt=conn.prepareStatement(type.insQry);
        i=fillKeyParameters(stmt,type,key);
        fillValueParameters(stmt,i,type,val);
        stmt.executeUpdate();
      }
    }
  }
 catch (  SQLException e) {
    throw new IgniteCheckedException("Failed to put object by key: " + key,e);
  }
 finally {
    end(tx,conn,stmt);
  }
}
