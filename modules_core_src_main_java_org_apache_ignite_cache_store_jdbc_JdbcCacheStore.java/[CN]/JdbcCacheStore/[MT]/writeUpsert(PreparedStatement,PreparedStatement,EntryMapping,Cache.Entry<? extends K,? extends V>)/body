{
  for (int attempt=0; attempt < MAX_ATTEMPT_WRITE_COUNT; attempt++) {
    int i=fillValueParameters(updStmt,1,em,entry.getValue());
    fillKeyParameters(updStmt,i,em,entry.getKey());
    if (updStmt.executeUpdate() == 0) {
      i=fillKeyParameters(insStmt,em,entry.getKey());
      fillValueParameters(insStmt,i,em,entry.getValue());
      try {
        insStmt.executeUpdate();
      }
 catch (      SQLException e) {
        String sqlState=e.getSQLState();
        SQLException nested=e.getNextException();
        while (sqlState == null && nested != null) {
          sqlState=nested.getSQLState();
          nested=nested.getNextException();
        }
        if (sqlState != null && Integer.valueOf(sqlState) == 23505)         continue;
        throw e;
      }
    }
    return;
  }
  throw new CacheWriterException("Failed write entry to database: " + entry);
}
