{
  DiscoCache cache=topVer == -1 || topVer == topologyVersion() ? discoCache() : discoCacheHist.get(topVer);
  if (cache == null) {
    Map.Entry<Long,DiscoCache> eldest=Collections.min(discoCacheHist.entrySet(),histCmp);
    if (topVer < eldest.getKey())     cache=eldest.getValue();
  }
  if (cache == null) {
    throw new GridRuntimeException("Failed to resolve nodes topology [cacheName=" + cacheName + ", topVer="+ topVer+ ", history="+ discoCacheHist.keySet()+ ",  locNode="+ ctx.discovery().localNode()+ ']');
  }
  return cache;
}
