{
  List<IgniteCache<Object,Object>> caches=new ArrayList<>();
  IgniteCache<Object,Object> persPart=ignite(0).createCache(cacheConfig("persPart",true,Integer.class,Person2.class));
  caches.add(persPart);
  IgniteCache<Object,Object> persPartAff=ignite(0).createCache(cacheConfig("persPartAff",true,TestKey.class,Person2.class));
  caches.add(persPartAff);
  IgniteCache<Object,Object> orgRepl=ignite(0).createCache(cacheConfig("orgRepl",false,Integer.class,Organization.class));
  caches.add(orgRepl);
  try {
    checkQueryFails(persPart,"select p1._key k1, p2._key k2, o._key k3 " + "from \"orgRepl\".Organization o, \"persPartAff\".Person2 p1, \"persPart\".Person2 p2 " + "where p1._key=p2._key and p2.orgId = o._key",true);
    checkQueryFails(persPart,"select p1._key k1, p2._key k2, o._key k3 " + "from \"persPartAff\".Person2 p1, \"orgRepl\".Organization o, \"persPart\".Person2 p2 " + "where p1._key=p2._key and p2.orgId = o._key",true);
    checkQueryFails(persPart,"select p1._key k1, p2._key k2, o._key k3 " + "from \"persPartAff\".Person2 p1, (select * from \"orgRepl\".Organization) o, \"persPart\".Person2 p2 " + "where p1._key=p2._key and p2.orgId = o._key",true);
    checkQueryPlan(persPart,true,0,"select p._key k1, o._key k2 from \"orgRepl\".Organization o, \"persPart\".Person2 p");
    checkQueryPlan(persPart,true,0,"select p._key k1, o._key k2 from \"orgRepl\".Organization o, \"persPart\".Person2 p union " + "select p._key k1, o._key k2 from \"persPart\".Person2 p, \"orgRepl\".Organization o");
  }
  finally {
    for (    IgniteCache<Object,Object> cache : caches)     ignite(0).destroyCache(cache.getName());
  }
}
