{
  if (atomicsCacheCtx == null)   return;
  if (!atomicsCacheCtx.isDht() && tx.internal() && (!atomicsCacheCtx.isColocated() || atomicsCacheCtx.isReplicated())) {
    Collection<IgniteTxEntry<K,V>> entries=tx.writeEntries();
    if (log.isDebugEnabled())     log.debug("Committed entries: " + entries);
    for (    IgniteTxEntry<K,V> entry : entries) {
      if ((entry.op() == CREATE || entry.op() == UPDATE) && entry.key() instanceof GridCacheInternalKey) {
        GridCacheInternal key=(GridCacheInternal)entry.key();
        if (entry.value() instanceof GridCacheCountDownLatchValue) {
          GridCacheRemovable latch=dsMap.get(key);
          GridCacheCountDownLatchValue val=(GridCacheCountDownLatchValue)entry.value();
          if (latch instanceof GridCacheCountDownLatchEx) {
            GridCacheCountDownLatchEx latch0=(GridCacheCountDownLatchEx)latch;
            latch0.onUpdate(val.get());
            if (val.get() == 0 && val.autoDelete()) {
              entry.cached().markObsolete(atomicsCacheCtx.versions().next());
              dsMap.remove(key);
              latch.onRemoved();
            }
          }
 else           if (latch != null) {
            U.error(log,"Failed to cast object " + "[expected=" + IgniteCountDownLatch.class.getSimpleName() + ", actual="+ latch.getClass()+ ", value="+ latch+ ']');
          }
        }
      }
      if (entry.op() == DELETE && entry.key() instanceof GridCacheInternal) {
        GridCacheInternal key=(GridCacheInternal)entry.key();
        GridCacheRemovable obj=dsMap.remove(key);
        if (obj != null)         obj.onRemoved();
      }
    }
  }
}
