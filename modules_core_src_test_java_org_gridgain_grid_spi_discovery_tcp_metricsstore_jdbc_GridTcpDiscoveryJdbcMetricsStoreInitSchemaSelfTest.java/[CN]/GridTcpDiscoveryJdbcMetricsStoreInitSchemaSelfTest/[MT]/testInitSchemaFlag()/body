{
  GridTcpDiscoveryJdbcMetricsStore store=new GridTcpDiscoveryJdbcMetricsStore();
  ComboPooledDataSource dataSrc=new ComboPooledDataSource();
  try {
    dataSrc.setDriverClass("org.h2.Driver");
    dataSrc.setJdbcUrl("jdbc:h2:mem:jdbc_metrics_not_initialized_schema");
    store.setDataSource(dataSrc);
    store.setInitSchema(false);
    try {
      store.allNodeIds();
      fail("JDBC metrics store didn't throw expected exception.");
    }
 catch (    GridSpiException e) {
      assertTrue(e.getMessage().contains("Metrics store has not been properly initialized."));
    }
  }
  finally {
    dataSrc.close();
  }
}
