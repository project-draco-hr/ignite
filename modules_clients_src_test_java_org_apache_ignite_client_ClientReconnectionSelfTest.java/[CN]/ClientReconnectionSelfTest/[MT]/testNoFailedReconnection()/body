{
  for (int i=0; i < SERVERS_CNT; i++)   runServer(i,false);
  try (GridClient client=client()){
    assertEquals(1,srvs[0].getConnectCount());
    for (int i=1; i < SERVERS_CNT; i++)     assertEquals(0,srvs[i].getConnectCount());
    srvs[0].resetCounters();
    int contactedSrv=0;
    for (int i=0; i < 100; i++) {
      int failed=contactedSrv;
      srvs[failed].fail();
      while (true)       try {
        client.compute().refreshTopology(false,false);
        break;
      }
 catch (      GridClientConnectionResetException e) {
        info("Exception caught: " + e);
      }
      int connects=0;
      for (int srv=0; srv < SERVERS_CNT; srv++) {
        if (srvs[srv].getSuccessfulConnectCount() > 0) {
          assertTrue("Failed server was contacted: " + srv,srv != failed);
          contactedSrv=srv;
        }
        connects+=srvs[srv].getSuccessfulConnectCount();
      }
      assertEquals(1,connects);
      srvs[failed].repair();
      srvs[contactedSrv].resetCounters();
    }
  }
 }
