{
  ByteBuffer buf=ByteBuffer.allocate(8 * 1024);
  DirectMessageWriter w=new DirectMessageWriter(proto);
  m.writeTo(buf,w);
  buf.flip();
  DirectMessageReader r=new DirectMessageReader(new GridIoMessageFactory(null),proto);
  r.setBuffer(buf);
  Message mx=r.readMessage(null);
  assertEquals(m,mx);
}
