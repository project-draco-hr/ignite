{
  Object obj=new SomeSerializable(null);
  ((Map)U.staticField(IgniteOptimizedMarshallerUtils.class,"CLS_DESC_CACHE")).clear();
  IgniteOptimizedClassResolver.userClasses(null,null);
  GridMarshaller marsh=new IgniteOptimizedMarshaller();
  int size1=marsh.marshal(obj).length;
  ((Map)U.staticField(IgniteOptimizedMarshallerUtils.class,"CLS_DESC_CACHE")).clear();
  IgniteOptimizedClassResolver.userClasses(null,null);
  IgniteOptimizedMarshaller marshPreregistered=new IgniteOptimizedMarshaller();
  File namesFile=File.createTempFile("gg-",null);
  U.writeStringToFile(namesFile,SomeSerializable.class.getName(),"UTF-8");
  marshPreregistered.setClassNamesPath(namesFile.getAbsolutePath());
  int size2=marshPreregistered.marshal(obj).length;
  assertTrue(size1 > size2);
}
