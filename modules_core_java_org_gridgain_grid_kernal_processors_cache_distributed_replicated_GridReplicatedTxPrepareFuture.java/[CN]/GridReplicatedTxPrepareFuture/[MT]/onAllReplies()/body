{
  tx.state(PREPARED);
  if (!isDone()) {
    Collection<GridCacheTxEntry<K,V>> checkEntries=tx.groupLock() ? Collections.singletonList(tx.groupLockEntry()) : tx.writeEntries();
    for (    GridCacheTxEntry<K,V> txEntry : checkEntries) {
      while (true) {
        GridDistributedCacheEntry<K,V> entry=(GridDistributedCacheEntry<K,V>)txEntry.cached();
        try {
          GridCacheMvccCandidate<K> c=entry.readyLock(tx.xidVersion());
          if (log.isDebugEnabled())           log.debug("Current lock owner for entry [owner=" + c + ", entry="+ entry+ ']');
          break;
        }
 catch (        GridCacheEntryRemovedException ignored) {
          if (log.isDebugEnabled())           log.debug("Got removed entry in future onAllReplies method (will retry): " + txEntry);
          txEntry.cached(cctx.cache().entryEx(txEntry.key()),txEntry.keyBytes());
        }
      }
    }
  }
  onComplete();
}
