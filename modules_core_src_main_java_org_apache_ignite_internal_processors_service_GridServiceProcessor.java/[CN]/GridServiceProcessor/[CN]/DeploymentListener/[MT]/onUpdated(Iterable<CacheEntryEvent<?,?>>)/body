{
  depExe.submit(new BusyRunnable(){
    @Override public void run0(){
      for (      CacheEntryEvent<?,?> e : deps) {
        if (!(e.getKey() instanceof GridServiceDeploymentKey))         continue;
        GridServiceDeployment dep=(GridServiceDeployment)e.getValue();
        if (dep != null) {
          svcName.set(dep.configuration().getName());
          long topVer=ctx.discovery().topologyVersion();
          ClusterNode oldest=U.oldest(ctx.discovery().nodes(topVer),null);
          if (oldest.isLocal())           onDeployment(dep,topVer);
        }
 else {
          String name=((GridServiceDeploymentKey)e.getKey()).name();
          svcName.set(name);
          Collection<ServiceContextImpl> ctxs;
synchronized (locSvcs) {
            ctxs=locSvcs.remove(name);
          }
          if (ctxs != null) {
synchronized (ctxs) {
              cancel(ctxs,ctxs.size());
            }
          }
          GridFutureAdapter<?> fut=depFuts.remove(name);
          if (fut != null)           fut.onDone();
          fut=undepFuts.remove(name);
          if (fut != null)           fut.onDone();
          GridServiceAssignmentsKey key=new GridServiceAssignmentsKey(name);
          if (cache.cache().affinity().isPrimary(ctx.discovery().localNode(),key)) {
            try {
              cache.getAndRemove(key);
            }
 catch (            IgniteCheckedException ex) {
              log.error("Failed to remove assignments for undeployed service: " + name,ex);
            }
          }
        }
      }
    }
  }
);
}
