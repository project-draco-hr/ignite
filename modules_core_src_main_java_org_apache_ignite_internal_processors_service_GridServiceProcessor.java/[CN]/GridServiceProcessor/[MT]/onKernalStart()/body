{
  if (ctx.isDaemon())   return;
  cache=ctx.cache().utilityCache();
  if (!ctx.clientNode())   ctx.event().addLocalEventListener(topLsnr,EVTS_DISCOVERY);
  try {
    if (ctx.deploy().enabled())     ctx.cache().context().deploy().ignoreOwnership(true);
    cfgQryId=cache.context().continuousQueries().executeInternalQuery(new DeploymentListener(),null,cache.context().affinityNode(),true);
    assignQryId=cache.context().continuousQueries().executeInternalQuery(new AssignmentListener(),null,cache.context().affinityNode(),true);
  }
  finally {
    if (ctx.deploy().enabled())     ctx.cache().context().deploy().ignoreOwnership(false);
  }
  ServiceConfiguration[] cfgs=ctx.config().getServiceConfiguration();
  if (cfgs != null) {
    Collection<IgniteInternalFuture<?>> futs=new ArrayList<>();
    for (    ServiceConfiguration c : ctx.config().getServiceConfiguration())     futs.add(deploy(c));
    for (    IgniteInternalFuture<?> f : futs)     f.get();
  }
  if (log.isDebugEnabled())   log.debug("Started service processor.");
}
