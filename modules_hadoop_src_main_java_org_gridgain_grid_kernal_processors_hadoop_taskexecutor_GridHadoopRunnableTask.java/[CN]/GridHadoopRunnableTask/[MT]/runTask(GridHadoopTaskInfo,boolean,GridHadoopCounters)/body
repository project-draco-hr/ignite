{
  if (cancelled)   throw new GridHadoopTaskCancelledException("Task cancelled.");
  GridHadoopTaskContext ctx=job.getTaskContext(info);
  try (GridHadoopTaskOutput out=createOutput(ctx,locCombiner);GridHadoopTaskInput in=createInput(ctx,locCombiner)){
    ctx.input(in);
    ctx.output(out);
    ctx.counters(counters);
    task=job.createTask(info);
    if (cancelled)     throw new GridHadoopTaskCancelledException("Task cancelled.");
    ClassLoader prevClsLdr=null;
    try {
      prevClsLdr=Thread.currentThread().getContextClassLoader();
      Thread.currentThread().setContextClassLoader(((GridHadoopV2TaskContext)ctx).jobConf().getClassLoader());
      task.run(ctx,log);
    }
  finally {
      Thread.currentThread().setContextClassLoader(prevClsLdr);
    }
  }
 }
