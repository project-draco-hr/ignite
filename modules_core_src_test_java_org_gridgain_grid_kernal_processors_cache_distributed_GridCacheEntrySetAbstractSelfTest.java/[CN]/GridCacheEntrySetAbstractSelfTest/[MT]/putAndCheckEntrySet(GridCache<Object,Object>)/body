{
  try (IgniteTx tx=cache.txStart(PESSIMISTIC,REPEATABLE_READ)){
    Integer total=(Integer)cache.get(TX_KEY);
    if (total == null)     total=0;
    int cntr=0;
    Set<GridCacheEntry<Object,Object>> entries=cache.entrySet();
    for (    GridCacheEntry e : entries) {
      if (e.getKey() instanceof Integer)       cntr++;
    }
    assertEquals(total,(Integer)cntr);
    cache.putx(cntr + 1,cntr + 1);
    cache.putx(TX_KEY,cntr + 1);
    tx.commit();
  }
 }
