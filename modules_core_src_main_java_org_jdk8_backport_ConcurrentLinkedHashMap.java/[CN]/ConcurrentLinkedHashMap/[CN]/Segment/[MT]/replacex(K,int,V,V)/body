{
  writeLock().lock();
  V replaced=null;
  try {
    HashEntry<K,V> e=getFirst(hash);
    while (e != null && (e.hash != hash || !key.equals(e.key)))     e=e.next;
    if (e != null) {
      if (oldVal.equals(e.val)) {
        replaced=oldVal;
        e.val=newVal;
      }
 else       replaced=e.val;
    }
  }
  finally {
    writeLock().unlock();
  }
  return replaced;
}
