{
  if (msg instanceof GridHadoopShuffleMessage) {
    GridHadoopShuffleMessage m=(GridHadoopShuffleMessage)msg;
    try {
      job(m.jobId()).onShuffleMessage(m);
    }
 catch (    GridException e) {
      U.error(log,"Message handling failed.",e);
    }
    send0(src,new GridHadoopShuffleAck(m.id(),m.jobId()));
  }
 else   if (msg instanceof GridHadoopShuffleAck) {
    GridHadoopShuffleAck m=(GridHadoopShuffleAck)msg;
    GridBiTuple<GridHadoopShuffleMessage,GridFutureAdapterEx<?>> t=sentMsgs.remove(m.id());
    if (t != null)     t.get2().onDone();
  }
 else   throw new IllegalStateException("Unknown message type received to Hadoop shuffle [src=" + src + ", msg="+ msg+ ']');
  return true;
}
