{
  assertEquals(false,THREAD_LOCAL_ALLOC.isThreadLocalArrayAcquired());
  PortableMarshaller marsh0=createMarshaller();
  try (BinaryWriterExImpl writer=new BinaryWriterExImpl(portableContext(marsh0))){
    assertEquals(true,THREAD_LOCAL_ALLOC.isThreadLocalArrayAcquired());
    writer.writeString("Thread local test");
    writer.array();
    assertEquals(true,THREAD_LOCAL_ALLOC.isThreadLocalArrayAcquired());
  }
   assertEquals(false,THREAD_LOCAL_ALLOC.isThreadLocalArrayAcquired());
  PortableMarshaller marsh=createMarshaller();
  marsh.marshal(new SimpleObject());
  assertEquals(false,THREAD_LOCAL_ALLOC.isThreadLocalArrayAcquired());
  PortableMarshaller marsh2=createMarshaller();
  BinaryObjectBuilder builder=new BinaryObjectBuilderImpl(portableContext(marsh2),"org.gridgain.foo.bar.TestClass");
  builder.setField("a","1");
  BinaryObject portableObj=builder.build();
  assertEquals(false,THREAD_LOCAL_ALLOC.isThreadLocalArrayAcquired());
}
