{
  PortableMarshaller marsh1=createMarshaller();
  BinaryTypeConfiguration customMappingType=new BinaryTypeConfiguration(TestBinary.class.getName());
  customMappingType.setIdMapper(new BinaryIdMapper(){
    @Override public int typeId(    String clsName){
      String typeName;
      try {
        Method mtd=PortableContext.class.getDeclaredMethod("typeName",String.class);
        mtd.setAccessible(true);
        typeName=(String)mtd.invoke(null,clsName);
      }
 catch (      NoSuchMethodException|InvocationTargetException|IllegalAccessException e) {
        throw new RuntimeException(e);
      }
      return typeName.toLowerCase().hashCode();
    }
    @Override public int fieldId(    int typeId,    String fieldName){
      return fieldName.toLowerCase().hashCode();
    }
  }
);
  marsh1.setTypeConfigurations(Arrays.asList(new BinaryTypeConfiguration(SimpleObject.class.getName()),customMappingType));
  TestBinary obj=binaryObject();
  BinaryObjectImpl po=marshal(obj,marsh1);
  PortableMarshaller marsh2=createMarshaller();
  marsh2.setTypeConfigurations(Arrays.asList(new BinaryTypeConfiguration(SimpleObject.class.getName()),new BinaryTypeConfiguration(TestBinary.class.getName())));
  PortableContext ctx=initializePortableContext(marsh2);
  po.context(ctx);
  assertEquals(obj,po.deserialize());
}
