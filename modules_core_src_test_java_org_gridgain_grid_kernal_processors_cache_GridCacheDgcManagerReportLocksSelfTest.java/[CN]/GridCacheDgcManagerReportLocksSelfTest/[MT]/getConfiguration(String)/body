{
  GridConfiguration cfg=super.getConfiguration(gridName);
  GridCacheConfiguration repCacheCfg=defaultCacheConfiguration();
  repCacheCfg.setName("replicated");
  repCacheCfg.setCacheMode(REPLICATED);
  repCacheCfg.setPreloadMode(SYNC);
  repCacheCfg.setDgcFrequency(DGC_FREQ);
  repCacheCfg.setDgcSuspectLockTimeout(DGC_SUSPECT_LOCK_TIMEOUT);
  repCacheCfg.setDgcRemoveLocks(false);
  repCacheCfg.setDefaultTxConcurrency(PESSIMISTIC);
  repCacheCfg.setWriteSynchronizationMode(GridCacheWriteSynchronizationMode.FULL_ASYNC);
  repCacheCfg.setEvictionPolicy(null);
  GridCacheConfiguration partCacheCfg=defaultCacheConfiguration();
  partCacheCfg.setName("partitioned");
  partCacheCfg.setCacheMode(PARTITIONED);
  partCacheCfg.setPreloadMode(SYNC);
  partCacheCfg.setDgcFrequency(DGC_FREQ);
  partCacheCfg.setDgcSuspectLockTimeout(DGC_SUSPECT_LOCK_TIMEOUT);
  partCacheCfg.setDgcRemoveLocks(false);
  partCacheCfg.setDefaultTxConcurrency(PESSIMISTIC);
  partCacheCfg.setWriteSynchronizationMode(GridCacheWriteSynchronizationMode.FULL_ASYNC);
  partCacheCfg.setEvictionPolicy(null);
  partCacheCfg.setNearEvictionPolicy(null);
  partCacheCfg.setAffinity(new GridCacheModuloAffinityFunction(NODES_CNT,1));
  partCacheCfg.setAtomicityMode(TRANSACTIONAL);
  partCacheCfg.setDistributionMode(NEAR_PARTITIONED);
  cfg.setCacheConfiguration(repCacheCfg,partCacheCfg);
  GridTcpDiscoverySpi discoSpi=new GridTcpDiscoverySpi();
  discoSpi.setIpFinder(ipFinder);
  cfg.setDiscoverySpi(discoSpi);
  cfg.setCommunicationSpi(new TestCommunicationSpi());
  cfg.setUserAttributes(F.asMap(GridCacheModuloAffinityFunction.IDX_ATTR,cntr.getAndIncrement()));
  return cfg;
}
