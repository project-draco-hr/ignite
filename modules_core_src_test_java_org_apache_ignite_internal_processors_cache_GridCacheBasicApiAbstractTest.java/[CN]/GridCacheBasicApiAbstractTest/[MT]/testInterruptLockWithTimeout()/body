{
  final IgniteCache<Integer,String> cache=ignite.jcache(null);
  cache.lock(2).lock();
  final AtomicBoolean isOk=new AtomicBoolean(false);
  Thread t=new Thread(new Runnable(){
    @Override public void run(){
      try {
        cache.lockAll(Arrays.asList(1,2)).tryLock(5000,MILLISECONDS);
      }
 catch (      InterruptedException ignored) {
        isOk.set(true);
      }
    }
  }
);
  t.start();
  Thread.sleep(100);
  t.interrupt();
  t.join();
  cache.lock(2).unlock();
  assertFalse(cache.isLocalLocked(1,false));
  assertFalse(cache.isLocalLocked(2,false));
  assertTrue(isOk.get());
}
