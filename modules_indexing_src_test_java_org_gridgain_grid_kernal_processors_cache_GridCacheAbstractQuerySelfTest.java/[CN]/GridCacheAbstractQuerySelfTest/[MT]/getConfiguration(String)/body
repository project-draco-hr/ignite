{
  IgniteConfiguration c=super.getConfiguration(gridName);
  TcpDiscoverySpi disco=new TcpDiscoverySpi();
  disco.setIpFinder(ipFinder);
  c.setDiscoverySpi(disco);
  GridQueryConfiguration idxCfg=new GridQueryConfiguration();
  idxCfg.setIndexCustomFunctionClasses(SqlFunctions.class);
  c.setQueryConfiguration(idxCfg);
  c.setSwapSpaceSpi(new FileSwapSpaceSpi());
  c.setMarshaller(new IgniteOptimizedMarshaller(false));
  CacheConfiguration[] ccs=new CacheConfiguration[2];
  for (int i=0; i < ccs.length; i++) {
    CacheConfiguration cc=defaultCacheConfiguration();
    if (i > 0)     cc.setName("c" + i);
    cc.setCacheMode(cacheMode());
    cc.setAtomicityMode(atomicityMode());
    cc.setDistributionMode(gridName.startsWith("client") ? CLIENT_ONLY : distributionMode());
    cc.setWriteSynchronizationMode(FULL_SYNC);
    cc.setCacheStoreFactory(new FactoryBuilder.SingletonFactory(store));
    cc.setReadThrough(true);
    cc.setWriteThrough(true);
    cc.setLoadPreviousValue(true);
    cc.setPreloadMode(SYNC);
    cc.setSwapEnabled(true);
    cc.setEvictNearSynchronized(false);
    GridCacheQueryConfiguration qcfg=new GridCacheQueryConfiguration();
    qcfg.setIndexPrimitiveKey(true);
    qcfg.setIndexFixedTyping(true);
    cc.setQueryConfiguration(qcfg);
    if (cacheMode() == GridCacheMode.PARTITIONED)     cc.setBackups(gridCount());
    ccs[i]=cc;
  }
  c.setCacheConfiguration(ccs);
  return c;
}
