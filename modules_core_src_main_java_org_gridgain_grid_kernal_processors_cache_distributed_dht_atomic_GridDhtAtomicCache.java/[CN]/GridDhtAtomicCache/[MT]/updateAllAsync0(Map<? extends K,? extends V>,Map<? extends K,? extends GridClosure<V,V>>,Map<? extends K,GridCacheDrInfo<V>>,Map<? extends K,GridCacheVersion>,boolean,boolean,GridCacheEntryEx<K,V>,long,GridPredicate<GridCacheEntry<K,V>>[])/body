{
  validateCacheKeys(map.keySet());
  ctx.checkSecurity(GridSecurityPermission.CACHE_PUT);
  UUID subjId=ctx.subjectIdPerCall(null);
  int taskNameHash=ctx.kernalContext().job().currentTaskNameHash();
  final GridNearAtomicUpdateFuture<K,V> updateFut=new GridNearAtomicUpdateFuture<>(ctx,this,ctx.config().getWriteSynchronizationMode(),transformMap != null ? TRANSFORM : UPDATE,map != null ? map.keySet() : transformMap != null ? transformMap.keySet() : drPutMap != null ? drPutMap.keySet() : drRmvMap.keySet(),map != null ? map.values() : transformMap != null ? transformMap.values() : null,drPutMap != null ? drPutMap.values() : null,drRmvMap != null ? drRmvMap.values() : null,retval,rawRetval,cached,ttl,filter,subjId,taskNameHash);
  return asyncOp(new CO<GridFuture<Object>>(){
    @Override public GridFuture<Object> apply(){
      updateFut.map();
      return updateFut;
    }
  }
);
}
