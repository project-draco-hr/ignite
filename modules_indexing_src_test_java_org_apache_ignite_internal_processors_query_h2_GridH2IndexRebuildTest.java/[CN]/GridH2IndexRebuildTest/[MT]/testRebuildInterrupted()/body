{
  spi.sleepInRebuild=true;
  GridCache<Integer,TestValue1> cache1=((IgniteKernal)grid(0)).cache(null);
  GridCache<Integer,TestValue2> cache2=((IgniteKernal)grid(0)).cache(null);
  cache1.put(0,new TestValue1(0,"val0",0,0));
  cache2.put(1,new TestValue2(0,"val0"));
  checkCancel(((IgniteKernal)grid(0)).cache(null).queries().rebuildIndexes("TestValue1"));
  checkCancel(((IgniteKernal)grid(0)).cache(null).queries().rebuildAllIndexes());
  spi.sleepInRebuild=false;
  final IgniteInternalFuture<?> fut1=((IgniteKernal)grid(0)).cache(null).queries().rebuildIndexes(TestValue1.class);
  assertFalse(fut1.isCancelled());
  fut1.get();
  final IgniteInternalFuture<?> fut2=((IgniteKernal)grid(0)).cache(null).queries().rebuildAllIndexes();
  assertFalse(fut2.isCancelled());
  fut2.get();
}
