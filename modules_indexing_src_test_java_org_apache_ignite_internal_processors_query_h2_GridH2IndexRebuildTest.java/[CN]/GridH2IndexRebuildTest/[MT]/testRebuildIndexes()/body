{
  ((IgniteKernal)grid(0)).internalCache(null).queries().rebuildIndexes(ArrayList.class).get();
  ((IgniteKernal)grid(0)).internalCache(null).queries().rebuildAllIndexes().get();
  IgniteCache<Integer,TestValue1> cache1=grid(0).cache(null);
  IgniteCache<Integer,TestValue2> cache2=grid(0).cache(null);
  for (int i=0; i < ENTRY_CNT; i++) {
    cache1.put(i,new TestValue1(i,"val2-" + i,i,i));
    cache2.put(ENTRY_CNT * 2 + i,new TestValue2(i,"val2-" + i));
  }
  SqlQuery<Integer,TestValue1> qry1=new SqlQuery(TestValue1.class,"val1 = 9000");
  SqlQuery<Integer,TestValue1> qry2=new SqlQuery(TestValue1.class,"val2 = 'val2-9000'");
  SqlQuery<Integer,TestValue1> qry3=new SqlQuery(TestValue1.class,"val3 = 9000 and val4 = 9000");
  SqlQuery<Integer,TestValue2> qry4=new SqlQuery(TestValue2.class,"val1 = 9000");
  SqlQuery<Integer,TestValue2> qry5=new SqlQuery(TestValue2.class,"val2 = 'val2-9000'");
  assertEquals(1,cache1.query(qry1).getAll().size());
  assertEquals(1,cache1.query(qry2).getAll().size());
  assertEquals(1,cache1.query(qry3).getAll().size());
  assertEquals(1,cache2.query(qry4).getAll().size());
  assertEquals(1,cache2.query(qry5).getAll().size());
  for (int i=0; i < ENTRY_CNT / 2; i++) {
    cache1.remove(i);
    cache2.remove(ENTRY_CNT * 2 + i);
  }
  ((IgniteKernal)grid(0)).internalCache(null).queries().rebuildIndexes(TestValue1.class).get();
  ((IgniteKernal)grid(0)).internalCache(null).queries().rebuildIndexes(TestValue2.class).get();
  assertEquals(1,cache1.query(qry1).getAll().size());
  assertEquals(1,cache1.query(qry2).getAll().size());
  assertEquals(1,cache1.query(qry3).getAll().size());
  assertEquals(1,cache2.query(qry4).getAll().size());
  assertEquals(1,cache2.query(qry5).getAll().size());
  ((IgniteKernal)grid(0)).internalCache(null).queries().rebuildAllIndexes().get();
  assertEquals(1,cache1.query(qry1).getAll().size());
  assertEquals(1,cache1.query(qry2).getAll().size());
  assertEquals(1,cache1.query(qry3).getAll().size());
  assertEquals(1,cache2.query(qry4).getAll().size());
  assertEquals(1,cache2.query(qry5).getAll().size());
}
