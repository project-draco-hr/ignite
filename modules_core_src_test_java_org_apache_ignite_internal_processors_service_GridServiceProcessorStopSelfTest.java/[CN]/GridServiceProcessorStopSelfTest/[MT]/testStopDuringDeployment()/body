{
  final CountDownLatch depLatch=new CountDownLatch(1);
  final CountDownLatch finishLatch=new CountDownLatch(1);
  final Ignite ignite=startGrid(0);
  IgniteInternalFuture<?> fut=GridTestUtils.runAsync(new Callable<Void>(){
    @Override public Void call() throws Exception {
      IgniteServices svcs=ignite.services();
      IgniteServices services=svcs.withAsync();
      services.deployClusterSingleton("myClusterSingletonService",new TestServiceImpl());
      depLatch.countDown();
      try {
        services.future().get();
      }
 catch (      IgniteException e) {
        finishLatch.countDown();
      }
 finally {
        finishLatch.countDown();
      }
      return null;
    }
  }
,"deploy-thread");
  depLatch.await();
  Ignition.stopAll(true);
  boolean wait=finishLatch.await(15,TimeUnit.SECONDS);
  if (!wait)   U.dumpThreads(log);
  assertTrue("Deploy future isn't completed",wait);
  fut.get();
}
