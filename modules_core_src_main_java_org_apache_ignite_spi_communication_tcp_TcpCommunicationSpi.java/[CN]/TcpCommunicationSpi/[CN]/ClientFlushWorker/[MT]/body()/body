{
  while (!isInterrupted()) {
    long connBufFlushFreq0=connBufFlushFreq;
    for (    Map.Entry<UUID,GridCommunicationClient> entry : clients.entrySet()) {
      GridCommunicationClient client=entry.getValue();
      if (client.reserve()) {
        boolean err=true;
        try {
          client.flushIfNeeded(connBufFlushFreq0);
          err=false;
        }
 catch (        IOException e) {
          if (getSpiContext().pingNode(entry.getKey()))           U.error(log,"Failed to flush client: " + client,e);
 else {
            if (log.isDebugEnabled())             log.debug("Failed to flush client (node left): " + client);
            onException("Failed to flush client (node left): " + client,e);
          }
        }
 finally {
          if (err)           client.forceClose();
 else           client.release();
        }
      }
    }
    Thread.sleep(connBufFlushFreq0);
  }
}
