{
  if (!rw.tryReadLock())   return;
  try {
    lastSnapshot=new T2<>(snapshot.version(),snapshot);
    timeSyncHist.put(snapshot.version(),snapshot);
    for (    ClusterNode n : top.topologyNodes()) {
      GridClockDeltaSnapshotMessage msg=new GridClockDeltaSnapshotMessage(snapshot.version(),snapshot.deltas());
      try {
        ctx.io().send(n,TOPIC_TIME_SYNC,msg,SYSTEM_POOL);
      }
 catch (      IgniteCheckedException e) {
        if (ctx.discovery().pingNodeNoError(n.id()))         U.error(log,"Failed to send time sync snapshot to remote node (did not leave grid?) " + "[nodeId=" + n.id() + ", msg="+ msg+ ", err="+ e.getMessage()+ ']');
 else         if (log.isDebugEnabled())         log.debug("Failed to send time sync snapshot to remote node (did not leave grid?) " + "[nodeId=" + n.id() + ", msg="+ msg+ ", err="+ e.getMessage()+ ']');
      }
    }
  }
  finally {
    rw.readUnlock();
  }
}
