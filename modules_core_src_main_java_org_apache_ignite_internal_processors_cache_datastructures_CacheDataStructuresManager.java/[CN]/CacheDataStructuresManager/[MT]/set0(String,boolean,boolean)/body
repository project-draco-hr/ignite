{
  cctx.gate().enter();
  try {
    GridCacheSetHeaderKey key=new GridCacheSetHeaderKey(name);
    GridCacheSetHeader hdr;
    IgniteInternalCache cache=cctx.cache().withNoRetries();
    if (create) {
      hdr=new GridCacheSetHeader(IgniteUuid.randomUuid(),collocated);
      GridCacheSetHeader old=(GridCacheSetHeader)cache.getAndPutIfAbsent(key,hdr);
      if (old != null)       hdr=old;
    }
 else     hdr=(GridCacheSetHeader)cache.get(key);
    if (hdr == null)     return null;
    GridCacheSetProxy<T> set=setsMap.get(hdr.id());
    if (set == null) {
      GridCacheSetProxy<T> old=setsMap.putIfAbsent(hdr.id(),set=new GridCacheSetProxy<>(cctx,new GridCacheSetImpl<T>(cctx,name,hdr)));
      if (old != null)       set=old;
    }
    return set;
  }
  finally {
    cctx.gate().leave();
  }
}
