{
  String ggHome=getGridGainHome();
  File dir=new File(path);
  if (!dir.isAbsolute()) {
    if (F.isEmpty(ggHome)) {
      if (failOnEmptyGridGainHome)       throw new GridException("Failed to create directory, property " + GG_HOME + " is null.");
      String tmpDirPath=System.getProperty("java.io.tmpdir");
      if (tmpDirPath == null)       throw new GridException("System property 'java.io.tmpdir' is null.");
      dir=tmpSubDir == null ? new File(tmpDirPath) : new File(tmpDirPath,tmpSubDir);
    }
 else     dir=new File(ggHome,dir.getPath());
  }
  if (deleteIfExist && dir.exists()) {
    if (!U.delete(dir))     throw new GridException("Failed to delete directory: " + dir);
  }
  if (!mkdirs(dir))   throw new GridException("Directory does not exist and cannot be created: " + dir);
  if (!dir.canRead())   throw new GridException("Cannot read from directory: " + dir);
  if (!dir.canWrite())   throw new GridException("Cannot write to directory: " + dir);
  return dir;
}
