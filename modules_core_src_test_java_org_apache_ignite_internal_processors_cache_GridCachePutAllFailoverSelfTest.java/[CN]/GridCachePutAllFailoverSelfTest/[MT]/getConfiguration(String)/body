{
  IgniteConfiguration cfg=super.getConfiguration(gridName);
  cfg.setPeerClassLoadingEnabled(false);
  cfg.setDeploymentMode(DeploymentMode.CONTINUOUS);
  TcpDiscoverySpi discoverySpi=new TcpDiscoverySpi();
  discoverySpi.setAckTimeout(60000);
  discoverySpi.setIpFinder(ipFinder);
  cfg.setDiscoverySpi(discoverySpi);
  if (gridName.startsWith("master")) {
    cfg.setUserAttributes(ImmutableMap.of("segment","master"));
    failoverSpi.setMaximumFailoverAttempts(50);
    cfg.setFailoverSpi(failoverSpi);
  }
 else   if (gridName.startsWith("worker")) {
    cfg.setUserAttributes(ImmutableMap.of("segment","worker"));
    CacheConfiguration cacheCfg=defaultCacheConfiguration();
    cacheCfg.setName("partitioned");
    cacheCfg.setCacheMode(CacheMode.PARTITIONED);
    cacheCfg.setStartSize(4500000);
    cacheCfg.setBackups(backups);
    cacheCfg.setNearConfiguration(nearEnabled ? new NearCacheConfiguration() : null);
    cacheCfg.setQueryIndexEnabled(false);
    cacheCfg.setWriteSynchronizationMode(FULL_SYNC);
    cfg.setCacheConfiguration(cacheCfg);
  }
 else   throw new IllegalStateException("Unexpected grid name: " + gridName);
  return cfg;
}
