{
  A.notNull(items,"items");
  try {
    boolean retVal;
    int cnt=0;
    while (true) {
      try (IgniteTx tx=txs.txStart(PESSIMISTIC,REPEATABLE_READ)){
        Long idx=(Long)cache.invoke(queueKey,new AddProcessor(id,items.size()));
        if (idx != null) {
          checkRemoved(idx);
          Map<GridCacheQueueItemKey,T> putMap=new HashMap<>();
          for (          T item : items) {
            putMap.put(itemKey(idx),item);
            idx++;
          }
          cache.putAll(putMap);
          retVal=true;
        }
 else         retVal=false;
        tx.commit();
        break;
      }
 catch (      CacheException e) {
        if (e.getCause() instanceof ClusterGroupEmptyException)         throw e;
        if (e.getCause() instanceof ClusterTopologyException) {
          if (cnt++ == MAX_UPDATE_RETRIES)           throw e;
 else {
            U.warn(log,"Failed to add item, will retry [err=" + e + ']');
            U.sleep(RETRY_DELAY);
          }
        }
 else         throw e;
      }
    }
    return retVal;
  }
 catch (  IgniteCheckedException e) {
    throw new IgniteException(e);
  }
}
