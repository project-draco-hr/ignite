{
  try {
    InetAddress.getLocalHost();
  }
 catch (  UnknownHostException ignored) {
    return;
  }
  int jmxPort=IgniteSystemProperties.getInteger(GG_JMX_PORT,-1);
  if (jmxPort != -1) {
    System.out.println(jmxPort);
    return;
  }
  RandomAccessFile ra=null;
  FileLock lock=null;
  try {
    File file=new File(System.getProperty("java.io.tmpdir"),"gridgain.lastport.tmp");
    file.setReadable(true,false);
    file.setWritable(true,false);
    ra=new RandomAccessFile(file,"rw");
    lock=ra.getChannel().lock();
    ra.seek(0);
    String startPortStr=ra.readLine();
    int startPort=MIN_PORT;
    if (startPortStr != null && !startPortStr.isEmpty()) {
      try {
        startPort=Integer.valueOf(startPortStr) + 1;
        if (startPort < MIN_PORT || startPort > MAX_PORT)         startPort=MIN_PORT;
      }
 catch (      NumberFormatException ignored) {
      }
    }
    int port=findPort(startPort);
    ra.setLength(0);
    ra.writeBytes(String.valueOf(port));
    System.out.println(port);
  }
 catch (  IOException ignored) {
  }
 finally {
    if (lock != null)     try {
      lock.release();
    }
 catch (    IOException ignored) {
    }
    if (ra != null)     try {
      ra.close();
    }
 catch (    IOException ignored) {
    }
  }
}
