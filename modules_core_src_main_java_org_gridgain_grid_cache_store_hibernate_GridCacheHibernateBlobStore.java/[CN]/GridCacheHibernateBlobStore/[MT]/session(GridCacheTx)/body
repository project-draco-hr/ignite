{
  Session ses;
  if (tx != null) {
    ses=tx.meta(ATTR_SES);
    if (ses == null) {
      ses=sesFactory.openSession();
      ses.beginTransaction();
      tx.addMeta(ATTR_SES,ses);
      if (log.isDebugEnabled())       log.debug("Hibernate session open [ses=" + ses + ", tx="+ tx.xid()+ "]");
    }
  }
 else {
    ses=sesFactory.openSession();
    ses.beginTransaction();
  }
  return ses;
}
