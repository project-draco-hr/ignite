{
  GridCache<Object,Object> dataCache=grid(0).cachex(DATA_CACHE_NAME);
  for (  GridGgfsBlockLocation loc : affinity) {
    info("Going to check GGFS block location: " + loc);
    int block=(int)(loc.start() / blockSize);
    int endPos;
    do {
      GridGgfsBlockKey key=new GridGgfsBlockKey(info.id(),info.fileMap().affinityKey(block * blockSize,false),false,block);
      GridNode affNode=dataCache.affinity().mapKeyToNode(key);
      assertTrue("Failed to find node in affinity [dataMgr=" + loc.nodeIds() + ", nodeId="+ affNode.id()+ ", block="+ block+ ']',loc.nodeIds().contains(affNode.id()));
      endPos=(block + 1) * blockSize;
      block++;
    }
 while (endPos < loc.start() + loc.length());
  }
}
