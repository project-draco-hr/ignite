{
  cacheEnabled=true;
  aff=new GridCachePartitionFairAffinity();
  GridTestUtils.assertThrows(log,new Callable<Object>(){
    @Override public Object call() throws Exception {
      return startGrid(1);
    }
  }
,GridException.class,null);
  aff=new GridCacheConsistentHashAffinityFunction(true);
  backups=Integer.MAX_VALUE;
  GridTestUtils.assertThrows(log,new Callable<Object>(){
    @Override public Object call() throws Exception {
      return startGrid(1);
    }
  }
,GridException.class,null);
  aff=new GridCacheConsistentHashAffinityFunction(false,100);
  startGrid(1);
  aff=new GridCacheConsistentHashAffinityFunction(false,200);
  GridTestUtils.assertThrows(log,new Callable<Object>(){
    @Override public Object call() throws Exception {
      return startGrid(2);
    }
  }
,GridException.class,"Affinity partitions count mismatch");
}
