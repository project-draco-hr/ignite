{
  Grid g0=grid(0);
  Grid g1=grid(1);
  Grid g2=grid(2);
  g0.cache(null).putAll(map);
  checkStore(g0,map);
  checkStore(g1,Collections.<Integer,String>emptyMap());
  checkStore(g2,Collections.<Integer,String>emptyMap());
  clearStores(3);
  GridCacheTx tx=g0.cache(null).txStart(OPTIMISTIC,READ_COMMITTED);
  try {
    g0.cache(null).putAll(map);
    tx.commit();
    checkStore(g0,map);
    checkStore(g1,Collections.<Integer,String>emptyMap());
    checkStore(g2,Collections.<Integer,String>emptyMap());
    clearStores(3);
  }
  finally {
    tx.close();
  }
}
