{
  IgniteConfiguration cfg=super.getConfiguration(gridName);
  cfg.setMarshaller(new OptimizedMarshaller(false));
  if (hasCache)   cfg.setCacheConfiguration(cache(null,null),cache(CACHE,null),cache(EMPTY_CACHE,null));
 else {
    cfg.setClientMode(true);
    cfg.setCacheConfiguration();
  }
  cfg.setDiscoverySpi(discovery());
  return cfg;
}
