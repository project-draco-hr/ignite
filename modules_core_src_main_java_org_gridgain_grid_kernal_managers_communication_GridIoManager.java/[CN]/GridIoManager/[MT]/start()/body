{
  assertParameter(discoDelay > 0,"discoveryStartupDelay > 0");
  startSpi();
  pubPool=ctx.config().getExecutorService();
  p2pPool=ctx.config().getPeerClassLoadingExecutorService();
  sysPool=ctx.config().getSystemExecutorService();
  mgmtPool=ctx.config().getManagementExecutorService();
  utilityCachePool=ctx.utilityCachePool();
  affPool=Executors.newFixedThreadPool(1);
  getSpi().setListener(commLsnr=new GridCommunicationListener<Serializable>(){
    @Override public void onMessage(    UUID nodeId,    Serializable msg,    IgniteRunnable msgC){
      try {
        onMessage0(nodeId,(GridIoMessage)msg,msgC);
      }
 catch (      ClassCastException ignored) {
        U.error(log,"Communication manager received message of unknown type (will ignore): " + msg.getClass().getName() + ". Most likely GridCommunicationSpi is being used directly, "+ "which is illegal - make sure to send messages only via GridProjection API.");
      }
    }
    @Override public void onDisconnected(    UUID nodeId){
      for (      GridDisconnectListener lsnr : disconnectLsnrs)       lsnr.onNodeDisconnected(nodeId);
    }
  }
);
  if (log.isDebugEnabled())   log.debug(startInfo());
}
