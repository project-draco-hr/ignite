{
  final GridCacheOperation op=transformMap != null ? TRANSFORM : UPDATE;
  final Collection<? extends K> keys=map != null ? map.keySet() : transformMap != null ? transformMap.keySet() : null;
  final Collection<?> vals=map != null ? map.values() : transformMap != null ? transformMap.values() : null;
  return asyncOp(new CO<GridFuture>(){
    @Override public GridFuture apply(){
      return ctx.closures().callLocalSafe(new Callable<Object>(){
        @Override public Object call() throws Exception {
          return updateAllInternal(op,keys,vals,ttl,retval,rawRetval,filter);
        }
      }
);
    }
  }
);
}
