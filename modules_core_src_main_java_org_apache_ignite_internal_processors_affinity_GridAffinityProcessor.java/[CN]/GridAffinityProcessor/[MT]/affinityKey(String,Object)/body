{
  if (key == null)   return null;
  AffinityInfo affInfo=affinityCache(cacheName,ctx.discovery().topologyVersion());
  if (affInfo == null || affInfo.mapper == null)   return null;
  if (affInfo.portableEnabled)   key=ctx.portable().marshalToPortable(key);
  return affInfo.mapper.affinityKey(key);
}
