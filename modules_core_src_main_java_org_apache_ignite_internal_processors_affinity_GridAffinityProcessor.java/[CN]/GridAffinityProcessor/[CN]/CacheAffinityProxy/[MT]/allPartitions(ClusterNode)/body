{
  ctx.gateway().readLock();
  try {
    Collection<Integer> parts=new HashSet<>();
    AffinityInfo affInfo=cache();
    for (int partsCnt=affInfo.affFunc.partitions(), part=0; part < partsCnt; part++) {
      for (      ClusterNode affNode : affInfo.assignment.get(part)) {
        if (n.id().equals(affNode.id())) {
          parts.add(part);
          break;
        }
      }
    }
    return U.toIntArray(parts);
  }
 catch (  IgniteCheckedException e) {
    throw new IgniteException(e);
  }
 finally {
    ctx.gateway().readUnlock();
  }
}
