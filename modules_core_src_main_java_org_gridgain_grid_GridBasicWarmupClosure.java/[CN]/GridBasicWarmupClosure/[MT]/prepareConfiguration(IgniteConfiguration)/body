{
  if (F.isEmpty(gridCfg.getCacheConfiguration()))   return null;
  IgniteConfiguration cp=new IgniteConfiguration();
  cp.setClientConnectionConfiguration(null);
  Collection<GridCacheConfiguration> reduced=new ArrayList<>();
  for (  GridCacheConfiguration ccfg : gridCfg.getCacheConfiguration()) {
    if (CU.isSystemCache(ccfg.getName()))     continue;
    if (!matches(reduced,ccfg)) {
      GridCacheConfiguration ccfgCp=new GridCacheConfiguration(ccfg);
      if (ccfgCp.getDistributionMode() == GridCacheDistributionMode.CLIENT_ONLY)       ccfgCp.setDistributionMode(GridCacheDistributionMode.PARTITIONED_ONLY);
 else       if (ccfgCp.getDistributionMode() == GridCacheDistributionMode.NEAR_ONLY)       ccfgCp.setDistributionMode(GridCacheDistributionMode.NEAR_PARTITIONED);
      ccfgCp.setStore(null);
      ccfgCp.setWriteBehindEnabled(false);
      reduced.add(ccfgCp);
    }
  }
  if (F.isEmpty(reduced))   return null;
  GridCacheConfiguration[] res=new GridCacheConfiguration[reduced.size()];
  reduced.toArray(res);
  cp.setCacheConfiguration(res);
  return cp;
}
