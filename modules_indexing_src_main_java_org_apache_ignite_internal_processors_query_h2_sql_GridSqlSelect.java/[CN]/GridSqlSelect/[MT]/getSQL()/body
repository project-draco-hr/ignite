{
  StatementBuilder buff=new StatementBuilder("SELECT");
  if (distinct)   buff.append(" DISTINCT");
  for (  GridSqlElement expression : select) {
    buff.appendExceptFirst(",");
    buff.append('\n');
    buff.append(StringUtils.indent(expression.getSQL(),4,false));
  }
  buff.append("\nFROM ").append(from.getSQL());
  if (where != null)   buff.append("\nWHERE ").append(StringUtils.unEnclose(where.getSQL()));
  if (!groups.isEmpty()) {
    buff.append("\nGROUP BY ");
    buff.resetCount();
    for (    GridSqlElement expression : groups) {
      buff.appendExceptFirst(", ");
      if (expression instanceof GridSqlAlias)       buff.append(StringUtils.unEnclose((expression.child().getSQL())));
 else       buff.append(StringUtils.unEnclose(expression.getSQL()));
    }
  }
  if (having != null)   buff.append("\nHAVING ").append(StringUtils.unEnclose(having.getSQL()));
  if (!sort.isEmpty()) {
    buff.append("\nORDER BY ");
    buff.resetCount();
    for (    Map.Entry<GridSqlElement,GridSqlSortColumn> entry : sort.entrySet()) {
      buff.appendExceptFirst(", ");
      GridSqlElement expression=entry.getKey();
      int idx=select.indexOf(expression);
      if (idx >= 0)       buff.append(idx + 1);
 else       buff.append('=').append(StringUtils.unEnclose(expression.getSQL()));
      GridSqlSortColumn type=entry.getValue();
      if (!type.asc())       buff.append(" DESC");
      if (type.nullsFirst())       buff.append(" NULLS FIRST");
 else       if (type.nullsLast())       buff.append(" NULLS LAST");
    }
  }
  if (limit != null)   buff.append(" LIMIT ").append(StringUtils.unEnclose(limit.getSQL()));
  if (offset != null)   buff.append(" OFFSET ").append(StringUtils.unEnclose(offset.getSQL()));
  return buff.toString();
}
