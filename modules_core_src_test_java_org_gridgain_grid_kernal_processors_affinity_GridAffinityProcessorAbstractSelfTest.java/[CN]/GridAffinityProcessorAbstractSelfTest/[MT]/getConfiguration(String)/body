{
  IgniteConfiguration cfg=super.getConfiguration(gridName);
  TcpDiscoverySpi discoSpi=new TcpDiscoverySpi();
  discoSpi.setIpFinder(ipFinder);
  cfg.setDiscoverySpi(discoSpi);
  if (withCache) {
    GridCacheConfiguration cacheCfg=defaultCacheConfiguration();
    cacheCfg.setName(CACHE_NAME);
    cacheCfg.setCacheMode(PARTITIONED);
    cacheCfg.setBackups(1);
    cacheCfg.setAffinity(affinityFunction());
    cfg.setCacheConfiguration(cacheCfg);
  }
  return cfg;
}
