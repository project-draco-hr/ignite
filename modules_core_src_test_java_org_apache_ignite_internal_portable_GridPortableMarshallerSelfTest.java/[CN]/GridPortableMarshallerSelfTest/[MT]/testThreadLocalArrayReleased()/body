{
  assertEquals(false,THREAD_LOCAL_ALLOC.isThreadLocalArrayAcquired());
  try (BinaryWriterExImpl writer=new BinaryWriterExImpl(initPortableContext(new PortableMarshaller()))){
    assertEquals(true,THREAD_LOCAL_ALLOC.isThreadLocalArrayAcquired());
    writer.writeString("Thread local test");
    writer.array();
    assertEquals(true,THREAD_LOCAL_ALLOC.isThreadLocalArrayAcquired());
  }
   assertEquals(false,THREAD_LOCAL_ALLOC.isThreadLocalArrayAcquired());
  PortableMarshaller marsh=new PortableMarshaller();
  initPortableContext(marsh);
  marsh.marshal(new SimpleObject());
  assertEquals(false,THREAD_LOCAL_ALLOC.isThreadLocalArrayAcquired());
  BinaryObjectBuilder builder=new BinaryObjectBuilderImpl(initPortableContext(new PortableMarshaller()),"org.gridgain.foo.bar.TestClass");
  builder.setField("a","1");
  BinaryObject portableObj=builder.build();
  assertEquals(false,THREAD_LOCAL_ALLOC.isThreadLocalArrayAcquired());
}
