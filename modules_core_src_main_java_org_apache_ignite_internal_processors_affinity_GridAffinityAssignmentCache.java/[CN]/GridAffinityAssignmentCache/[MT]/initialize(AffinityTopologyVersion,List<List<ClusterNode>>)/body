{
  GridAffinityAssignment assignment=new GridAffinityAssignment(topVer,affAssignment);
  affCache.put(topVer,assignment);
  head.set(assignment);
  for (  Map.Entry<AffinityTopologyVersion,AffinityReadyFuture> entry : readyFuts.entrySet()) {
    if (entry.getKey().compareTo(topVer) <= 0) {
      if (log.isDebugEnabled())       log.debug("Completing topology ready future (initialized affinity) " + "[locNodeId=" + ctx.localNodeId() + ", futVer="+ entry.getKey()+ ", topVer="+ topVer+ ']');
      entry.getValue().onDone(topVer);
    }
  }
}
