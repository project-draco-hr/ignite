{
  IgniteConfiguration cfg=super.getConfiguration(gridName);
  TcpDiscoverySpi discoSpi;
  if (clientMode) {
    discoSpi=new TcpDiscoverySpi(){
      @Override public TcpDiscoverySpi setNodeAttributes(      Map<String,Object> attrs,      IgniteProductVersion ver){
        super.setNodeAttributes(attrs,ver);
        attrs.put(IgniteNodeAttributes.ATTR_BUILD_VER,nodeVer);
        return this;
      }
    }
;
    discoSpi.setClientMode(true);
    cfg.setClientMode(true);
  }
 else {
    discoSpi=new TcpDiscoverySpi(){
      @Override public TcpDiscoverySpi setNodeAttributes(      Map<String,Object> attrs,      IgniteProductVersion ver){
        super.setNodeAttributes(attrs,ver);
        attrs.put(IgniteNodeAttributes.ATTR_BUILD_VER,nodeVer);
        return this;
      }
    }
;
  }
  discoSpi.setIpFinder(IP_FINDER);
  cfg.setDiscoverySpi(discoSpi);
  return cfg;
}
