{
  IgniteConfiguration cfg=super.getConfiguration(gridName);
  TcpDiscoverySpiAdapter discoSpi;
  if (clientMode) {
    discoSpi=new TcpClientDiscoverySpi(){
      @Override public void setNodeAttributes(      Map<String,Object> attrs,      IgniteProductVersion ver){
        super.setNodeAttributes(attrs,ver);
        attrs.put(IgniteNodeAttributes.ATTR_BUILD_VER,nodeVer);
      }
    }
;
  }
 else {
    discoSpi=new TcpDiscoverySpi(){
      @Override public void setNodeAttributes(      Map<String,Object> attrs,      IgniteProductVersion ver){
        super.setNodeAttributes(attrs,ver);
        attrs.put(IgniteNodeAttributes.ATTR_BUILD_VER,nodeVer);
      }
    }
;
  }
  discoSpi.setIpFinder(IP_FINDER);
  cfg.setDiscoverySpi(discoSpi);
  return cfg;
}
