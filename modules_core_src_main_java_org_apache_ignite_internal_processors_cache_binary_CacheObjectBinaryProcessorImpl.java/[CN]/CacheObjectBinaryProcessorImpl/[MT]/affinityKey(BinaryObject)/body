{
  if (po instanceof BinaryObjectEx) {
    int typeId=((BinaryObjectEx)po).typeId();
    T1<BinaryField> fieldHolder=affKeyFields.get(typeId);
    if (fieldHolder != null) {
      BinaryField field=fieldHolder.get();
      return field != null ? field.value(po) : po;
    }
  }
  try {
    BinaryType meta=po instanceof BinaryObjectEx ? ((BinaryObjectEx)po).rawType() : po.type();
    if (meta != null) {
      String name=meta.affinityKeyFieldName();
      affKeyFields.putIfAbsent(meta.typeId(),new T1<>(meta.field(name)));
      if (name != null)       return po.field(name);
    }
 else     if (po instanceof BinaryObjectEx) {
      int typeId=((BinaryObjectEx)po).typeId();
      String name=binaryCtx.affinityKeyFieldName(typeId);
      if (name != null)       return po.field(name);
    }
  }
 catch (  BinaryObjectException e) {
    U.error(log,"Failed to get affinity field from binary object: " + po,e);
  }
  return po;
}
