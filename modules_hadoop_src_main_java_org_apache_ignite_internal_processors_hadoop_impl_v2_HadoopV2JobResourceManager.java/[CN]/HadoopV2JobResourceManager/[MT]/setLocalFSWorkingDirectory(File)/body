{
  JobConf cfg=ctx.getJobConf();
  ClassLoader oldLdr=HadoopCommonUtils.setContextClassLoader(cfg.getClassLoader());
  try {
    cfg.set(HadoopFileSystemsUtils.LOC_FS_WORK_DIR_PROP,dir.getAbsolutePath());
    if (!cfg.getBoolean(FILE_DISABLE_CACHING_PROPERTY_NAME,false))     FileSystem.getLocal(cfg).setWorkingDirectory(new Path(dir.getAbsolutePath()));
  }
  finally {
    HadoopCommonUtils.restoreContextClassLoader(oldLdr);
  }
}
