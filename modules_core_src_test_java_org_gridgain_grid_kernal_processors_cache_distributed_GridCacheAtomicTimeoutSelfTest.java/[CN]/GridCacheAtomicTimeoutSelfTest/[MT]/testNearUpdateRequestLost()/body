{
  Grid grid=grid(0);
  TestCommunicationSpi commSpi=(TestCommunicationSpi)grid(0).configuration().getCommunicationSpi();
  GridCache<Object,Object> cache=grid.cache(null);
  int key=keyForTest();
  cache.put(key,0);
  commSpi.skipNearRequest=true;
  GridFuture<Object> fut=cache.putAsync(key,1);
  Map<UUID,GridCommunicationClient> clients=U.field(commSpi,"clients");
  GridTcpNioCommunicationClient client=(GridTcpNioCommunicationClient)clients.get(grid(1).localNode().id());
  client.session().close().get();
  try {
    fut.get();
    fail();
  }
 catch (  GridCacheAtomicUpdateTimeoutException ignore) {
  }
}
