{
  Map<String,Object> hdr=new HashMap<>();
  Map<String,Object> body=new HashMap<>(params);
  hdr.put("clientId",clientId.toString());
  if (destId != null)   hdr.put("destId",destId.toString());
  if (sesTok != null)   hdr.put("sessionToken",sesTok);
 else   if (credentials() != null)   body.put("cred",credentials());
  String uri=(sslContext() == null ? "http://" : "https://") + serverAddress().getHostName() + ':'+ serverAddress().getPort()+ "/gridgain?"+ encodeParams(hdr);
  HttpURLConnection conn=(HttpURLConnection)new URL(uri).openConnection();
  conn.setConnectTimeout(connTimeout);
  conn.setReadTimeout(readTimeout);
  if (sslContext() != null) {
    ((HttpsURLConnection)conn).setSSLSocketFactory(sslContext().getSocketFactory());
    conn.setRequestProperty("Connection","Close");
  }
  conn.setDoOutput(true);
  conn.setRequestMethod("POST");
  conn.setRequestProperty("Accept-Charset","UTF-8");
  conn.setRequestProperty("Content-Type","application/x-www-form-urlencoded;charset=UTF-8");
  OutputStream output=null;
  try {
    output=conn.getOutputStream();
    output.write(encodeParams(body).toString().getBytes("UTF-8"));
    output.flush();
  }
  finally {
    GridClientUtils.closeQuiet(output);
  }
  return conn;
}
