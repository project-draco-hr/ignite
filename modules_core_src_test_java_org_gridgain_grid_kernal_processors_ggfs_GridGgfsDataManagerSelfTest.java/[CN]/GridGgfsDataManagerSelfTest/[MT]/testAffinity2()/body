{
  int blockSize=BLOCK_SIZE;
  GridGgfsFileInfo info=new GridGgfsFileInfo(blockSize,1024 * 1024,null,null,false,null);
  Collection<IgniteFsBlockLocation> affinity=mgr.affinity(info,0,info.length());
  for (  IgniteFsBlockLocation loc : affinity) {
    info("Going to check GGFS block location: " + loc);
    int block=(int)(loc.start() / blockSize);
    int endPos;
    do {
      GridGgfsBlockKey key=new GridGgfsBlockKey(info.id(),null,false,block);
      ClusterNode affNode=grid(0).cachex(DATA_CACHE_NAME).affinity().mapKeyToNode(key);
      assertTrue("Failed to find node in affinity [dataMgr=" + loc.nodeIds() + ", nodeId="+ affNode.id()+ ", block="+ block+ ']',loc.nodeIds().contains(affNode.id()));
      endPos=(block + 1) * blockSize;
      block++;
    }
 while (endPos < loc.start() + loc.length());
  }
}
