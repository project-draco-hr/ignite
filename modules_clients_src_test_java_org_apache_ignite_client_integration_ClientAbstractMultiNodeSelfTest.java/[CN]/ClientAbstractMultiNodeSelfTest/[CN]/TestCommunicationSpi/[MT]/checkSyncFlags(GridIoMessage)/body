{
  if (!commSpiEnabled)   return;
  Object o=msg.message();
  if (!(o instanceof GridDistributedLockRequest))   return;
  IgniteKernal g=(IgniteKernal)G.ignite(ignite.configuration().getNodeId());
  GridCacheContext<Object,Object> cacheCtx=g.internalCache(REPLICATED_ASYNC_CACHE_NAME).context();
  IgniteTxManager<Object,Object> tm=cacheCtx.tm();
  GridCacheVersion v=((GridCacheVersionable)o).version();
  IgniteTxEx t=tm.tx(v);
  if (t.hasWriteKey(cacheCtx.txKey("x1")))   assertFalse("Invalid tx flags: " + t,t.syncCommit());
 else   if (t.hasWriteKey(cacheCtx.txKey("x2")))   assertTrue("Invalid tx flags: " + t,t.syncCommit());
 else   if (t.hasWriteKey(cacheCtx.txKey("x3")))   assertFalse("Invalid tx flags: " + t,t.syncCommit());
 else   if (t.hasWriteKey(cacheCtx.txKey("x4")))   assertTrue("Invalid tx flags: " + t,t.syncCommit());
}
