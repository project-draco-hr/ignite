{
  if (initGuard.compareAndSet(false,true)) {
    try {
      NetHttpTransport httpTransport;
      try {
        httpTransport=GoogleNetHttpTransport.newTrustedTransport();
      }
 catch (      GeneralSecurityException|IOException e) {
        throw new IgniteSpiException(e);
      }
      GoogleCredential credential;
      try {
        credential=new GoogleCredential.Builder().setTransport(httpTransport).setJsonFactory(JacksonFactory.getDefaultInstance()).setServiceAccountId(serviceAccountId).setServiceAccountPrivateKeyFromP12File(new File(serviceAccountP12FilePath)).setServiceAccountScopes(Collections.singleton(StorageScopes.DEVSTORAGE_READ_WRITE)).build();
      }
 catch (      Exception e) {
        throw new IgniteSpiException("Failed to authenticate on Google Cloud Platform",e);
      }
      try {
        storage=new Storage.Builder(httpTransport,JacksonFactory.getDefaultInstance(),credential).setApplicationName(projectName).build();
      }
 catch (      Exception e) {
        throw new IgniteSpiException("Failed to open a storage for given project name: " + projectName);
      }
    }
  finally {
      initLatch.countDown();
    }
  }
 else {
    try {
      U.await(initLatch);
    }
 catch (    IgniteInterruptedCheckedException e) {
      throw new IgniteSpiException("Thread has been interrupted.",e);
    }
    if (storage == null)     throw new IgniteSpiException("IpFinder has not been initialized properly");
  }
}
