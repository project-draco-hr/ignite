{
  checkObsolete();
  if (curVer == null || curVer.equals(ver)) {
    if (val != this.val) {
      if (newVer == null)       newVer=nextVersion();
      CacheObject old=rawGetOrUnmarshalUnlocked(false);
      long ttl=ttlExtras();
      long expTime=CU.toExpireTime(ttl);
      val=(CacheObject)cctx.kernalContext().portable().detachPortable(val,cctx);
      if (val != null) {
        updateIndex(val,null,expTime,newVer,old);
        if (deletedUnlocked())         deletedUnlocked(false);
      }
      update(val,null,expTime,ttl,newVer);
    }
    return true;
  }
  return false;
}
