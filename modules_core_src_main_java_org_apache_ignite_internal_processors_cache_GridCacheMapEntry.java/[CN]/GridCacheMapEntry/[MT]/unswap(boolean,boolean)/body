{
  boolean swapEnabled=cctx.swap().swapEnabled() && (ignoreFlags || !cctx.hasFlag(SKIP_SWAP));
  if (!swapEnabled && !cctx.isOffHeapEnabled())   return null;
synchronized (this) {
    if (isStartVersion() && ((flags & IS_UNSWAPPED_MASK) == 0)) {
      GridCacheSwapEntry e;
      if (cctx.offheapTiered()) {
        e=cctx.swap().readOffheapPointer(this);
        if (e != null) {
          if (e.offheapPointer() > 0) {
            valPtr=e.offheapPointer();
            if (needVal) {
              CacheObject val=cctx.fromOffheap(valPtr,false);
              e.value(val);
            }
          }
 else {
            valPtr=0;
            if (cctx.portableEnabled() && !e.valueIsByteArray())             e.valueBytes(null);
          }
        }
      }
 else       e=detached() ? cctx.swap().read(this,true,true,true) : cctx.swap().readAndRemove(this);
      if (log.isDebugEnabled())       log.debug("Read swap entry [swapEntry=" + e + ", cacheEntry="+ this+ ']');
      flags|=IS_UNSWAPPED_MASK;
      if (e != null) {
        long delta=e.expireTime() == 0 ? 0 : e.expireTime() - U.currentTimeMillis();
        if (delta >= 0) {
          CacheObject val=e.value();
          val=cctx.kernalContext().portable().prepareForCache(val,cctx);
          update(val,e.expireTime(),e.ttl(),e.version());
          if (cctx.offheapTiered() && e.offheapPointer() > 0)           valPtr=e.offheapPointer();
          return val;
        }
 else         clearIndex(e.value());
      }
    }
  }
  return null;
}
