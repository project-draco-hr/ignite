{
  boolean marked=false;
  try {
    if (F.isEmptyOrNulls(filter)) {
synchronized (this) {
        if (obsoleteVersionExtras() != null)         return true;
        CacheObject prev=saveValueForIndexUnlocked();
        if (!hasReaders() && markObsolete0(obsoleteVer,false)) {
          if (swap) {
            if (!isStartVersion()) {
              try {
                swap();
              }
 catch (              IgniteCheckedException e) {
                U.error(log,"Failed to write entry to swap storage: " + this,e);
              }
            }
          }
 else           clearIndex(prev);
          value(null);
          marked=true;
          return true;
        }
 else         evictFailed(prev);
      }
    }
 else {
      while (true) {
        GridCacheVersion v;
synchronized (this) {
          v=ver;
        }
        if (!cctx.isAll(this,filter))         return false;
synchronized (this) {
          if (obsoleteVersionExtras() != null)           return true;
          if (!v.equals(ver))           continue;
          CacheObject prevVal=saveValueForIndexUnlocked();
          if (!hasReaders() && markObsolete0(obsoleteVer,false)) {
            if (swap) {
              if (!isStartVersion()) {
                try {
                  swap();
                }
 catch (                IgniteCheckedException e) {
                  U.error(log,"Failed to write entry to swap storage: " + this,e);
                }
              }
            }
 else             clearIndex(prevVal);
            value(null);
            marked=true;
            return true;
          }
 else {
            evictFailed(prevVal);
            return false;
          }
        }
      }
    }
  }
 catch (  GridCacheEntryRemovedException ignore) {
    if (log.isDebugEnabled())     log.debug("Got removed entry when evicting (will simply return): " + this);
    return true;
  }
 finally {
    if (marked)     onMarkedObsolete();
  }
  return false;
}
