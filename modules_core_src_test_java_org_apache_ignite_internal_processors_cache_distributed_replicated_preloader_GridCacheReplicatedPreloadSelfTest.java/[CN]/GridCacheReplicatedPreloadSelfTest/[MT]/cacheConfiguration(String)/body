{
  CacheConfiguration cacheCfg=defaultCacheConfiguration();
  cacheCfg.setCacheMode(REPLICATED);
  cacheCfg.setWriteSynchronizationMode(FULL_SYNC);
  cacheCfg.setRebalanceMode(preloadMode);
  cacheCfg.setRebalanceBatchSize(batchSize);
  cacheCfg.setRebalanceThreadPoolSize(poolSize);
  if (needStore) {
    Object sf=null;
    try {
      sf=getExternalClassLoader().loadClass("org.apache.ignite.tests.p2p.CacheDeploymentTestStoreFactory").newInstance();
    }
 catch (    Exception e) {
      throw new RuntimeException(e);
    }
    cacheCfg.setCacheStoreFactory((Factory)sf);
  }
  return cacheCfg;
}
