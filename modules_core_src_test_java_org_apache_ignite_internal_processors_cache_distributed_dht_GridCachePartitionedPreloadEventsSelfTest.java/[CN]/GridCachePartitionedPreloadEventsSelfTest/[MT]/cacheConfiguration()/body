{
  CacheConfiguration cacheCfg=super.cacheConfiguration();
  if (replicatedAffinity)   cacheCfg.setAffinity(new CacheAffinityFunction(){
    /** 
 * {@inheritDoc} 
 */
    @Override public void reset(){
    }
    /** 
 * {@inheritDoc} 
 */
    @Override public int partitions(){
      return 1;
    }
    /** 
 * {@inheritDoc} 
 */
    @Override public int partition(    Object key){
      return 0;
    }
    /** 
 * {@inheritDoc} 
 */
    @Override public List<List<ClusterNode>> assignPartitions(    CacheAffinityFunctionContext affCtx){
      List<ClusterNode> nodes=new ArrayList<>(affCtx.currentTopologySnapshot());
      return Collections.singletonList(nodes);
    }
    /** 
 * {@inheritDoc} 
 */
    @Override public void removeNode(    UUID nodeId){
    }
  }
);
  cacheCfg.setPreloadMode(preloadMode);
  return cacheCfg;
}
