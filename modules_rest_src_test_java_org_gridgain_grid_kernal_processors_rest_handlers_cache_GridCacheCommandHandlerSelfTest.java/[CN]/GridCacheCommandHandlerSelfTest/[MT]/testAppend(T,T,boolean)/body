{
  GridRestCommandHandler hnd=new GridCacheCommandHandler(((GridKernal)grid()).context());
  String key=UUID.randomUUID().toString();
  Map<String,Object> params=new HashMap<>();
  params.put("key",key);
  params.put("val",newVal);
  GridRestRequest req=new GridRestRequest(append ? GridRestCommand.CACHE_APPEND : GridRestCommand.CACHE_PREPEND);
  req.setParameters(params);
  assertFalse("Expects failure due to no value in cache.",(Boolean)hnd.handleAsync(req).get().getResponse());
  T res;
  try {
    cache().putx(key,curVal);
    assertTrue("Expects succeed.",(Boolean)hnd.handleAsync(req).get().getResponse());
  }
  finally {
    res=(T)cache().remove(key);
  }
  return res;
}
