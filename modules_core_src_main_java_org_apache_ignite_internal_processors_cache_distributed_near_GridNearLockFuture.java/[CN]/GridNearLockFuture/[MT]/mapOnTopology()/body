{
  cctx.topology().readLock();
  try {
    GridDhtTopologyFuture fut=cctx.topologyVersionFuture();
    if (fut.isDone()) {
      AffinityTopologyVersion topVer=fut.topologyVersion();
      if (tx != null)       tx.topologyVersion(topVer);
      this.topVer.compareAndSet(null,topVer);
      map(keys);
      markInitialized();
    }
 else {
      fut.listen(new CI1<IgniteInternalFuture<AffinityTopologyVersion>>(){
        @Override public void apply(        IgniteInternalFuture<AffinityTopologyVersion> t){
          mapOnTopology();
        }
      }
);
    }
  }
  finally {
    cctx.topology().readUnlock();
  }
}
