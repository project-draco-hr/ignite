{
  UserTransaction jtaTx=jotm.getUserTransaction();
  Cache<String,Integer> cache1=cache();
  Cache<String,Integer> cache2=grid(0).cache("cache-2");
  assertNull(cache1.tx());
  assertNull(cache2.tx());
  jtaTx.begin();
  try {
    cache1.put("key",1);
    cache2.put("key",1);
    assertEquals(1,(int)cache1.get("key"));
    assertEquals(1,(int)cache2.get("key"));
    assertEquals(cache1.tx().state(),ACTIVE);
    assertEquals(cache2.tx().state(),ACTIVE);
    jtaTx.commit();
    assertNull(cache1.tx());
    assertNull(cache2.tx());
    assertEquals(1,(int)cache1.get("key"));
    assertEquals(1,(int)cache2.get("key"));
  }
  finally {
    if (jtaTx.getStatus() == Status.STATUS_ACTIVE)     jtaTx.rollback();
  }
  assertEquals(1,(int)cache1.get("key"));
  assertEquals(1,(int)cache2.get("key"));
}
