{
  if (groupLock() && cctx.kernalContext().config().isCacheSanityCheckEnabled()) {
    int affinityPart=cctx.config().getAffinity().partition(grpLockKey);
    for (    K key : keys) {
      if (partitionLock()) {
        int part=cctx.affinity().partition(key);
        if (affinityPart != part)         throw new GridException("Failed to enlist key into group-lock transaction (given " + "key does not belong to locked partition) [key=" + key + ", affinityPart="+ affinityPart+ ", part="+ part+ ", groupLockKey="+ grpLockKey+ ']');
      }
 else {
        Object affinityKey=cctx.config().getAffinityMapper().affinityKey(key);
        if (!grpLockKey.equals(affinityKey))         throw new GridException("Failed to enlist key into group-lock transaction (affinity key was " + "not enlisted to transaction on start) [key=" + key + ", affinityKey="+ affinityKey+ ", groupLockKey="+ grpLockKey+ ']');
      }
    }
  }
}
