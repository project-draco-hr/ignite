{
  boolean answer=false;
  for (  String dir : dirs) {
    File subDir=new File(rootDir,dir);
    File[] cmdFiles=subDir.listFiles(new FilenameFilter(){
      @Override public boolean accept(      File dir,      String name){
        return name.toLowerCase().endsWith(".cmd");
      }
    }
);
    for (    File file : cmdFiles) {
      String content=null;
      try (Scanner scanner=new Scanner(file)){
        content=scanner.useDelimiter("\\Z").next();
      }
 catch (      FileNotFoundException e) {
        exit("Failed to read file '" + file + "'.",e);
      }
      boolean invalid=false;
      for (int i=0; i < content.length(); i++) {
        if (content.charAt(i) == '\n' && (i == 0 || content.charAt(i - 1) != '\r')) {
          invalid=true;
          break;
        }
      }
      if (invalid) {
        answer=answer || ask("One or more *.CMD files has invalid new line character. Replace them?");
        if (!answer) {
          println("Ok. But Windows most probably will fail to execute them...");
          return;
        }
        println("Fixing newline characters in file '" + file.getAbsolutePath() + "'.");
        renameToBak(file);
        try (BufferedWriter writer=new BufferedWriter(new FileWriter(file))){
          for (int i=0; i < content.length(); i++) {
            if (content.charAt(i) == '\n' && (i == 0 || content.charAt(i - 1) != '\r'))             writer.write("\r");
            writer.write(content.charAt(i));
          }
        }
 catch (        IOException e) {
          exit("Failed to write file '" + file.getPath() + "': "+ e.getMessage(),e);
        }
      }
    }
  }
}
