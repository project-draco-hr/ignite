{
  IgniteKernal kernal=(IgniteKernal)ignite;
  CacheObjectPortableProcessorImpl proc=(CacheObjectPortableProcessorImpl)kernal.context().cacheObjects();
  try {
    key=proc.toPortable(key);
  }
 catch (  IgniteException e) {
    U.error(log,"Failed to marshal key to portable: " + key,e);
  }
  if (key instanceof PortableObject)   return proc.affinityKey((PortableObject)key);
 else   return super.affinityKey(key);
}
