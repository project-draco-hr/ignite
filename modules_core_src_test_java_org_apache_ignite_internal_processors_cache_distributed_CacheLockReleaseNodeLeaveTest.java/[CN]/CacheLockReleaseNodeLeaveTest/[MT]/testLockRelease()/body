{
  startGrids(2);
  final Ignite ignite0=ignite(0);
  final Ignite ignite1=ignite(1);
  final Integer key=primaryKey(ignite1.cache(null));
  IgniteInternalFuture<?> fut1=GridTestUtils.runAsync(new Callable<Void>(){
    @Override public Void call() throws Exception {
      Lock lock=ignite0.cache(null).lock(key);
      lock.lock();
      return null;
    }
  }
,"lock-thread1");
  fut1.get();
  IgniteInternalFuture<?> fut2=GridTestUtils.runAsync(new Callable<Void>(){
    @Override public Void call() throws Exception {
      Lock lock=ignite1.cache(null).lock(key);
      log.info("Start lock.");
      lock.lock();
      log.info("Locked.");
      return null;
    }
  }
,"lock-thread2");
  U.sleep(1000);
  log.info("Stop node.");
  ignite0.close();
  fut2.get(5,SECONDS);
}
