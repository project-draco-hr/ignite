{
  try {
    atomicityMode=mode;
    backups=b;
    writeOrderMode=order;
    distroMode=GridCacheDistributionMode.PARTITIONED_ONLY;
    startGrids(2);
    distroMode=GridCacheDistributionMode.CLIENT_ONLY;
    startGrid(2);
    failDeserialization=false;
    GridCacheProjection<Integer,TestObject> cache=grid(2).cache(null);
    if (backups > 0 && atomicityMode == ATOMIC)     cache=cache.flagsOn(SKIP_ATOMIC_VERSION_CHECK);
    for (int i=0; i < 100; i++)     cache.put(i,new TestObject());
    failDeserialization=true;
    info(">>>>>> Transforming");
    for (int i=0; i < 200; i++)     cache.transform(i,new Transform());
    Map<Integer,Transform> transformMap=new HashMap<>();
    for (int i=0; i < 300; i++)     transformMap.put(i,new Transform());
    cache.transformAll(transformMap);
    failDeserialization=false;
  }
  finally {
    stopAllGrids();
  }
}
