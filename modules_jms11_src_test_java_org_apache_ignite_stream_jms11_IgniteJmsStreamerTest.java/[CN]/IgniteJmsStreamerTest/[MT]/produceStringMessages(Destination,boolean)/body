{
  Session ses=connFactory.createConnection().createSession(false,Session.AUTO_ACKNOWLEDGE);
  MessageProducer mp=ses.createProducer(dest);
  HashSet<String> set=new HashSet<>();
  for (  String key : TEST_DATA.keySet())   set.add(key + "," + TEST_DATA.get(key));
  int messagesSent;
  if (singleMsg) {
    StringBuilder sb=new StringBuilder();
    for (    String s : set)     sb.append(s).append("|");
    sb.deleteCharAt(sb.length() - 1);
    mp.send(ses.createTextMessage(sb.toString()));
    messagesSent=1;
  }
 else {
    for (    String s : set)     mp.send(ses.createTextMessage(s));
    messagesSent=set.size();
  }
  if (dest instanceof Queue) {
    try {
      assertEquals(messagesSent,broker.getBroker().getDestinationMap().get(dest).getDestinationStatistics().getMessages().getCount());
    }
 catch (    Exception e) {
      fail(e.toString());
    }
  }
}
