{
  File locDir;
switch (taskInfo().type()) {
case MAP:
case REDUCE:
    job().prepareTaskEnvironment(taskInfo());
  locDir=taskLocalDir(locNodeId,taskInfo());
break;
default :
locDir=jobLocalDir(locNodeId,taskInfo().jobId());
}
Thread.currentThread().setContextClassLoader(jobConf().getClassLoader());
try {
FileSystem.get(jobConf());
LocalFileSystem locFs=FileSystem.getLocal(jobConf());
locFs.setWorkingDirectory(new Path(locDir.getAbsolutePath()));
}
 catch (Throwable e) {
if (e instanceof Error) throw (Error)e;
throw transformException(e);
}
 finally {
Thread.currentThread().setContextClassLoader(null);
}
}
