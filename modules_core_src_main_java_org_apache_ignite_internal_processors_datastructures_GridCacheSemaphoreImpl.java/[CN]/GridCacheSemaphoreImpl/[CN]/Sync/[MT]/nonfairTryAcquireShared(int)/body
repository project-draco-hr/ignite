{
  for (; ; ) {
    if (broken)     return 1;
    int available=getState();
    int remaining=available - acquires;
    if (remaining < 0 || compareAndSetGlobalState(available,remaining,false)) {
      return remaining;
    }
  }
}
