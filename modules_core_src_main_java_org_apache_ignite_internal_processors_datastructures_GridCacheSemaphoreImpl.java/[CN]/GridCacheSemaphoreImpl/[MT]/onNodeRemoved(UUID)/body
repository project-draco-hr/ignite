{
  int numPermits=sync.getPermitsForNode(nodeId);
  if (numPermits > 0) {
    if (sync.failoverSafe)     sync.releaseFailedNode(nodeId);
 else {
      sync.broken=true;
      for (      Thread t : sync.getSharedQueuedThreads())       t.interrupt();
      sync.releaseShared(0);
    }
  }
}
