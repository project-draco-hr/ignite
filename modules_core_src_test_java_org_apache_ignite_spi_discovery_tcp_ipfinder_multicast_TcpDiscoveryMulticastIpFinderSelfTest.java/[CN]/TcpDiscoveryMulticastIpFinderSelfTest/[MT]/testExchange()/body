{
  String locAddr=null;
  TcpDiscoveryMulticastIpFinder ipFinder1=null;
  TcpDiscoveryMulticastIpFinder ipFinder2=null;
  TcpDiscoveryMulticastIpFinder ipFinder3=null;
  try {
    ipFinder1=ipFinder();
    ipFinder1.setResponseWaitTime(1000);
    ipFinder1.setAddressRequestAttempts(10);
    ipFinder2=new TcpDiscoveryMulticastIpFinder();
    ipFinder2.setResponseWaitTime(1000);
    ipFinder2.setAddressRequestAttempts(10);
    ipFinder2.setMulticastGroup(ipFinder1.getMulticastGroup());
    ipFinder2.setMulticastPort(ipFinder1.getMulticastPort());
    ipFinder3=new TcpDiscoveryMulticastIpFinder();
    ipFinder3.setResponseWaitTime(1000);
    ipFinder3.setAddressRequestAttempts(10);
    ipFinder3.setMulticastGroup(ipFinder1.getMulticastGroup());
    ipFinder3.setMulticastPort(ipFinder1.getMulticastPort());
    injectLogger(ipFinder1);
    injectLogger(ipFinder2);
    injectLogger(ipFinder3);
    ipFinder1.setLocalAddress(locAddr);
    ipFinder2.setLocalAddress(locAddr);
    ipFinder3.setLocalAddress(locAddr);
    ipFinder1.initializeLocalAddresses(Collections.singleton(new InetSocketAddress("host1",1001)));
    ipFinder2.initializeLocalAddresses(Collections.singleton(new InetSocketAddress("host2",1002)));
    ipFinder3.initializeLocalAddresses(Collections.singleton(new InetSocketAddress("host3",1003)));
    Collection<InetSocketAddress> addrs1=ipFinder1.getRegisteredAddresses();
    Collection<InetSocketAddress> addrs2=ipFinder2.getRegisteredAddresses();
    Collection<InetSocketAddress> addrs3=ipFinder3.getRegisteredAddresses();
    info("Addrs1: " + addrs1);
    info("Addrs2: " + addrs2);
    info("Addrs2: " + addrs3);
    assertEquals(1,ipFinder1.getRegisteredAddresses().size());
    assertEquals(2,ipFinder2.getRegisteredAddresses().size());
    assertEquals(3,ipFinder3.getRegisteredAddresses().size());
  }
  finally {
    if (ipFinder1 != null)     ipFinder1.close();
    if (ipFinder2 != null)     ipFinder2.close();
    if (ipFinder3 != null)     ipFinder3.close();
  }
}
