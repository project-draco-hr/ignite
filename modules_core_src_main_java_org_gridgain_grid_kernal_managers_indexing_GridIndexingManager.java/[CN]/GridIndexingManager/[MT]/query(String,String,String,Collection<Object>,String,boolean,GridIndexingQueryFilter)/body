{
  if (!busyLock.enterBusy())   throw new IllegalStateException("Failed to execute query (grid is stopping).");
  try {
    TypeDescriptor type=typesByName.get(new TypeName(space,resType));
    if (type == null || !type.registered())     return new GridEmptyCloseableIterator<>();
    GridIndexingQueryFilter backupFilter=backupsFilter(includeBackups);
    return new GridSpiCloseableIteratorWrapper<>(getSpi(spi).<K,V>query(space,clause,params,type,and(filters,backupFilter)));
  }
  finally {
    busyLock.leaveBusy();
  }
}
