{
  if (!busyLock.enterBusy())   throw new IllegalStateException("Failed to get space size (grid is stopping).");
  try {
    GridCompoundFuture<?,?> fut=new GridCompoundFuture<Object,Object>(ctx);
    for (    TypeId type : types.keySet())     fut.add((GridFuture)rebuildIndexes(spi,type.space,type.valTypeName));
    fut.markInitialized();
    return fut;
  }
  finally {
    busyLock.leaveBusy();
  }
}
