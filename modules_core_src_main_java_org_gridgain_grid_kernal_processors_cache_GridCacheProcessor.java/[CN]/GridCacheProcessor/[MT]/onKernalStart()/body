{
  if (ctx.config().isDaemon())   return;
  if (!getBoolean(GG_SKIP_CONFIGURATION_CONSISTENCY_CHECK)) {
    for (    GridNode n : ctx.discovery().remoteNodes())     checkCache(n);
  }
  for (  Map.Entry<String,GridCacheAdapter<?,?>> e : caches.entrySet()) {
    GridCacheAdapter cache=e.getValue();
    if (maxPreloadOrder > 0) {
      GridCacheConfiguration cfg=cache.configuration();
      int order=cfg.getPreloadOrder();
      if (order > 0 && order != maxPreloadOrder && cfg.getCacheMode() != LOCAL) {
        GridCompoundFuture<Object,Object> fut=(GridCompoundFuture<Object,Object>)preloadFuts.get(order);
        if (fut == null) {
          fut=new GridCompoundFuture<>(ctx);
          preloadFuts.put(order,fut);
        }
        fut.add(cache.preloader().syncFuture());
      }
    }
  }
  for (  GridFuture<?> fut : preloadFuts.values())   ((GridCompoundFuture<Object,Object>)fut).markInitialized();
  for (  GridCacheSharedManager<?,?> mgr : sharedCtx.managers())   mgr.onKernalStart();
  for (  GridCacheAdapter<?,?> cache : caches.values())   onKernalStart(cache);
  for (  GridCacheAdapter<?,?> cache : caches.values()) {
    GridCacheConfiguration cfg=cache.configuration();
    if (cfg.getPreloadMode() == SYNC) {
      if (cfg.getCacheMode() == REPLICATED || (cfg.getCacheMode() == PARTITIONED && cfg.getPreloadPartitionedDelay() >= 0))       cache.preloader().syncFuture().get();
    }
  }
}
