{
  if (node.version().compareTo(GridNearAtomicCache.SINCE_VER) >= 0)   return null;
  GridCacheAttributes[] joinAttrs=U.cacheAttributes(node);
  if (F.isEmpty(joinAttrs))   return null;
  for (  GridNode topNode : ctx.discovery().allNodes()) {
    GridCacheAttributes[] attrs=U.cacheAttributes(topNode);
    if (F.isEmpty(attrs))     continue;
    for (    GridCacheAttributes joinAttr : joinAttrs) {
      for (      GridCacheAttributes attr : attrs) {
        if (F.eq(joinAttr.cacheName(),attr.cacheName())) {
          if (attr.atomicityMode() == ATOMIC && attr.nearCacheEnabled()) {
            String errMsg="Failed to add node to topology because topology has nodes with " + "ATOMIC cache with near cache enabled and joining node does not support " + "such configuration [cacheName=" + attr.cacheName() + ", existingNodeId="+ topNode.id()+ ", existingNodeVer="+ topNode.version()+ ']';
            return new GridNodeValidationResult(topNode.id(),errMsg,errMsg);
          }
        }
      }
    }
  }
  return null;
}
