{
  try {
    Ignite ignite1=startGrid(1,new GridSpringResourceContextImpl(new GenericApplicationContext()));
    Ignite ignite2=startGrid(2,new GridSpringResourceContextImpl(new GenericApplicationContext()));
    Ignite ignite3=startGrid(3,new GridSpringResourceContextImpl(new GenericApplicationContext()));
    node2Id=ignite2.cluster().localNode().id();
    ignite1.compute().execute(SharedResourceTask1.class,null);
    ignite1.compute().execute(SharedResourceTask2.class,null);
    GridP2PAbstractUserResource.checkCreateCount(UserResource1.class,2);
    GridP2PAbstractUserResource.checkCreateCount(UserResource2.class,2);
    assertEquals(clsLdr1,clsLdr2);
    stopGrid(1);
    Thread.sleep(2000);
    GridP2PAbstractUserResource.checkUndeployCount(UserResource1.class,1);
    GridP2PAbstractUserResource.checkUndeployCount(UserResource2.class,1);
    ignite3.compute().execute(SharedResourceTask1.class,null);
    ignite3.compute().execute(SharedResourceTask2.class,null);
    GridP2PAbstractUserResource.checkCreateCount(UserResource1.class,3);
    GridP2PAbstractUserResource.checkCreateCount(UserResource2.class,3);
    assertEquals(clsLdr1,clsLdr2);
  }
  finally {
    stopGrid(1);
    stopGrid(2);
    stopGrid(3);
  }
  GridP2PAbstractUserResource.checkUndeployCount(UserResource1.class,3);
  GridP2PAbstractUserResource.checkUndeployCount(UserResource2.class,3);
}
