{
  try {
    Grid grid1=startGrid(1,new GridSpringResourceContextImpl(new GenericApplicationContext()));
    Grid grid2=startGrid(2,new GridSpringResourceContextImpl(new GenericApplicationContext()));
    Grid grid3=startGrid(3,new GridSpringResourceContextImpl(new GenericApplicationContext()));
    node2Id=grid2.localNode().id();
    grid1.compute().execute(SharedResourceTask1.class,null).get();
    grid1.compute().execute(SharedResourceTask2.class,null).get();
    GridP2PAbstractUserResource.checkCreateCount(UserResource1.class,2);
    GridP2PAbstractUserResource.checkCreateCount(UserResource2.class,2);
    assertEquals(clsLdr1,clsLdr2);
    grid3.compute().execute(SharedResourceTask1.class,null).get();
    grid3.compute().execute(SharedResourceTask2.class,null).get();
    GridP2PAbstractUserResource.checkCreateCount(UserResource1.class,3);
    GridP2PAbstractUserResource.checkCreateCount(UserResource2.class,3);
    assertEquals(clsLdr1,clsLdr2);
  }
  finally {
    stopGrid(3);
    stopGrid(2);
    stopGrid(1);
  }
  GridP2PAbstractUserResource.checkUndeployCount(UserResource1.class,3);
  GridP2PAbstractUserResource.checkUndeployCount(UserResource2.class,3);
}
