{
  cacheC=new IgniteClosure<String,CacheConfiguration[]>(){
    @Override public CacheConfiguration[] apply(    String gridName){
      if (gridName.equals(getTestGridName(1)))       return null;
      return new CacheConfiguration[]{cacheConfiguration()};
    }
  }
;
  cacheNodeFilter=new CacheNodeFilter(F.asList(getTestGridName(1)));
  startServer(0,1);
  startServer(1,2);
  checkAffinity(2,topVer(2,1),true);
  startServer(2,3);
  startServer(3,4);
  Map<String,List<List<ClusterNode>>> aff=checkAffinity(4,topVer(4,1),true);
  stopGrid(0);
  boolean primaryChanged=calculateAffinity(5,false,aff);
  checkAffinity(3,topVer(5,0),!primaryChanged);
  if (primaryChanged)   checkAffinity(3,topVer(5,1),true);
  assertNull(((IgniteKernal)ignite(1)).context().cache().internalCache(CACHE_NAME1));
}
