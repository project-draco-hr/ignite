{
  int start=raw ? rawOff : off;
  byte flag=doReadByte(true);
switch (flag) {
case NULL:
    return null;
case HANDLE:
  int handle=doReadInt(false);
if (oHandles.containsKey(handle)) return oHandles.get(handle);
off=handle;
return doReadObject(false);
case OBJ:
boolean userType=doReadBoolean(raw);
int typeId=doReadInt(raw);
GridPortableClassDescriptor desc=ctx.descriptorForTypeId(userType,typeId);
if (desc == null) throw new GridPortableInvalidClassException("Unknown type ID: " + typeId);
if (raw) rawOff+=4;
 else off+=4;
int dataLen=doReadInt(raw) - HDR_LEN;
int rawOff0=start + doReadInt(raw);
Object obj=desc.read(new GridPortableReaderImpl(ctx,poHandles,oHandles,arr,start,rawOff0,typeId));
if (raw) rawOff+=dataLen;
 else off+=dataLen;
oHandles.put(start,obj);
return obj;
default :
throw new GridPortableException("Invalid flag value: " + flag);
}
}
