{
  if (store != null) {
    if (key.internal())     return true;
    Object storeKey=key.value(cctx.cacheObjectContext(),false);
    Object storeVal=val.value(cctx.cacheObjectContext(),false);
    if (convertPortable) {
      storeKey=cctx.unwrapPortableIfNeeded(storeKey,false);
      storeVal=cctx.unwrapPortableIfNeeded(storeVal,false);
    }
    if (log.isDebugEnabled())     log.debug("Storing value in cache store [key=" + key + ", val="+ val+ ']');
    boolean ses=initSession(tx);
    try {
      store.write(new CacheEntryImpl<>(storeKey,locStore ? F.t(storeVal,ver) : storeVal));
    }
 catch (    ClassCastException e) {
      handleClassCastException(e);
    }
catch (    CacheWriterException e) {
      throw new IgniteCheckedException(e);
    }
catch (    Exception e) {
      throw new IgniteCheckedException(new CacheWriterException(e));
    }
 finally {
      if (ses)       sesHolder.set(null);
    }
    if (log.isDebugEnabled())     log.debug("Stored value in cache store [key=" + storeKey + ", val="+ storeVal+ ']');
    return true;
  }
  return false;
}
