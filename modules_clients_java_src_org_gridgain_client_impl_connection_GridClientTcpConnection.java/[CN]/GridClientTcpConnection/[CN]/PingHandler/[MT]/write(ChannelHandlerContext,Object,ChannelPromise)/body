{
  if (msg instanceof GridClientPingPacket) {
    long now=U.currentTimeMillis();
    if (Math.min(now,lastPingRcvTime) - lastPingSndTime >= pingTimeout)     throw new IOException("Did not receive any packets within ping response interval (connection is " + "considered to be half-opened) [lastPingReceiveTime=" + lastPingRcvTime + ", lastPingSendTime="+ lastPingSndTime+ ", now="+ now+ ", timeout="+ pingTimeout+ ", addr="+ serverAddress()+ ']');
    if (now - lastPingSndTime > pingInterval && lastPingRcvTime != Long.MAX_VALUE) {
      lastPingRcvTime=Long.MAX_VALUE;
      ctx.writeAndFlush(msg,promise);
      lastPingSndTime=now;
    }
  }
 else   ctx.writeAndFlush(msg,promise);
}
