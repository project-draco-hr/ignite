{
  GridCacheSetProxy set=setsMap.remove(setId);
  if (set != null)   set.delegate().removed(true);
  GridConcurrentHashSet<GridCacheSetItemKey> setData=setDataMap.remove(setId);
  if (setData != null) {
    GridCache cache=cctx.cache();
    final int BATCH_SIZE=100;
    Collection<GridCacheSetItemKey> keys=new ArrayList<>();
    GridCacheAffinityManager aff=cctx.affinity();
    for (    GridCacheSetItemKey key : setData) {
      if (!aff.primary(cctx.localNode(),key,topVer))       continue;
      keys.add(key);
      if (keys.size() == BATCH_SIZE) {
        cache.removeAll(keys);
        keys.clear();
      }
    }
    if (!keys.isEmpty())     cache.removeAll(keys);
  }
}
