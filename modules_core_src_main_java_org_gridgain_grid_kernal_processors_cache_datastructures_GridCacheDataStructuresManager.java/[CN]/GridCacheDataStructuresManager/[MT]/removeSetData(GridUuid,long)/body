{
  boolean local=cctx.isLocal();
  GridCacheAffinityManager aff=cctx.affinity();
  if (!local) {
    aff.affinityReadyFuture(topVer).get();
    cctx.preloader().syncFuture().get();
  }
  GridConcurrentHashSet<GridCacheSetItemKey> set=setDataMap.get(setId);
  if (set == null)   return;
  GridCache cache=cctx.cache();
  final int BATCH_SIZE=100;
  Collection<GridCacheSetItemKey> keys=new ArrayList<>(BATCH_SIZE);
  for (  GridCacheSetItemKey key : set) {
    if (!local && !aff.primary(cctx.localNode(),key,topVer))     continue;
    keys.add(key);
    if (keys.size() == BATCH_SIZE) {
      retryRemove(cache,keys);
      keys.clear();
    }
  }
  if (!keys.isEmpty())   retryRemove(cache,keys);
  setDataMap.remove(setId);
}
