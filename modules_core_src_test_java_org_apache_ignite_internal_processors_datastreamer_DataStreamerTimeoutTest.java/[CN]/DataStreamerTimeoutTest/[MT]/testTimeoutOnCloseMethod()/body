{
  Ignite ignite=startGrid(1);
  boolean thrown=false;
  try (IgniteDataStreamer ldr=ignite.dataStreamer(CACHE_NAME)){
    ldr.timeout(TIMEOUT);
    ldr.receiver(new TestDataReceiver());
    ldr.perNodeBufferSize(ENTRY_AMOUNT);
    for (int i=0; i < ENTRY_AMOUNT; i++)     ldr.addData(i,i);
  }
 catch (  IgniteDataStreamerTimeoutException e) {
    assertEquals(e.getMessage(),"Data streamer exceeded timeout on flush.");
    thrown=true;
  }
 finally {
    stopAllGrids();
  }
  assertTrue(thrown);
}
