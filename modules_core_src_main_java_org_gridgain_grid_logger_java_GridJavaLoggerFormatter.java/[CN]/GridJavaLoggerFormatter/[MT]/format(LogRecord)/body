{
  String threadName=Thread.currentThread().getName();
  String logName=record.getLoggerName();
  if (logName == null)   logName=ANONYMOUS_LOGGER_NAME;
 else   if (logName.contains("."))   logName=logName.substring(logName.lastIndexOf('.') + 1);
  String ex=null;
  if (record.getThrown() != null) {
    StringWriter sw=new StringWriter();
    record.getThrown().printStackTrace(new PrintWriter(sw));
    String stackTrace=sw.toString();
    ex="\n" + stackTrace;
  }
  return "[" + DATE_FORMATTER.get().format(new Date(record.getMillis())) + "]["+ record.getLevel()+ "]["+ threadName+ "]["+ logName+ "] "+ record.getMessage()+ (ex == null ? "\n" : ex);
}
