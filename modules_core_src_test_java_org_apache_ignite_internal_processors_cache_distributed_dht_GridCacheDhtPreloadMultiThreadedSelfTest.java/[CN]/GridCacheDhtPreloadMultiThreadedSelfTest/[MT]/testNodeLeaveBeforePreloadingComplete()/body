{
  try {
    final CountDownLatch startLatch=new CountDownLatch(1);
    final CountDownLatch stopLatch=new CountDownLatch(1);
    GridTestUtils.runMultiThreadedAsync(new Callable<Object>(){
      @Nullable @Override public Object call() throws Exception {
        Ignite g=startGrid("first");
        g.events().localListen(new IgnitePredicate<IgniteEvent>(){
          @Override public boolean apply(          IgniteEvent evt){
            stopLatch.countDown();
            return true;
          }
        }
,IgniteEventType.EVT_NODE_JOINED);
        startLatch.countDown();
        stopLatch.await();
        G.stop(g.name(),false);
        return null;
      }
    }
,1,"first");
    GridTestUtils.runMultiThreaded(new Callable<Object>(){
      @Nullable @Override public Object call() throws Exception {
        startLatch.await();
        startGrid("second");
        return null;
      }
    }
,1,"second");
  }
  finally {
    G.stopAll(false);
  }
}
