{
  if (!offheapEnabled && !swapEnabled)   return;
  checkIteratorQueue();
  final GridCacheQueryManager qryMgr=cctx.queries();
  CI1<byte[]> c=qryMgr == null ? null : new CI1<byte[]>(){
    @Override public void apply(    byte[] rmv){
      if (rmv == null)       return;
      try {
        if (cctx.config().isStatisticsEnabled())         cctx.cache().metrics0().onSwapRemove();
        GridCacheSwapEntry entry=swapEntry(unmarshalSwapEntry(rmv));
        if (entry == null)         return;
        qryMgr.onUnswap(key,entry.value());
      }
 catch (      IgniteCheckedException e) {
        throw new IgniteException(e);
      }
    }
  }
;
  int part=cctx.affinity().partition(key);
  if (offheapEnabled) {
    byte[] val=offheap.remove(spaceName,part,key,key.valueBytes(cctx.cacheObjectContext()));
    if (val != null) {
      if (cctx.config().isStatisticsEnabled())       cctx.cache().metrics0().onOffHeapRemove();
      if (c != null)       c.apply(val);
      return;
    }
  }
  if (swapEnabled) {
    SwapKey swapKey=new SwapKey(key.value(cctx.cacheObjectContext(),false),part,key.valueBytes(cctx.cacheObjectContext()));
    swapMgr.remove(spaceName,swapKey,c,cctx.deploy().globalLoader());
  }
}
