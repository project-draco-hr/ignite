{
  closedSess.add(ses.getId());
  if (ses.getJobId() == null) {
    Set<String> keys=keyMap.remove(ses.getId());
    if (keys != null) {
      for (      String key : keys)       getSpi(ses.getCheckpointSpi()).removeCheckpoint(key);
    }
  }
 else   if (cleanup) {
    CheckpointSet keys=keyMap.get(ses.getId());
    if (keys != null && keys.session() == ses.session())     keyMap.remove(ses.getId(),keys);
  }
}
