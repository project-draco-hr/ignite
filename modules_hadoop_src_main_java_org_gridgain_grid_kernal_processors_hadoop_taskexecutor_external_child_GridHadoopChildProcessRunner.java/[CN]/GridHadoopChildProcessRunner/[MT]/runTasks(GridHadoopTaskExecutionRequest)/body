{
  if (!initFut.isDone() && log.isDebugEnabled())   log.debug("Will wait for process initialization future completion: " + req);
  initFut.listenAsync(new CI1<GridFuture<?>>(){
    @Override public void apply(    GridFuture<?> f){
      try {
        f.get();
        boolean set=pendingTasks.compareAndSet(0,req.tasks().size());
        assert set;
        GridHadoopTaskInfo info=F.first(req.tasks());
        int size=info.type() == MAP ? concMappers : concReducers;
        execSvc.setCorePoolSize(size);
        execSvc.setMaximumPoolSize(size);
        if (log.isDebugEnabled())         log.debug("Set executor service size for task type [type=" + info.type() + ", size="+ size+ ']');
        for (        GridHadoopTaskInfo taskInfo : req.tasks()) {
          if (log.isDebugEnabled())           log.debug("Submitted task for external execution: " + taskInfo);
          execSvc.submit(new GridHadoopRunnableTask(job,mem,info,clsLdrCtx){
            @Override protected void onTaskFinished(            GridHadoopTaskState state,            Throwable err){
              onTaskFinished0(this,state,err);
            }
            @Override protected GridHadoopTaskInput createInput(            GridHadoopTaskInfo info) throws GridException {
              return shuffleJob.input(info);
            }
            @Override protected GridHadoopTaskOutput createOutput(            GridHadoopTaskInfo info) throws GridException {
              return shuffleJob.output(info);
            }
          }
);
        }
      }
 catch (      GridException e) {
        for (        GridHadoopTaskInfo info : req.tasks())         notifyTaskFinished(info,GridHadoopTaskState.FAILED,e,false);
      }
    }
  }
);
}
