{
  try {
    if (initGuard.compareAndSet(false,true)) {
      log.info("Initializing external hadoop task: " + req);
      job=jobFactory.createJob(req.jobId(),req.jobInfo());
      for (      GridHadoopTaskInfo taskInfo : req.tasks()) {
        GridHadoopTask task=job.createTask(taskInfo);
switch (taskInfo.type()) {
case MAP:
{
            if (mappers == null)             mappers=new ArrayList<>();
            mappers.add(task);
            break;
          }
case REDUCE:
{
          if (reducers == null)           reducers=new ArrayList<>();
          reducers.add(task);
          break;
        }
default :
      throw new GridException("Invalid task type for external execution: " + taskInfo.type());
  }
}
shuffle.prepareFor(job,mappers != null);
if (mappers != null) pendingMappers.set(mappers.size());
if (reducers != null) pendingReducers.set(reducers.size());
initializeExecutors(req,job,mappers,reducers);
phase(GridHadoopJobPhase.PHASE_MAP);
comm.sendMessage(nodeDesc,new GridHadoopTaskExecutionResponse(job.id(),reducerIds(reducers)));
}
 else log.warning("Received duplicate task execution request for the same process (will ignore): " + req);
}
 catch (GridException e) {
log.error("Unexpected exception caught during task initialization (will abort process execution).",e);
shutdown();
terminate();
}
}
