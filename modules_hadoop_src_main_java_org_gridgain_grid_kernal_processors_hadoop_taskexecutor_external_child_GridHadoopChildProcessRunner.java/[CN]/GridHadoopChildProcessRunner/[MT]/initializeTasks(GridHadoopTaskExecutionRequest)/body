{
  try {
    if (initGuard.compareAndSet(false,true)) {
      log.info("Initializing external hadoop task: " + req);
      GridHadoopJob job=jobFactory.createJob(req.jobId(),req.jobInfo());
      Collection<GridHadoopTask> mappers=null;
      Collection<GridHadoopTask> reducers=null;
      for (      GridHadoopTaskInfo taskInfo : req.tasks()) {
        GridHadoopTask task=job.createTask(taskInfo);
switch (taskInfo.type()) {
case MAP:
{
            if (mappers == null)             mappers=new ArrayList<>();
            mappers.add(task);
            break;
          }
case REDUCE:
{
          if (reducers == null)           reducers=new ArrayList<>();
          reducers.add(task);
          break;
        }
default :
      throw new GridException("Invalid task type for external execution: " + taskInfo.type());
  }
}
initializeExecutors(req,job,mappers,reducers);
if (mappers != null) {
  for (  GridHadoopTask m : mappers)   mapperExecSvc.submit(new TaskRunnable(new GridHadoopTaskContext(null,job,null,null),m));
  if (job.hasCombiner()) {
    GridHadoopTask c=job.createTask(new GridHadoopTaskInfo(comm.localProcessDescriptor().parentNodeId(),GridHadoopTaskType.COMBINE,job.id(),0,0,null));
    reducerExecSvc.submit(new TaskRunnable(new GridHadoopTaskContext(null,job,null,null),c));
  }
}
if (reducers != null) {
  for (  GridHadoopTask r : reducers)   reducerExecSvc.submit(new TaskRunnable(new GridHadoopTaskContext(null,job,null,null),r));
}
}
 else log.warning("Received duplicate task execution request for the same process (will ignore): " + req);
}
 catch (GridException e) {
log.warning("Unexpected exception caught during task initialization. Will shutdown process runner.",e);
abortExecution();
e.printStackTrace();
}
}
