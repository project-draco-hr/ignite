{
  try {
    if (valBytes == null)     valBytes=ctx.portable().marshal(ctx.cacheObjectContext(),val);
    if (needCopy(ctx)) {
      Object val=ctx.portable().unmarshal(ctx.cacheObjectContext(),valBytes,ctx.deploy().globalLoader());
      return new KeyCacheObjectImpl(val,valBytes);
    }
    return new KeyCacheObjectImpl(val,valBytes);
  }
 catch (  IgniteCheckedException e) {
    throw new IgniteException("Failed to marshal object: " + val,e);
  }
}
