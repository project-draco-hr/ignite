{
  TableDescriptor tbl=tableDescriptor(spaceName,type);
  if (tbl == null)   return new GridEmptyCloseableIterator<>();
  setFilters(filters != null ? filters : EMPTY_FILTER);
  localSpi.set(this);
  try {
    T2<PreparedStatement,ResultSet> t=executeQuery(qry,params,tbl);
    return t != null ? new KeyValIterator<K,V>(t.get2(),t.get1()) : new GridEmptyCloseableIterator<GridIndexingKeyValueRow<K,V>>();
  }
 catch (  SQLException e) {
    if (e.getErrorCode() != ErrorCode.TABLE_OR_VIEW_NOT_FOUND_1) {
      onSqlException();
      throw new GridSpiException("Failed to query entries: " + qry,e);
    }
    return new GridEmptyCloseableIterator<>();
  }
 finally {
    setFilters(null);
    localSpi.remove();
  }
}
