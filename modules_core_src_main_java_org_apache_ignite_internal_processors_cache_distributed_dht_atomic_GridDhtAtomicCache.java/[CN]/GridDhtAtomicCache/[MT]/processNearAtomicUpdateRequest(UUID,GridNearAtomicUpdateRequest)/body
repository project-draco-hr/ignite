{
  if (log.isDebugEnabled())   log.debug("Processing near atomic update request [nodeId=" + nodeId + ", req="+ req+ ']');
  req.nodeId(ctx.localNodeId());
  if (req.classError() != null) {
    GridNearAtomicUpdateResponse res=new GridNearAtomicUpdateResponse(ctx.cacheId(),nodeId,req.futureVersion());
    res.onError(req.classError());
    sendNearUpdateReply(nodeId,res);
  }
 else {
    updateAllAsyncInternal(nodeId,req,updateReplyClos);
  }
}
