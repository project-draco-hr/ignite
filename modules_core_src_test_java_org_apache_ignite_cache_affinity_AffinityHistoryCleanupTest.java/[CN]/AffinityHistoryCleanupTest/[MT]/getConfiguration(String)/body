{
  IgniteConfiguration cfg=super.getConfiguration(gridName);
  ((TcpDiscoverySpi)cfg.getDiscoverySpi()).setIpFinder(ipFinder);
  CacheConfiguration[] ccfgs=new CacheConfiguration[4];
  for (int i=0; i < ccfgs.length; i++) {
    CacheConfiguration ccfg=new CacheConfiguration();
    ccfg.setName("static-cache-" + i);
    ccfg.setAffinity(i % 2 == 0 ? new RendezvousAffinityFunction() : new FairAffinityFunction());
    ccfgs[i]=ccfg;
  }
  cfg.setCacheConfiguration(ccfgs);
  cfg.setClientMode(client);
  cfg.setLateAffinityAssignment(lateAffAssignment);
  return cfg;
}
