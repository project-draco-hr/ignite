{
  ExamplesUtils.checkMinMemory(MIN_MEMORY);
  try (Ignite ignite=Ignition.start("examples/config/example-ignite.xml")){
    System.out.println();
    System.out.println(">>> Cache store example started.");
    CacheConfiguration<Long,Person> cacheCfg=new CacheConfiguration<>(CACHE_NAME);
    cacheCfg.setAtomicityMode(TRANSACTIONAL);
    cacheCfg.setCacheStoreFactory(FactoryBuilder.factoryOf(CacheJdbcPersonStore.class));
    cacheCfg.setCacheStoreSessionListenerFactories(new Factory<CacheStoreSessionListener>(){
      @Override public CacheStoreSessionListener create(){
        CacheJdbcStoreSessionListener lsnr=new CacheJdbcStoreSessionListener();
        lsnr.setDataSource(JdbcConnectionPool.create("jdbc:h2:tcp://localhost/mem:ExampleDb","sa",""));
        return lsnr;
      }
    }
);
    cacheCfg.setReadThrough(true);
    cacheCfg.setWriteThrough(true);
    try (IgniteCache<Long,Person> cache=ignite.getOrCreateCache(cacheCfg)){
      loadCache(cache);
      executeTransaction(cache);
    }
  finally {
      ignite.destroyCache(CACHE_NAME);
    }
  }
 }
