{
  fail("https://issues.apache.org/jira/browse/IGNITE-1977");
  try (IgniteSemaphore s=grid(0).semaphore(STRUCTURE_NAME,1,false,true)){
    try {
      IgniteInternalFuture<?> fut=GridTestUtils.runMultiThreadedAsync(new CA(){
        @Override public void apply(){
          try {
            for (int i=0; i < 2; i++) {
              String name=UUID.randomUUID().toString();
              try {
                log.info("Start node: " + name);
                Ignite g=startGrid(name);
                final IgniteSemaphore sem=g.semaphore(STRUCTURE_NAME,TOP_CHANGE_CNT,true,true);
                assertNotNull(sem);
                if (i != 1)                 sem.acquire();
              }
  finally {
                if (i != 1)                 stopGrid(name);
              }
            }
          }
 catch (          Exception e) {
            throw F.wrap(e);
          }
        }
      }
,TOP_CHANGE_THREAD_CNT,"topology-change-thread");
      while (s.availablePermits() != 0) {
      }
      try {
        s.acquire();
        fail("In non-FailoverSafe mode IgniteInterruptedCheckedException must be thrown.");
      }
 catch (      Exception e) {
        assert(e instanceof IgniteInterruptedException);
      }
      assertTrue(s.isBroken());
      fut.get();
    }
  finally {
      grid(0).semaphore(STRUCTURE_NAME,TOP_CHANGE_CNT,true,true).close();
    }
  }
 }
