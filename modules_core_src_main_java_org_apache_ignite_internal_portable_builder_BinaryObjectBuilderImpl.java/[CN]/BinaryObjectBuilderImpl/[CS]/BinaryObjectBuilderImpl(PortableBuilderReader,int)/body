{
  this.reader=reader;
  this.start=start;
  this.flags=reader.readShortPositioned(start + FLAGS_POS);
  byte ver=reader.readBytePositioned(start + PROTO_VER_POS);
  PortableUtils.checkProtocolVersion(ver);
  int typeId=reader.readIntPositioned(start + TYPE_ID_POS);
  ctx=reader.portableContext();
  hashCode=reader.readIntPositioned(start + HASH_CODE_POS);
  if (typeId == UNREGISTERED_TYPE_ID) {
    int mark=reader.position();
    reader.position(start + DFLT_HDR_LEN);
    clsNameToWrite=reader.readString();
    Class cls;
    try {
      cls=U.forName(clsNameToWrite,null);
    }
 catch (    ClassNotFoundException e) {
      throw new BinaryInvalidTypeException("Failed to load the class: " + clsNameToWrite,e);
    }
    this.typeId=ctx.descriptorForClass(cls,false).typeId();
    registeredType=false;
    hdrLen=reader.position() - mark;
    reader.position(mark);
  }
 else {
    this.typeId=typeId;
    hdrLen=DFLT_HDR_LEN;
  }
}
