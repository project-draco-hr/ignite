{
  final AtomicBoolean stop=new AtomicBoolean();
  final AtomicInteger createCtr=new AtomicInteger();
  final AtomicReference<Exception> err=new AtomicReference<>();
  ggfs.create(FILE,false).close();
  int threadCnt=5;
  IgniteFuture<?> fut=multithreadedAsync(new Runnable(){
    @Override public void run(){
      while (!stop.get()) {
        IgniteFsOutputStream os=null;
        try {
          os=ggfs.create(FILE,true);
          os.write(chunk);
          U.sleep(50);
          os.close();
          createCtr.incrementAndGet();
        }
 catch (        IgniteCheckedException ignore) {
          try {
            U.sleep(10);
          }
 catch (          GridInterruptedException ignored) {
          }
        }
catch (        IOException e) {
          if (!e.getMessage().startsWith("File was concurrently deleted"))           err.compareAndSet(null,e);
        }
 finally {
          U.closeQuiet(os);
        }
      }
    }
  }
,threadCnt);
  long startTime=U.currentTimeMillis();
  while (createCtr.get() < 50 && U.currentTimeMillis() - startTime < 60 * 1000)   U.sleep(100);
  stop.set(true);
  fut.get();
  awaitFileClose(ggfs,FILE);
  if (err.get() != null)   throw err.get();
  checkFileContent(ggfs,FILE,chunk);
}
