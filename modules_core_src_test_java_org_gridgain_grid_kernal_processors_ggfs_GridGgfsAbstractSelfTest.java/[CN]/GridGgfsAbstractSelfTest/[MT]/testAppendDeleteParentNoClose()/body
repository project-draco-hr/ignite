{
  create(ggfs,paths(DIR,SUBDIR),null);
  createFile(ggfs,FILE,false);
  GridTestUtils.assertThrows(log,new Callable<Object>(){
    @Override public Object call() throws Exception {
      GridGgfsOutputStream os=null;
      try {
        GridUuid id=ggfs.context().meta().fileId(FILE);
        os=ggfs.append(FILE,false);
        ggfs.delete(SUBDIR,true);
        for (int i=0; i < 100 && ggfs.context().meta().exists(id); i++)         U.sleep(100);
        os.write(chunk);
        os.close();
      }
  finally {
        U.closeQuiet(os);
      }
      return null;
    }
  }
,IOException.class,"File was concurrently deleted: " + FILE);
}
