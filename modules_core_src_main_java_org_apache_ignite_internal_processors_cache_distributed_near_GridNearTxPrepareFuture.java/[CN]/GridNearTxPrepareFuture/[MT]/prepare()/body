{
  if (tx.optimistic()) {
    AffinityTopologyVersion topVer=cctx.mvcc().lastExplicitLockTopologyVersion(Thread.currentThread().getId());
    if (topVer != null) {
      tx.topologyVersion(topVer);
      prepare0();
      return;
    }
    prepareOnTopology();
  }
 else   preparePessimistic();
}
