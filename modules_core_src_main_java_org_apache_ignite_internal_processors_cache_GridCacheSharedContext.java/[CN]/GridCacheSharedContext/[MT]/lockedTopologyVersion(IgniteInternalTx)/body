{
  long threadId=Thread.currentThread().getId();
  IgniteInternalTx tx=txMgr.anyActiveThreadTx(threadId,ignore);
  AffinityTopologyVersion topVer=null;
  if (tx != null && tx.topologyVersionSnapshot() != null)   topVer=tx.topologyVersionSnapshot();
  if (topVer == null)   topVer=mvccMgr.lastExplicitLockTopologyVersion(threadId);
  return topVer;
}
