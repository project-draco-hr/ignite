{
  out.writeInt(delegate.size());
  boolean portableEnabled=portable != null;
  for (  Map.Entry<K,V> entry : delegate) {
    if (portableEnabled) {
      out.writeObject(portable.marshalToPortable(entry.getKey()));
      out.writeObject(portable.marshalToPortable(entry.getValue()));
    }
 else {
      out.writeObject(entry.getKey());
      out.writeObject(entry.getValue());
    }
  }
}
