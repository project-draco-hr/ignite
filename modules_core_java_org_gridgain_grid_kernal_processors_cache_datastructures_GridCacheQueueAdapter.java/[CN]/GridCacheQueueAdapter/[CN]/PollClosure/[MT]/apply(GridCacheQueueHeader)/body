{
  if (queueRemoved(header,uuid) || header.empty())   return header;
  Set<Long> removedIdx=header.removedIndexes();
  if (removedIdx == null)   return new GridCacheQueueHeader(header.uuid(),header.capacity(),header.collocated(),header.head() + 1,header.tail(),removedIdx);
  long next=header.head() + 1;
  do {
    if (!removedIdx.remove(next))     return new GridCacheQueueHeader(header.uuid(),header.capacity(),header.collocated(),next + 1,header.tail(),removedIdx.isEmpty() ? null : new HashSet<>(removedIdx));
    next++;
  }
 while (next != header.tail());
  return new GridCacheQueueHeader(header.uuid(),header.capacity(),header.collocated(),next,header.tail(),removedIdx.isEmpty() ? null : new HashSet<>(removedIdx));
}
