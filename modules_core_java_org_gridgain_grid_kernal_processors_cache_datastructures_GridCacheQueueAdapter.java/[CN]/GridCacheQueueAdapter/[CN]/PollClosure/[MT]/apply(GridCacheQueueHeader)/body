{
  if (queueRemoved(hdr,uuid) || hdr.empty())   return hdr;
  Set<Long> removedIdx=hdr.removedIndexes();
  if (removedIdx == null)   return new GridCacheQueueHeader(hdr.uuid(),hdr.capacity(),hdr.collocated(),hdr.head() + 1,hdr.tail(),removedIdx);
  long next=hdr.head() + 1;
  do {
    if (!removedIdx.remove(next))     return new GridCacheQueueHeader(hdr.uuid(),hdr.capacity(),hdr.collocated(),next + 1,hdr.tail(),removedIdx.isEmpty() ? null : new HashSet<>(removedIdx));
    next++;
  }
 while (next != hdr.tail());
  return new GridCacheQueueHeader(hdr.uuid(),hdr.capacity(),hdr.collocated(),next,hdr.tail(),removedIdx.isEmpty() ? null : new HashSet<>(removedIdx));
}
