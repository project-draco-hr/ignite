{
  IgniteConfiguration cfg=super.getConfiguration(gridName);
  IgniteFsConfiguration ggfsCfg=new IgniteFsConfiguration();
  ggfsCfg.setDataCacheName(DATA_CACHE_NAME);
  ggfsCfg.setMetaCacheName(META_CACHE_NAME);
  ggfsCfg.setName(GGFS_NAME);
  ggfsCfg.setBlockSize(BLOCK_SIZE);
  ggfsCfg.setFragmentizerEnabled(false);
  ggfsCfg.setMaxSpaceSize(ggfsMaxData);
  ggfsCfg.setTrashPurgeTimeout(trashPurgeTimeout);
  ggfsCfg.setManagementPort(++mgmtPort);
  CacheConfiguration dataCfg=defaultCacheConfiguration();
  dataCfg.setName(DATA_CACHE_NAME);
  dataCfg.setCacheMode(cacheMode);
  if (cacheMode == PARTITIONED) {
    dataCfg.setDistributionMode(nearEnabled ? NEAR_PARTITIONED : PARTITIONED_ONLY);
    dataCfg.setBackups(0);
  }
  dataCfg.setWriteSynchronizationMode(CacheWriteSynchronizationMode.FULL_SYNC);
  dataCfg.setPreloadMode(SYNC);
  dataCfg.setAffinityMapper(new IgfsGroupDataBlocksKeyMapper(128));
  dataCfg.setQueryIndexEnabled(false);
  dataCfg.setAtomicityMode(TRANSACTIONAL);
  CacheConfiguration metaCfg=defaultCacheConfiguration();
  metaCfg.setName(META_CACHE_NAME);
  metaCfg.setCacheMode(REPLICATED);
  metaCfg.setWriteSynchronizationMode(CacheWriteSynchronizationMode.FULL_SYNC);
  metaCfg.setPreloadMode(SYNC);
  metaCfg.setQueryIndexEnabled(false);
  metaCfg.setAtomicityMode(TRANSACTIONAL);
  TcpDiscoverySpi discoSpi=new TcpDiscoverySpi();
  discoSpi.setIpFinder(IP_FINDER);
  cfg.setDiscoverySpi(discoSpi);
  cfg.setCacheConfiguration(metaCfg,dataCfg);
  cfg.setGgfsConfiguration(ggfsCfg);
  return cfg;
}
