{
  long newBlockSize=calcBlockSize(newFileSize);
  if (counters.isEmpty())   blockSize=newBlockSize;
 else {
    if (newBlockSize >= 2 * blockSize) {
      int ratio=(int)(newBlockSize / blockSize);
      ArrayList<Integer> compacted=new ArrayList<>();
      int sum=0;
      int cnt=0;
      for (      Integer counter : counters) {
        sum+=counter;
        cnt++;
        if (cnt >= ratio) {
          compacted.add(sum);
          sum=0;
          cnt=0;
        }
      }
      if (sum > 0)       compacted.add(sum);
      counters.clear();
      counters.addAll(compacted);
      blockSize=newBlockSize;
    }
  }
  fileSize=newFileSize;
}
