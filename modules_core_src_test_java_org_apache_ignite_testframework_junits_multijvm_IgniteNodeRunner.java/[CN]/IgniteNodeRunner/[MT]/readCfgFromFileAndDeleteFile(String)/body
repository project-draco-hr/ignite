{
  try (BufferedReader cfgReader=new BufferedReader(new FileReader(fileName))){
    IgniteConfiguration cfg=(IgniteConfiguration)new XStream().fromXML(cfgReader);
    Marshaller marsh=IgniteTestResources.getMarshaller();
    cfg.setMarshaller(marsh);
    X.println("Configured marshaller class: " + marsh.getClass().getName());
    TcpDiscoverySpi disco=new TcpDiscoverySpi();
    disco.setIpFinder(GridCacheAbstractFullApiSelfTest.LOCAL_IP_FINDER);
    cfg.setDiscoverySpi(disco);
    return cfg;
  }
  finally {
    new File(fileName).delete();
  }
}
