{
  try {
    startGridsMultiThreaded(3);
    daemon=true;
    startGrid(4);
    GridCache<Integer,Integer> cache=grid(0).cache(null);
    for (int i=0; i < 30; i++) {
      GridCacheTx tx=cache.txStart(PESSIMISTIC,REPEATABLE_READ);
      try {
        cache.put(i,i);
        tx.commit();
      }
  finally {
        tx.close();
      }
    }
    Map<Integer,Integer> batch=new HashMap<>();
    for (int i=30; i < 60; i++)     batch.put(i,i);
    GridCacheTx tx=cache.txStart(PESSIMISTIC,REPEATABLE_READ);
    try {
      cache.putAll(batch);
      tx.commit();
    }
  finally {
      tx.close();
    }
    for (int i=0; i < 60; i++)     assertEquals(i,(int)cache.get(i));
  }
  finally {
    stopAllGrids();
  }
}
