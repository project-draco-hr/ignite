{
  int dataNodes=cacheMode() == REPLICATED ? gridCount() : 2;
  if (atomicityMode() == TRANSACTIONAL)   return dataNodes + (storeEnabled() ? 1 : 0);
 else {
    return (writeOrderMode() == PRIMARY || (op == Operation.TRANSFORM || op == Operation.UPDATE_FILTER)) ? 1 : dataNodes;
  }
}
