{
  IgniteConfiguration cfg=getConfiguration(gridName,getTestResources());
  cfg.setNodeId(null);
  if (GridTestProperties.getProperty(GridTestProperties.BINARY_COMPACT_FOOTERS) != null) {
    if (!Boolean.valueOf(GridTestProperties.getProperty(GridTestProperties.BINARY_COMPACT_FOOTERS))) {
      BinaryConfiguration bCfg=cfg.getBinaryConfiguration();
      if (bCfg == null) {
        bCfg=new BinaryConfiguration();
        cfg.setBinaryConfiguration(bCfg);
      }
      bCfg.setCompactFooter(false);
    }
  }
  if (Boolean.valueOf(GridTestProperties.getProperty(BINARY_MARSHALLER_USE_SIMPLE_NAME_MAPPER))) {
    BinaryConfiguration bCfg=cfg.getBinaryConfiguration();
    if (bCfg == null) {
      bCfg=new BinaryConfiguration();
      cfg.setBinaryConfiguration(bCfg);
    }
    bCfg.setNameMapper(new BinaryBasicNameMapper(true));
  }
  if (gridName != null && gridName.matches(".*\\d")) {
    String idStr=UUID.randomUUID().toString();
    if (gridName.startsWith(getTestGridName())) {
      String idxStr=String.valueOf(getTestGridIndex(gridName));
      while (idxStr.length() < 5)       idxStr='0' + idxStr;
      char[] chars=idStr.toCharArray();
      for (int i=0; i < idxStr.length(); i++)       chars[chars.length - idxStr.length() + i]=idxStr.charAt(i);
      cfg.setNodeId(UUID.fromString(new String(chars)));
    }
 else {
      char[] chars=idStr.toCharArray();
      chars[0]=gridName.charAt(gridName.length() - 1);
      chars[1]='0';
      chars[chars.length - 3]='0';
      chars[chars.length - 2]='0';
      chars[chars.length - 1]=gridName.charAt(gridName.length() - 1);
      cfg.setNodeId(UUID.fromString(new String(chars)));
    }
  }
  if (isMultiJvm())   ((TcpDiscoverySpi)cfg.getDiscoverySpi()).setIpFinder(LOCAL_IP_FINDER);
  return cfg;
}
