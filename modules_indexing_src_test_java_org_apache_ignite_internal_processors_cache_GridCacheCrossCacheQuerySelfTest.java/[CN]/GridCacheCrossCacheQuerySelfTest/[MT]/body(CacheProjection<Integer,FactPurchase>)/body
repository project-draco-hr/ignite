{
  int idGen=0;
  Cache<Integer,Object> dimCache=ignite.cache("replicated");
  for (int i=0; i < 2; i++) {
    int id=idGen++;
    dimCache.put(id,new DimStore(id,"Store" + id));
  }
  for (int i=0; i < 5; i++) {
    int id=idGen++;
    dimCache.put(id,new DimProduct(id,"Product" + id));
  }
  CacheProjection<Integer,DimStore> stores=dimCache.projection(Integer.class,DimStore.class);
  CacheProjection<Integer,DimProduct> prods=dimCache.projection(Integer.class,DimProduct.class);
  Cache<Integer,FactPurchase> factCache=ignite.cache("partitioned");
  List<DimStore> dimStores=new ArrayList<>(stores.values());
  Collections.sort(dimStores,new Comparator<DimStore>(){
    @Override public int compare(    DimStore o1,    DimStore o2){
      return o1.getId() > o2.getId() ? 1 : o1.getId() < o2.getId() ? -1 : 0;
    }
  }
);
  List<DimProduct> dimProds=new ArrayList<>(prods.values());
  Collections.sort(dimProds,new Comparator<DimProduct>(){
    @Override public int compare(    DimProduct o1,    DimProduct o2){
      return o1.getId() > o2.getId() ? 1 : o1.getId() < o2.getId() ? -1 : 0;
    }
  }
);
  for (int i=0; i < 10; i++) {
    int id=idGen++;
    DimStore store=dimStores.get(i % dimStores.size());
    DimProduct prod=dimProds.get(i % dimProds.size());
    factCache.put(id,new FactPurchase(id,prod.getId(),store.getId()));
  }
  CacheQuery<Map.Entry<Integer,FactPurchase>> qry=(prj == null ? factCache : prj).queries().createSqlQuery(FactPurchase.class,"from \"replicated\".DimStore, \"partitioned\".FactPurchase where DimStore.id = FactPurchase.storeId");
  List<Map.Entry<Integer,FactPurchase>> res=new ArrayList<>(qry.execute().get());
  Collections.sort(res,new Comparator<Map.Entry<Integer,FactPurchase>>(){
    @Override public int compare(    Map.Entry<Integer,FactPurchase> o1,    Map.Entry<Integer,FactPurchase> o2){
      return o1.getKey() > o2.getKey() ? 1 : o1.getKey() < o2.getKey() ? -1 : 0;
    }
  }
);
  return res;
}
