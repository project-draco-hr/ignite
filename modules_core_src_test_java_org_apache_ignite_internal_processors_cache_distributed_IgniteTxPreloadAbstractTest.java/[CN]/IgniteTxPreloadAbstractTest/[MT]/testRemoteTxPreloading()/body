{
  IgniteCache<String,Integer> cache=jcache(0);
  for (int i=0; i < 10000; i++)   cache.put(String.valueOf(i),0);
  final AtomicInteger gridIdx=new AtomicInteger(1);
  IgniteInternalFuture<?> fut=GridTestUtils.runMultiThreadedAsync(new Callable<Object>(){
    @Nullable @Override public Object call() throws Exception {
      int idx=gridIdx.getAndIncrement();
      startGrid(idx);
      return null;
    }
  }
,GRID_CNT - 1,"grid-starter-" + getName());
  waitForRemoteNodes(grid(0),2);
  Set<String> keys=new HashSet<>();
  for (int i=0; i < 10; i++)   keys.add(String.valueOf(i * 1000));
  cache.invokeAll(keys,new EntryProcessor<String,Integer,Void>(){
    @Override public Void process(    MutableEntry<String,Integer> e,    Object... args){
      Integer val=e.getValue();
      if (val == null) {
        keyNotLoaded=true;
        e.setValue(1);
        return null;
      }
      e.setValue(val + 1);
      return null;
    }
  }
);
  assertFalse(keyNotLoaded);
  fut.get();
  for (int i=0; i < GRID_CNT; i++)   jcache(i).rebalance().get();
  for (int i=0; i < GRID_CNT; i++) {
    for (    String key : keys)     assertEquals("Unexpected value for cache " + i,(Integer)1,jcache(i).get(key));
  }
}
