{
  GridDrEntry<K,V> oldEntry=old.drEntry();
  if (newVal == null && newValBytes != null)   newVal=cctx.marshaller().unmarshal(newValBytes,cctx.deploy().globalLoader());
  long newExpireTime=newDrExpireTime >= 0L ? newDrExpireTime : CU.toExpireTime(newTtl);
  GridDrEntry<K,V> newEntry=new GridDrPlainEntry<>(key,newVal,newTtl,newExpireTime,newVer);
  GridDrReceiverConflictContextImpl<K,V> ctx=cctx.drResolveConflict(key,oldEntry,newEntry);
  if (ctx.isMerge()) {
    V resVal=ctx.mergeValue();
    if ((op == CREATE || op == UPDATE) && resVal == null)     op=DELETE;
 else     if (op == DELETE && resVal != null)     op=old.isNewLocked() ? CREATE : UPDATE;
  }
  return F.t(op,ctx);
}
