{
  GridConfiguration cfg=new GridConfiguration();
  cfg.setLocalHost("127.0.0.1");
  cfg.setDeploymentMode(SHARED);
  cfg.setPeerClassLoadingEnabled(true);
  GridOptimizedMarshaller marsh=new GridOptimizedMarshaller();
  marsh.setRequireSerializable(false);
  GridH2IndexingSpi indexSpi=new GridH2IndexingSpi();
  indexSpi.setDefaultIndexPrimitiveKey(true);
  indexSpi.setDefaultIndexFixedTyping(false);
  cfg.setIndexingSpi(indexSpi);
  cfg.setClientMessageInterceptor(new ClientBigIntegerMessageInterceptor());
  GridCacheConfiguration cacheCfg=new GridCacheConfiguration();
  cacheCfg.setName("partitioned");
  cacheCfg.setCacheMode(PARTITIONED);
  cacheCfg.setAtomicityMode(ATOMIC);
  cacheCfg.setWriteSynchronizationMode(PRIMARY_SYNC);
  cacheCfg.setPartitionedDistributionMode(PARTITIONED_ONLY);
  cacheCfg.setAffinity(new GridCachePartitionedAffinity(1));
  cacheCfg.setStartSize(1500000);
  cacheCfg.setQueryIndexEnabled(false);
  cacheCfg.setPreloadMode(SYNC);
  cfg.setCacheConfiguration(cacheCfg);
  GridTcpDiscoverySpi discoSpi=new GridTcpDiscoverySpi();
  GridTcpDiscoveryVmIpFinder ipFinder=new GridTcpDiscoveryVmIpFinder();
  Collection<String> addrs=new ArrayList<>();
  for (int i=0; i < 10; i++)   addrs.add("127.0.0.1:" + (47500 + i));
  ipFinder.setAddresses(addrs);
  discoSpi.setIpFinder(ipFinder);
  cfg.setDiscoverySpi(discoSpi);
  return cfg;
}
