{
  if (msg.verified() && joinLatch.getCount() == 0) {
    DiscoverySpiListener lsnr=TcpClientDiscoverySpi.this.lsnr;
    if (lsnr != null) {
      UUID nodeId=msg.creatorNodeId();
      TcpDiscoveryNode node=nodeId.equals(getLocalNodeId()) ? locNode : rmtNodes.get(nodeId);
      if (node != null && node.visible()) {
        try {
          DiscoverySpiCustomMessage msgObj=marsh.unmarshal(msg.messageBytes(),U.gridClassLoader());
          notifyDiscovery(EVT_DISCOVERY_CUSTOM_EVT,topVer,node,allVisibleNodes(),msgObj);
        }
 catch (        Throwable e) {
          U.error(log,"Failed to unmarshal discovery custom message.",e);
        }
      }
 else       if (log.isDebugEnabled())       log.debug("Received metrics from unknown node: " + nodeId);
    }
  }
}
