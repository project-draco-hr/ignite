{
  if (nodeId.equals(getLocalNodeId()))   return true;
  TcpDiscoveryNode node=rmtNodes.get(nodeId);
  if (node == null || !node.visible())   return false;
  GridFutureAdapter<Boolean> fut=pingFuts.get(nodeId);
  if (fut == null) {
    fut=new GridFutureAdapter<>();
    GridFutureAdapter<Boolean> oldFut=pingFuts.putIfAbsent(nodeId,fut);
    if (oldFut != null)     fut=oldFut;
 else {
      if (getSpiContext().isStopping()) {
        if (pingFuts.remove(nodeId,fut))         fut.onDone(false);
        return false;
      }
      sockWriter.sendMessage(new TcpDiscoveryClientPingRequest(getLocalNodeId(),nodeId));
    }
  }
  final GridFutureAdapter<Boolean> finalFut=fut;
  timer.schedule(new TimerTask(){
    @Override public void run(){
      if (pingFuts.remove(nodeId,finalFut))       finalFut.onDone(false);
    }
  }
,netTimeout);
  try {
    return fut.get();
  }
 catch (  IgniteCheckedException e) {
    throw new IgniteSpiException(e);
  }
}
