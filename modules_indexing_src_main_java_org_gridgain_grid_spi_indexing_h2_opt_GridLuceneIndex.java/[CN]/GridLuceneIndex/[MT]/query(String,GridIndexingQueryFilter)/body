{
  IndexReader reader;
  try {
    long updates=updateCntr.get();
    if (updates != 0) {
      writer.commit();
      updateCntr.addAndGet(-updates);
    }
    reader=IndexReader.open(writer,true);
  }
 catch (  IOException e) {
    throw new GridSpiException(e);
  }
  IndexSearcher searcher=new IndexSearcher(reader);
  MultiFieldQueryParser parser=new MultiFieldQueryParser(Version.LUCENE_30,idxdFields,writer.getAnalyzer());
  Filter f=new TermRangeFilter(EXPIRATION_TIME_FIELD_NAME,DateTools.timeToString(U.currentTimeMillis(),DateTools.Resolution.MILLISECOND),null,false,false);
  TopDocs docs;
  try {
    docs=searcher.search(parser.parse(qry),f,Integer.MAX_VALUE);
  }
 catch (  Exception e) {
    throw new GridSpiException(e);
  }
  IgniteBiPredicate<K,V> fltr=null;
  if (filters != null) {
    try {
      fltr=filters.forSpace(spaceName);
    }
 catch (    GridException e) {
      throw new GridSpiException(e);
    }
  }
  return new It<>(reader,searcher,docs.scoreDocs,fltr);
}
