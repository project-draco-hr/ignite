{
  IgniteConfiguration cfg=super.getConfiguration(gridName);
  TcpDiscoverySpi spi=new TcpDiscoverySpi();
  spi.setIpFinder(ipFinder);
  cfg.setDiscoverySpi(spi);
  cfg.setIncludeProperties();
  cfg.setMarshaller(new OptimizedMarshaller(false));
  if (useCache) {
    CacheConfiguration cc=defaultCacheConfiguration();
    cc.setCacheMode(mode);
    cc.setAtomicityMode(TRANSACTIONAL);
    cc.setDistributionMode(nearEnabled ? NEAR_PARTITIONED : PARTITIONED_ONLY);
    cc.setWriteSynchronizationMode(FULL_SYNC);
    cc.setEvictSynchronized(false);
    cc.setEvictNearSynchronized(false);
    if (store != null) {
      cc.setCacheStoreFactory(new FactoryBuilder.SingletonFactory(store));
      cc.setReadThrough(true);
      cc.setWriteThrough(true);
    }
    cfg.setCacheConfiguration(cc);
  }
 else   cfg.setCacheConfiguration();
  return cfg;
}
