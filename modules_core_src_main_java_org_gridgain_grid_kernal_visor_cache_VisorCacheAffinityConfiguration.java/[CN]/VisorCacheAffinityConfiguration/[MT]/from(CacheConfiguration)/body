{
  GridCacheAffinityFunction aff=ccfg.getAffinity();
  Integer dfltReplicas=null;
  Boolean excludeNeighbors=null;
  if (aff instanceof GridCacheConsistentHashAffinityFunction) {
    GridCacheConsistentHashAffinityFunction hashAffFunc=(GridCacheConsistentHashAffinityFunction)aff;
    dfltReplicas=hashAffFunc.getDefaultReplicas();
    excludeNeighbors=hashAffFunc.isExcludeNeighbors();
  }
  VisorCacheAffinityConfiguration cfg=new VisorCacheAffinityConfiguration();
  cfg.function(compactClass(aff));
  cfg.mapper(compactClass(ccfg.getAffinityMapper()));
  cfg.partitionedBackups(ccfg.getBackups());
  cfg.defaultReplicas(dfltReplicas);
  cfg.excludeNeighbors(excludeNeighbors);
  return cfg;
}
