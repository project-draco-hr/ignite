{
  GridCacheWriteSynchronizationMode syncMode=updateReq.writeSynchronizationMode();
  keys.add(entry.key());
  long topVer=updateReq.topologyVersion();
  for (  UUID nodeId : readers) {
    GridDhtAtomicUpdateRequest<K,V> updateReq=mappings.get(nodeId);
    if (updateReq == null) {
      GridNode node=ctx.discovery().node(nodeId);
      if (node == null)       continue;
      boolean supportsForceTransformBackup=node.version().compareTo(FORCE_TRANSFORM_BACKUP_SINCE) >= 0;
      updateReq=new GridDhtAtomicUpdateRequest<>(nodeId,futVer,writeVer,syncMode,topVer,ttl,forceTransformBackups && supportsForceTransformBackup,this.updateReq.subjectId(),this.updateReq.taskNameHash());
      mappings.put(nodeId,updateReq);
    }
    if (nearReadersEntries == null)     nearReadersEntries=new HashMap<>();
    nearReadersEntries.put(entry.key(),entry);
    updateReq.addNearWriteValue(entry.key(),entry.keyBytes(),val,valBytes,transformC);
  }
}
