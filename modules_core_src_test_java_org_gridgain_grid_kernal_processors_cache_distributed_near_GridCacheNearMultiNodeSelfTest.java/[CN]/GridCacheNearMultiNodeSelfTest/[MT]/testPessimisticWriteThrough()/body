{
  GridCache<Integer,String> near=cache(0);
  GridCacheTx tx=near.txStart(PESSIMISTIC,REPEATABLE_READ,0,0);
  try {
    assertTrue(near.putx(2,"2"));
    String s=near.put(3,"3");
    assertNotNull(s);
    assertEquals("3",s);
    assertEquals("2",near.peek(2));
    assertEquals("3",near.peek(3));
    assertNotNull(dht(primaryGrid(3)).peek(3,F.asList(GLOBAL)));
    tx.commit();
  }
  finally {
    tx.close();
  }
  assertEquals("2",near.peek(2));
  assertEquals("3",near.peek(3));
  assertEquals("2",dht(primaryGrid(2)).peek(2));
  assertEquals("3",dht(primaryGrid(3)).peek(3));
  assertEquals(2,near.size());
  assertEquals(2,near.size());
}
