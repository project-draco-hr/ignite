{
  IgniteConfiguration cfg=super.getConfiguration(gridName);
  TcpDiscoverySpi discoSpi=new TcpDiscoverySpi();
  discoSpi.setIpFinder(ipFinder);
  cfg.setDiscoverySpi(discoSpi);
  GridCacheConfiguration cCfg=new GridCacheConfiguration();
  cCfg.setCacheMode(PARTITIONED);
  cCfg.setBackups(1);
  cCfg.setWriteSynchronizationMode(FULL_SYNC);
  cCfg.setDistributionMode(partDistMode);
  cCfg.setAtomicWriteOrderMode(writeOrderMode);
  if (idx == 0)   cCfg.setDistributionMode(partDistMode);
 else   cCfg.setDistributionMode(PARTITIONED_ONLY);
  idx++;
  cfg.setCacheConfiguration(cCfg);
  cfg.setCommunicationSpi(new TestCommunicationSpi());
  return cfg;
}
