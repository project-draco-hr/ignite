{
  final Collection<UUID> added=new ArrayList<>(1);
  final Collection<UUID> rmvd=new ArrayList<>(1);
  assertEquals(NODES_CNT,client.compute().refreshTopology(false,false).size());
  GridClientTopologyListener lsnr=new GridClientTopologyListener(){
    @Override public void onNodeAdded(    GridClientNode node){
      added.add(node.nodeId());
    }
    @Override public void onNodeRemoved(    GridClientNode node){
      rmvd.add(node.nodeId());
    }
  }
;
  client.addTopologyListener(lsnr);
  try {
    Grid g=startGrid(NODES_CNT + 1);
    UUID id=g.localNode().id();
    Thread.sleep(2 * TOP_REFRESH_FREQ);
    assertEquals(1,added.size());
    assertEquals(id,F.first(added));
    stopGrid(NODES_CNT + 1);
    Thread.sleep(2 * TOP_REFRESH_FREQ);
    assertEquals(1,rmvd.size());
    assertEquals(id,F.first(rmvd));
  }
  finally {
    client.removeTopologyListener(lsnr);
    stopGrid(NODES_CNT + 1);
  }
}
