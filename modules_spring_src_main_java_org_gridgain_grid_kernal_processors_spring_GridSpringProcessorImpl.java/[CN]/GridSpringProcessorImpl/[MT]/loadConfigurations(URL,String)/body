{
  ApplicationContext springCtx;
  try {
    springCtx=applicationContext(cfgUrl,excludedProps);
  }
 catch (  BeansException e) {
    if (X.hasCause(e,ClassNotFoundException.class))     throw new GridException("Failed to instantiate Spring XML application context " + "(make sure all classes used in Spring configuration are present at CLASSPATH) " + "[springUrl=" + cfgUrl + ']',e);
 else     throw new GridException("Failed to instantiate Spring XML application context [springUrl=" + cfgUrl + ", err="+ e.getMessage()+ ']',e);
  }
  Map<String,IgniteConfiguration> cfgMap;
  try {
    cfgMap=springCtx.getBeansOfType(IgniteConfiguration.class);
  }
 catch (  BeansException e) {
    throw new GridException("Failed to instantiate bean [type=" + IgniteConfiguration.class + ", err="+ e.getMessage()+ ']',e);
  }
  if (cfgMap == null || cfgMap.isEmpty())   throw new GridException("Failed to find grid configuration in: " + cfgUrl);
  return F.t(cfgMap.values(),new GridSpringResourceContextImpl(springCtx));
}
