{
  final CountDownLatch killedLatch=new CountDownLatch(1);
  final CountDownLatch readyLatch=new CountDownLatch(1);
  final ProcessStartResult res=new ProcessStartResult();
  GridJavaProcess proc=GridJavaProcess.exec(GridGgfsSharedMemoryTestClient.class,null,log,new CI1<String>(){
    @Override public void apply(    String s){
      info("Client process prints: " + s);
      if (s.startsWith(GridGgfsSharedMemoryTestClient.SHMEM_IDS_MSG_PREFIX)) {
        res.shmemIds(s.substring(GridGgfsSharedMemoryTestClient.SHMEM_IDS_MSG_PREFIX.length()));
        readyLatch.countDown();
      }
    }
  }
,new CA(){
    @Override public void apply(){
      info("Client is killed");
      killedLatch.countDown();
    }
  }
,null,System.getProperty("surefire.test.class.path"));
  res.proc(proc);
  res.isKilledLatch(killedLatch);
  res.isReadyLatch(readyLatch);
  return res;
}
