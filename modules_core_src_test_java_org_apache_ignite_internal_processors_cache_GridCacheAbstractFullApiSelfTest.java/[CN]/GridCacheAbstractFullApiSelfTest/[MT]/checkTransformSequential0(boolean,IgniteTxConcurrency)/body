{
  IgniteCache<String,Integer> cache=jcache();
  IgniteTx tx=txEnabled() ? ignite(0).transactions().txStart(concurrency,READ_COMMITTED) : null;
  try {
    if (startVal)     cache.put("key",2);
    cache.invoke("key",INCR_PROCESSOR);
    cache.invoke("key",INCR_PROCESSOR);
    cache.invoke("key",INCR_PROCESSOR);
    if (tx != null)     tx.commit();
  }
  finally {
    if (tx != null)     tx.close();
  }
  Integer exp=(startVal ? 2 : 0) + 3;
  assertEquals(exp,cache.get("key"));
  for (int i=0; i < gridCount(); i++) {
    if (ignite(i).affinity(null).isPrimaryOrBackup(grid(i).localNode(),"key"))     assertEquals(exp,peek(jcache(i),"key"));
  }
}
