{
  GridCacheContext<String,Integer> ctx=((IgniteKernal)ignite).<String,Integer>internalCache().context();
  int size=0;
  for (  String key : map.keySet())   if (ctx.affinity().localNode(key,new AffinityTopologyVersion(ctx.discovery().topologyVersion())))   size++;
  assertEquals("Incorrect key size on cache #" + idx,size,ignite.cache(ctx.name()).localSize(ALL));
}
