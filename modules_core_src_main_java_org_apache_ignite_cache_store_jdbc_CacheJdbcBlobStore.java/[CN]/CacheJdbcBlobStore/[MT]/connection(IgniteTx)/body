{
  if (tx != null) {
    Map<Object,Object> props=session().properties();
    Connection conn=(Connection)props.get(ATTR_CONN);
    if (conn == null) {
      conn=openConnection(false);
      props.put(ATTR_CONN,conn);
    }
    return conn;
  }
 else   return openConnection(true);
}
