{
  final CollectionConfiguration colCfg=collectionConfiguration();
  colCfg.setCollocated(false);
  colCfg.setCacheMode(CacheMode.PARTITIONED);
  final IgniteQueue queue=grid(0).queue("Queue1",0,colCfg);
  GridTestUtils.assertThrows(log,new Callable<Void>(){
    @Override public Void call() throws Exception {
      queue.affinityRun(new IgniteRunnable(){
        @Override public void run(){
          ;
        }
      }
);
      return null;
    }
  }
,IgniteException.class,"Failed to execute affinityRun() for non-collocated queue: " + queue.name() + ". This operation is supported only for collocated queues.");
  queue.close();
  colCfg.setCollocated(true);
  final IgniteQueue queue2=grid(0).queue("Queue2",0,colCfg);
  queue2.add(100);
  queue2.affinityRun(new IgniteRunnable(){
    @Override public void run(){
      assert((int)queue2.take() == 100);
    }
  }
);
  queue2.close();
}
