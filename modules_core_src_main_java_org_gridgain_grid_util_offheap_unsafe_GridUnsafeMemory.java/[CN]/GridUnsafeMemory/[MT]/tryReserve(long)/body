{
  if (total == 0) {
    allocated.addAndGet(size);
    return true;
  }
  for (; ; ) {
    long oldSize=allocated.get();
    long newSize=oldSize + size;
    if (newSize > total)     return false;
    if (allocated.compareAndSet(oldSize,newSize))     return true;
  }
}
