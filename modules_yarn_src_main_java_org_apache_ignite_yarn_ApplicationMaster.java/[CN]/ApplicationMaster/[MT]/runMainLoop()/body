{
  AMRMClientAsync<AMRMClient.ContainerRequest> rmClient=AMRMClientAsync.createAMRMClientAsync(100,this);
  rmClient.init(getConfiguration());
  rmClient.start();
  System.out.println("[AM] registerApplicationMaster 0");
  rmClient.registerApplicationMaster("",0,"");
  System.out.println("[AM] registerApplicationMaster 1");
  Priority priority=Records.newRecord(Priority.class);
  priority.setPriority(0);
  Resource capability=Records.newRecord(Resource.class);
  capability.setMemory(128);
  capability.setVirtualCores(1);
  for (int i=0; i < numContainersToWaitFor; ++i) {
    AMRMClient.ContainerRequest containerAsk=new AMRMClient.ContainerRequest(capability,null,null,priority);
    System.out.println("[AM] Making res-req " + i);
    rmClient.addContainerRequest(containerAsk);
  }
  System.out.println("[AM] waiting for containers to finish");
  while (!doneWithContainers()) {
    Thread.sleep(100);
  }
  System.out.println("[AM] unregisterApplicationMaster 0");
  rmClient.unregisterApplicationMaster(FinalApplicationStatus.SUCCEEDED,"","");
  System.out.println("[AM] unregisterApplicationMaster 1");
}
