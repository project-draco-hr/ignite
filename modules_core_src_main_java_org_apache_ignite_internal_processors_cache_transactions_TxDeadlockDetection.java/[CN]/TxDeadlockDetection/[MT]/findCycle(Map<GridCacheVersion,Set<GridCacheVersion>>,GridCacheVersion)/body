{
  if (wfg == null || wfg.isEmpty())   return null;
  ArrayDeque<GridCacheVersion> stack=new ArrayDeque<>();
  Set<GridCacheVersion> inPath=new HashSet<>();
  Set<GridCacheVersion> visited=new HashSet<>();
  Map<GridCacheVersion,GridCacheVersion> edgeTo=new HashMap<>();
  stack.push(txId);
  while (!stack.isEmpty()) {
    GridCacheVersion v=stack.peek();
    if (visited.contains(v)) {
      stack.pop();
      inPath.remove(v);
      continue;
    }
    visited.add(v);
    Set<GridCacheVersion> children=wfg.get(v);
    if (children == null || children.isEmpty()) {
      stack.pop();
      inPath.remove(v);
      continue;
    }
    inPath.add(v);
    for (    GridCacheVersion w : children) {
      if (inPath.contains(w) && visited.contains(w)) {
        List<GridCacheVersion> cycle=new ArrayList<>();
        for (GridCacheVersion x=v; !x.equals(w); x=edgeTo.get(x))         cycle.add(x);
        cycle.add(w);
        cycle.add(v);
        return cycle;
      }
      edgeTo.put(w,v);
      stack.push(w);
    }
  }
  return null;
}
