{
  replicatedAffinity=false;
  preloadMode=NONE;
  Grid g1=startGrid("g1");
  Collection<Integer> keys=new HashSet<>();
  GridCache<Integer,String> cache=g1.cache(null);
  for (int i=0; i < 100; i++) {
    keys.add(i);
    cache.put(i,"val");
  }
  Grid g2=startGrid("g2");
  Map<GridNode,Collection<Object>> keysMap=g1.cache(null).affinity().mapKeysToNodes(keys);
  Collection<Object> g2Keys=keysMap.get(g2.cluster().localNode());
  assertNotNull(g2Keys);
  assertFalse("There are no keys assigned to g2",g2Keys.isEmpty());
  for (  Object key : g2Keys)   g2.cache(null).put(key,"changed val");
  Collection<GridEvent> evts=g2.events().localQuery(F.<GridEvent>alwaysTrue(),EVT_CACHE_PRELOAD_OBJECT_LOADED);
  checkPreloadEvents(evts,g2,g2Keys);
}
