{
  ctx.kernalContext().io().addUserMessageListener(GridTopic.TOPIC_HADOOP,new GridBiPredicate<UUID,Object>(){
    @Override public boolean apply(    UUID nodeId,    Object msg){
      if (msg instanceof GridHadoopShuffleMessage) {
        GridHadoopShuffleMessage m=(GridHadoopShuffleMessage)msg;
        try {
          job(m.jobId()).onShuffleMessage(m);
        }
 catch (        GridException e) {
          U.error(log,"Message handling failed.",e);
        }
        send0(nodeId,new GridHadoopShuffleAck(m.id(),m.jobId()));
      }
 else       if (msg instanceof GridHadoopShuffleAck) {
        GridHadoopShuffleAck m=(GridHadoopShuffleAck)msg;
        GridBiTuple<GridHadoopShuffleMessage,GridFutureAdapter<?>> t=sentMsgs.remove(m.id());
        if (t != null)         t.get2().onDone();
      }
 else       throw new IllegalStateException("Message unknown: " + msg);
      return true;
    }
  }
);
}
