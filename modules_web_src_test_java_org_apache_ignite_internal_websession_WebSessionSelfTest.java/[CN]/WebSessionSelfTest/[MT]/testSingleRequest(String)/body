{
  Server srv=null;
  try {
    srv=startServer(TEST_JETTY_PORT,cfg,null,new SessionCreateServlet(keepBinary()));
    URLConnection conn=new URL("http://localhost:" + TEST_JETTY_PORT + "/ignitetest/test").openConnection();
    conn.connect();
    try (BufferedReader rdr=new BufferedReader(new InputStreamReader(conn.getInputStream()))){
      String sesId=rdr.readLine();
      if (!keepBinary()) {
        IgniteCache<String,HttpSession> cache=G.ignite().cache(getCacheName());
        assertNotNull(cache);
        HttpSession ses=cache.get(sesId);
        assertNotNull(ses);
        assertEquals("val1",ses.getAttribute("key1"));
      }
 else {
        final IgniteCache<String,WebSessionEntity> cache=G.ignite().cache(getCacheName());
        assertNotNull(cache);
        final WebSessionEntity entity=cache.get(sesId);
        assertNotNull(entity);
        final byte[] data=entity.attributes().get("key1");
        assertNotNull(data);
        final Marshaller marshaller=G.ignite().configuration().getMarshaller();
        final String val=marshaller.unmarshal(data,getClass().getClassLoader());
        assertEquals("val1",val);
      }
    }
   }
  finally {
    stopServer(srv);
  }
}
