{
  if (ccfg != null) {
    CacheMemoryMode memMode=ccfg.getMemoryMode();
    boolean storeVal=ctx.config().isPeerClassLoadingEnabled() || GridQueryProcessor.isEnabled(ccfg) || !ccfg.isCopyOnRead();
    return new CacheObjectContext(ctx,new GridCacheDefaultAffinityKeyMapper(),ccfg.isCopyOnRead() && memMode == ONHEAP_TIERED,storeVal);
  }
 else   return new CacheObjectContext(ctx,new GridCacheDefaultAffinityKeyMapper(),false,ctx.config().isPeerClassLoadingEnabled());
}
