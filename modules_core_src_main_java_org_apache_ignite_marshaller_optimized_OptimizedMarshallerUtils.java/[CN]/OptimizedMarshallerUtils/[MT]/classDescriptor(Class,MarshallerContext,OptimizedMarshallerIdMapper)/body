{
  OptimizedClassDescriptor desc=DESC_BY_CLS.get(cls);
  if (desc == null) {
    int typeId=resolveTypeId(cls.getName(),mapper);
    boolean registered=ctx.registerClass(typeId,cls);
    desc=new OptimizedClassDescriptor(cls,registered ? typeId : 0,ctx,mapper);
    if (registered) {
      OptimizedClassDescriptor old=DESC_BY_CLS.putIfAbsent(cls,desc);
      if (old != null)       desc=old;
    }
  }
  return desc;
}
