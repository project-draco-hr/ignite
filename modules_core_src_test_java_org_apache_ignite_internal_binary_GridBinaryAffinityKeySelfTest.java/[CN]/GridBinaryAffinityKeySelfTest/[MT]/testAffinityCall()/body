{
  Affinity<Object> aff=grid(0).affinity(null);
  for (int i=0; i < 1000; i++) {
    nodeId.set(null);
    grid(0).compute().affinityCall((String)null,new TestObject(i),new IgniteCallable<Object>(){
      @IgniteInstanceResource private Ignite ignite;
      @Override public Object call(){
        nodeId.set(ignite.configuration().getNodeId());
        return null;
      }
    }
);
    assertEquals(aff.mapKeyToNode(i).id(),nodeId.get());
  }
}
