{
  if (obj == null)   return null;
  ByteArrayOutputStream stream=null;
  ObjectOutputStream out=null;
  try {
    stream=new ByteArrayOutputStream(DFLT_BUFFER_SIZE);
    out=new ObjectOutputStream(stream);
    out.writeObject(obj);
    out.flush();
    return ByteBuffer.wrap(stream.toByteArray());
  }
 catch (  IOException e) {
    throw new IllegalStateException("Failed to serialize object of the class '" + obj.getClass().getName() + "'",e);
  }
 finally {
    U.closeQuiet(out);
    U.closeQuiet(stream);
  }
}
