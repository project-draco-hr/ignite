{
  Enumeration<NetworkInterface> ifaces=NetworkInterface.getNetworkInterfaces();
  while (ifaces.hasMoreElements()) {
    NetworkInterface iface=ifaces.nextElement();
    Enumeration<InetAddress> addresses=iface.getInetAddresses();
    while (addresses.hasMoreElements()) {
      InetAddress addr=addresses.nextElement();
      if (addr instanceof Inet4Address && !addr.isLoopbackAddress())       return addr.getHostAddress();
    }
  }
  throw new RuntimeException("Failed. Couldn't find non-loopback address");
}
