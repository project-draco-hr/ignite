{
  CacheStoreSession ses=session();
  Transaction tx=ses.transaction();
  if (tx != null) {
    Map<String,Connection> sesProps=ses.properties();
    Connection conn=sesProps.get(ATTR_CONN_PROP);
    if (conn != null) {
      sesProps.remove(ATTR_CONN_PROP);
      try {
        if (commit)         conn.commit();
 else         conn.rollback();
      }
 catch (      SQLException e) {
        throw new CacheWriterException("Failed to end transaction [xid=" + tx.xid() + ", commit="+ commit+ ']',e);
      }
 finally {
        U.closeQuiet(conn);
      }
    }
    if (log.isDebugEnabled())     log.debug("Transaction ended [xid=" + tx.xid() + ", commit="+ commit+ ']');
  }
}
