{
  try {
    startGrids(2);
    GridEx grid=grid(0);
    GridCache<Object,Object> cache=grid.cache(null);
    int keyCnt=100;
    for (int i=0; i < keyCnt; i++)     cache.put(i,i);
    startGrid(2);
    awaitPartitionMapExchange();
    for (int i=0; i < keyCnt; i++) {
      for (int g=0; g < 3; g++) {
        GridEx locGrid=grid(g);
        GridNode node=locGrid.localNode();
        Collection<GridNode> affNodes=cache.affinity().mapKeyToPrimaryAndBackups(i);
        if (affNodes.contains(node))         assertEquals(i,locGrid.cache(null).peek(i));
      }
    }
  }
  finally {
    stopAllGrids();
  }
}
