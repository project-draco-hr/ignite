{
  if (off + n > max)   n=max - off;
  off+=n;
  return n;
}
