{
  ctx.config().setCommunicationSpi(new GridTcpCommunicationSpi());
  ctx.config().setMarshaller(new GridJdkMarshaller());
  ctx.config().setPeerClassLoadingEnabled(false);
  GridDiscoveryManager mockedDiscoveryMgr=Mockito.mock(GridDiscoveryManager.class);
  when(mockedDiscoveryMgr.localNode()).thenReturn(locNode);
  when(mockedDiscoveryMgr.remoteNodes()).thenReturn(F.<GridNode>asList(rmtNode));
  ctx.add(mockedDiscoveryMgr);
}
