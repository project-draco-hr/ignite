{
  Ignite ignite0=startGrid(0);
  TestCommunicationSpi spi0=(TestCommunicationSpi)ignite0.configuration().getCommunicationSpi();
  Ignite ignite1=startGrid(1);
  TestCommunicationSpi spi1=(TestCommunicationSpi)ignite1.configuration().getCommunicationSpi();
  assertEquals(0,spi0.partitionsSingleMessages().size());
  assertEquals(1,spi0.partitionsFullMessages().size());
  assertEquals(1,spi1.partitionsSingleMessages().size());
  assertEquals(0,spi1.partitionsFullMessages().size());
  spi0.reset();
  spi1.reset();
  client=true;
  for (int i=0; i < 3; i++) {
    log.info("Start client node: " + i);
    Ignite ignite2=startGrid(2);
    TestCommunicationSpi spi2=(TestCommunicationSpi)ignite2.configuration().getCommunicationSpi();
    assertEquals(0,spi0.partitionsSingleMessages().size());
    assertEquals(1,spi0.partitionsFullMessages().size());
    assertEquals(0,spi1.partitionsSingleMessages().size());
    assertEquals(0,spi1.partitionsFullMessages().size());
    assertEquals(1,spi2.partitionsSingleMessages().size());
    assertEquals(0,spi2.partitionsFullMessages().size());
    spi0.reset();
    spi1.reset();
    spi2.reset();
    log.info("Stop client node.");
    ignite2.close();
    assertEquals(0,spi0.partitionsSingleMessages().size());
    assertEquals(0,spi0.partitionsFullMessages().size());
    assertEquals(0,spi1.partitionsSingleMessages().size());
    assertEquals(0,spi1.partitionsFullMessages().size());
  }
}
