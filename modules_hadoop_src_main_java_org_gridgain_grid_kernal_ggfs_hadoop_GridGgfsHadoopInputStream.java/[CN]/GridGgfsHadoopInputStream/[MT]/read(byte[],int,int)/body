{
  checkClosed();
  if (eof())   return -1;
  readStart();
  try {
    long remaining=limit - pos;
    int read=buf.flatten(b,pos,off,len);
    pos+=read;
    total+=read;
    remaining-=read;
    if (remaining > 0 && read != len) {
      int readAmt=(int)Math.min(remaining,len - read);
      GridPlainFuture<byte[]> readFut=rmtClient.readData(streamId,pos,readAmt,b,off + read,len - read);
      readFut.get();
      read+=readAmt;
      pos+=readAmt;
      total+=readAmt;
    }
    buf.refreshAhead(pos);
    return read;
  }
 catch (  GridException e) {
    throw new IOException(e);
  }
 finally {
    readEnd();
  }
}
