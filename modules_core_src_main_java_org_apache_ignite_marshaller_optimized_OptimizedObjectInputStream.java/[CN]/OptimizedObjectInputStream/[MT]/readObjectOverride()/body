{
  curObj=null;
  curFields=null;
  curFieldInfoList=null;
  curFieldInfoMap=null;
  byte ref=in.readByte();
switch (ref) {
case NULL:
    return null;
case HANDLE:
  return handles.lookup(readInt());
case OBJECT:
int typeId=readInt();
OptimizedClassDescriptor desc=OptimizedMarshallerUtils.classDescriptor(typeId,clsLdr,ctx,mapper);
curCls=desc.describedClass();
return desc.read(this);
case JDK:
try {
return JDK_MARSH.unmarshal(this,clsLdr);
}
 catch (IgniteCheckedException e) {
IOException ioEx=e.getCause(IOException.class);
if (ioEx != null) throw ioEx;
 else throw new IOException("Failed to deserialize object with JDK marshaller.",e);
}
default :
SB msg=new SB("Unexpected error occurred during unmarshalling");
if (curCls != null) msg.a(" of an instance of the class: ").a(curCls.getName());
msg.a(". Check that all nodes are running the same version of Ignite and that all nodes have " + "GridOptimizedMarshaller configured with identical optimized classes lists, if any " + "(see setClassNames and setClassNamesPath methods). If your serialized classes implement "+ "java.io.Externalizable interface, verify that serialization logic is correct.");
throw new IOException(msg.toString());
}
}
