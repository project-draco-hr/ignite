{
  if (busyLock.enterBusy()) {
    try {
      validTxState(false);
      IgniteInternalTx tx=metaCache.txStartEx(PESSIMISTIC,REPEATABLE_READ);
      try {
        Object prev=val != null ? metaCache.getAndPut(sampling,val) : metaCache.getAndRemove(sampling);
        tx.commit();
        return !F.eq(prev,val);
      }
  finally {
        tx.close();
      }
    }
  finally {
      busyLock.leaveBusy();
    }
  }
 else   throw new IllegalStateException("Failed to set sampling flag because Grid is stopping.");
}
