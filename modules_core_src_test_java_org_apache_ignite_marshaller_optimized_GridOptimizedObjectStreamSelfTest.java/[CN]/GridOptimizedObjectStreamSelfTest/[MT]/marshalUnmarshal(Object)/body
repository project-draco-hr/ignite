{
  GridOptimizedObjectOutputStream out=null;
  GridOptimizedObjectInputStream in=null;
  try {
    out=GridOptimizedObjectStreamRegistry.out();
    out.requireSerializable(true);
    out.writeObject(obj);
    byte[] arr=out.out().array();
    in=GridOptimizedObjectStreamRegistry.in();
    in.classLoader(getClass().getClassLoader());
    in.in().bytes(arr,arr.length);
    Object obj0=in.readObject();
    checkHandles(out,in);
    return (T)obj0;
  }
  finally {
    GridOptimizedObjectStreamRegistry.closeOut(out);
    GridOptimizedObjectStreamRegistry.closeIn(in);
  }
}
