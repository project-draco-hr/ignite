{
  IgniteOptimizedObjectOutputStream out=null;
  IgniteOptimizedObjectInputStream in=null;
  try {
    out=IgniteOptimizedObjectStreamRegistry.out();
    out.requireSerializable(true);
    out.writeObject(obj);
    byte[] arr=out.out().array();
    in=IgniteOptimizedObjectStreamRegistry.in();
    in.classLoader(getClass().getClassLoader());
    in.in().bytes(arr,arr.length);
    Object obj0=in.readObject();
    checkHandles(out,in);
    return (T)obj0;
  }
  finally {
    IgniteOptimizedObjectStreamRegistry.closeOut(out);
    IgniteOptimizedObjectStreamRegistry.closeIn(in);
  }
}
