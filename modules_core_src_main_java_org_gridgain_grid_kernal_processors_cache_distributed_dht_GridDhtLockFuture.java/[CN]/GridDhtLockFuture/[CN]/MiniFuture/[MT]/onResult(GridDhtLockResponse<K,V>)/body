{
  if (res.error() != null)   onError(res.error());
 else {
    if (nearMapping != null && !F.isEmpty(res.nearEvicted())) {
      if (tx != null) {
        GridDistributedTxMapping<K,V> m=tx.nearMapping(node.id());
        if (m != null)         m.evictReaders(res.nearEvicted());
      }
      evictReaders(cctx,res.nearEvicted(),node.id(),res.messageId(),nearMapping);
    }
    Set<Integer> invalidParts=res.invalidPartitions();
    if (!F.isEmpty(invalidParts)) {
      for (Iterator<GridDhtCacheEntry<K,V>> it=dhtMapping.iterator(); it.hasNext(); ) {
        GridDhtCacheEntry<K,V> entry=it.next();
        if (invalidParts.contains(entry.partition())) {
          it.remove();
          if (log.isDebugEnabled())           log.debug("Removed mapping for entry [nodeId=" + node.id() + ", entry="+ entry+ ", fut="+ GridDhtLockFuture.this+ ']');
          if (tx != null)           tx.removeDhtMapping(node.id(),entry);
        }
      }
      if (dhtMapping.isEmpty())       dhtMap.remove(node);
    }
    onDone(true);
  }
}
