{
  IgniteConfiguration cfg=super.getConfiguration(gridName);
  TcpDiscoverySpi spi=new TcpDiscoverySpi();
  spi.setIpFinder(ipFinder);
  cfg.setDiscoverySpi(spi);
  CacheConfiguration partCacheCfg=defaultCacheConfiguration();
  partCacheCfg.setCacheMode(PARTITIONED);
  partCacheCfg.setAffinity(new GridCacheModuloAffinityFunction(1,1));
  partCacheCfg.setWriteSynchronizationMode(FULL_SYNC);
  partCacheCfg.setNearConfiguration(null);
  partCacheCfg.setEvictSynchronized(true);
  partCacheCfg.setSwapEnabled(false);
  partCacheCfg.setEvictionPolicy(null);
  partCacheCfg.setEvictSynchronizedKeyBufferSize(25);
  partCacheCfg.setEvictMaxOverflowRatio(0.99f);
  partCacheCfg.setPreloadMode(ASYNC);
  partCacheCfg.setAtomicityMode(TRANSACTIONAL);
  partCacheCfg.setPreloadThrottle(2000);
  cfg.setCacheConfiguration(partCacheCfg);
  cfg.setUserAttributes(F.asMap(GridCacheModuloAffinityFunction.IDX_ATTR,idxGen.getAndIncrement()));
  cfg.setNetworkTimeout(60000);
  return cfg;
}
