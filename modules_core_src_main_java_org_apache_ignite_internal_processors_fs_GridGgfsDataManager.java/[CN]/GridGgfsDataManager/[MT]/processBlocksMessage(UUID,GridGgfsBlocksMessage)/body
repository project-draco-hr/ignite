{
  storeBlocksAsync(blocksMsg.blocks()).listenAsync(new CI1<IgniteInternalFuture<?>>(){
    @Override public void apply(    IgniteInternalFuture<?> fut){
      IgniteCheckedException err=null;
      try {
        fut.get();
      }
 catch (      IgniteCheckedException e) {
        err=e;
      }
      try {
        ggfsCtx.send(nodeId,topic,new GridGgfsAckMessage(blocksMsg.fileId(),blocksMsg.id(),err),SYSTEM_POOL);
      }
 catch (      IgniteCheckedException e) {
        U.warn(log,"Failed to send batch acknowledgement (did node leave the grid?) [nodeId=" + nodeId + ", fileId="+ blocksMsg.fileId()+ ", batchId="+ blocksMsg.id()+ ']',e);
      }
    }
  }
);
}
