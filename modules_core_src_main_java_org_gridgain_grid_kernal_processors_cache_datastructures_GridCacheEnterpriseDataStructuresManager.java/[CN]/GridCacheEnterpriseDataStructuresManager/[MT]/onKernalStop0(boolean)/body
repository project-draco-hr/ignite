{
  queueBusyLock.block();
  cctx.events().removeListener(discoLsnr);
  for (  GridCacheRemovable entry : dsMap.values()) {
    if (entry instanceof GridCacheQueue) {
      try {
        GridCacheQueueEx queue=cast(entry,GridCacheQueueEx.class);
        queue.onRemoved();
      }
 catch (      GridException e) {
        U.warn(log,"Failed to remove queue entry: " + e);
      }
    }
  }
  if (queueDelWorker != null) {
    queueDelWorker.cancel();
    try {
      queueDelWorker.join();
    }
 catch (    InterruptedException ignore) {
      U.warn(log,"Interrupted while waiting for queue delete worker to stop.");
      Thread.currentThread().interrupt();
    }
  }
}
