{
  ConnectionWrapper c=connCache.get();
  if (c == null)   throw new IgniteCheckedException("Failed to get DB connection for thread (check log for details).");
  if (schema != null && !F.eq(c.schema(),schema)) {
    Statement stmt=null;
    try {
      stmt=c.connection().createStatement();
      stmt.executeUpdate("SET SCHEMA " + schema);
      if (log.isDebugEnabled())       log.debug("Set schema: " + schema);
      c.schema(schema);
    }
 catch (    SQLException e) {
      throw new IgniteCheckedException("Failed to set schema for DB connection for thread [schema=" + schema + "]",e);
    }
 finally {
      U.close(stmt,log);
    }
  }
  return c.connection();
}
