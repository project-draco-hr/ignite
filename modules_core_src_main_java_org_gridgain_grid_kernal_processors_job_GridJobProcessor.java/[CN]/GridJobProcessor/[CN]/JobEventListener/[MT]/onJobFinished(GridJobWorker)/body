{
  if (log.isDebugEnabled())   log.debug("Received onJobFinished() callback: " + worker);
  GridJobSessionImpl ses=worker.getSession();
  if (ses.isFullSupport() && ctx.session().removeSession(ses.getId())) {
    ses.onClosed();
    ctx.checkpoint().onSessionEnd(ses,true);
  }
  if (worker.endTime() < Long.MAX_VALUE)   ctx.timeout().removeTimeoutObject(worker);
  release(worker.getDeployment());
  finishedJobs.add(worker.getJobId());
  if (!worker.isInternal()) {
    finishedJobsCnt.increment();
    long execTime=worker.getExecuteTime();
    finishedJobsTime.add(execTime);
    maxFinishedJobsTime.setIfGreater(execTime);
    if (jobAlwaysActivate) {
      if (metricsUpdateFreq > -1L)       updateJobMetrics();
    }
 else {
      rwLock.readLock();
      try {
        if (stopping) {
          if (log.isDebugEnabled())           log.debug("Skipping collision handling on job finish (node is stopping).");
          return;
        }
        handleCollisions();
      }
  finally {
        rwLock.readUnlock();
      }
    }
    if (!activeJobs.remove(worker.getJobId(),worker))     cancelledJobs.remove(worker.getJobId(),worker);
    heldJobs.remove(worker.getJobId());
  }
}
