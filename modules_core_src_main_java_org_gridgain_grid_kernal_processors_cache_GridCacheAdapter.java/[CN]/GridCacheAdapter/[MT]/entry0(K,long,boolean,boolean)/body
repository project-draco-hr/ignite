{
  GridTriple<GridCacheMapEntry<K,V>> t=map.putEntryIfObsoleteOrAbsent(topVer,key,null,ctx.config().getDefaultTimeToLive(),create);
  GridCacheEntryEx<K,V> cur=t.get1();
  GridCacheEntryEx<K,V> created=t.get2();
  GridCacheEntryEx<K,V> doomed=t.get3();
  if (doomed != null && ctx.events().isRecordable(EVT_CACHE_ENTRY_DESTROYED))   ctx.events().addEvent(doomed.partition(),doomed.key(),locNodeId,(GridUuid)null,null,EVT_CACHE_ENTRY_DESTROYED,null,false,null,false);
  if (created != null) {
    if (ctx.events().isRecordable(EVT_CACHE_ENTRY_CREATED))     ctx.events().addEvent(created.partition(),created.key(),locNodeId,(GridUuid)null,null,EVT_CACHE_ENTRY_CREATED,null,false,null,false);
    if (touch)     ctx.evicts().touch(cur,topVer);
  }
  return cur;
}
