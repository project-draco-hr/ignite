{
  A.notNull(key,"key");
  if (keyCheck)   validateCacheKey(key);
  ctx.checkSecurity(GridSecurityPermission.CACHE_READ);
  GridCacheEntryEx<K,V> e=null;
  try {
    if (ctx.portableEnabled())     key=(K)ctx.marshalToPortable(key);
    e=peekEx(key);
    if (e != null) {
      GridTuple<V> peek=e.peek0(failFast,mode,filter,ctx.tm().localTxx());
      if (peek != null) {
        V v=peek.get();
        if (ctx.portableEnabled() && !ctx.keepPortable() && v instanceof GridPortableObject)         v=((GridPortableObject)v).deserialize();
        return F.t(ctx.cloneOnFlag(v));
      }
    }
    GridCacheTxEx<K,V> tx=ctx.tm().localTx();
    if (tx != null) {
      GridTuple<V> peek=tx.peek(ctx,failFast,key,filter);
      if (peek != null) {
        V v=peek.get();
        if (ctx.portableEnabled() && !ctx.keepPortable() && v instanceof GridPortableObject)         v=((GridPortableObject)v).deserialize();
        return F.t(ctx.cloneOnFlag(v));
      }
    }
    return null;
  }
 catch (  GridCacheEntryRemovedException ignore) {
    if (log.isDebugEnabled())     log.debug("Got removed entry during 'peek': " + e);
    return null;
  }
catch (  GridException ex) {
    throw new GridRuntimeException(ex);
  }
}
