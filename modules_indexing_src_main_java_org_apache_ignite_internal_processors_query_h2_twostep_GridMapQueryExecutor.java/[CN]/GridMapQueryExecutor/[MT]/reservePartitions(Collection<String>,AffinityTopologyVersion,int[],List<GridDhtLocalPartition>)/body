{
  Collection<Integer> partIds=parts == null ? null : wrap(parts);
  for (  String cacheName : cacheNames) {
    GridCacheContext<?,?> cctx=cacheContext(cacheName,topVer);
    if (cctx.isLocal())     continue;
    int partsCnt=cctx.affinity().partitions();
    if (cctx.isReplicated()) {
      for (int p=0; p < partsCnt; p++) {
        GridDhtLocalPartition part=cctx.topology().localPartition(p,topVer,false);
        if (part == null)         return false;
        part.owningFuture().get();
      }
    }
 else {
      if (parts == null)       partIds=cctx.affinity().primaryPartitions(ctx.localNodeId(),topVer);
      for (      int partId : partIds) {
        if (partId >= partsCnt)         break;
        GridDhtLocalPartition part=cctx.topology().localPartition(partId,topVer,false);
        if (part != null) {
          part.owningFuture().get();
          if (part.reserve()) {
            reserved.add(part);
            continue;
          }
        }
        return false;
      }
    }
  }
  return true;
}
