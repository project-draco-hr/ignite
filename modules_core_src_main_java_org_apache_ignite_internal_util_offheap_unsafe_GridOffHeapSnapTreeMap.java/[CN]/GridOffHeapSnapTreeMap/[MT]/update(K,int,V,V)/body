{
  final Comparable<? super K> k=comparable(key);
  LongArray unlinked=new LongArray();
  int sd=0;
  try {
    final Object result=updateUnderRoot(key,k,func,expected,newValue,holderRef,unlinked);
    sd=sizeDelta(func,result,newValue);
    if (sd != 0)     size.addAndGet(sd);
    return result;
  }
  finally {
    deallocate(unlinked);
  }
}
