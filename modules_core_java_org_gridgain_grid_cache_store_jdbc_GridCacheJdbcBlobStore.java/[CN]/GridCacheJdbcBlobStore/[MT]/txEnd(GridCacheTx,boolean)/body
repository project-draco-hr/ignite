{
  init();
  Connection conn=tx.removeMeta(ATTR_CONN);
  if (conn != null) {
    try {
      if (commit)       conn.commit();
 else       conn.rollback();
    }
 catch (    SQLException e) {
      throw new GridException("Failed to end transaction [xid=" + tx.xid() + ", commit="+ commit+ ']',e);
    }
 finally {
      closeConnection(conn);
    }
  }
  if (log.isDebugEnabled())   log.debug("Transaction ended [xid=" + tx.xid() + ", commit="+ commit+ ']');
}
