{
  if (state() != PREPARING) {
    if (timedOut())     throw new GridCacheTxTimeoutException("Transaction timed out: " + this);
    setRollbackOnly();
    throw new GridException("Invalid transaction state for prepare [state=" + state() + ", tx="+ this+ ']');
  }
  checkValid(CU.<K,V>empty());
  try {
    cctx.tm().prepareTx(this);
  }
 catch (  GridException e) {
    throw e;
  }
catch (  Throwable e) {
    setRollbackOnly();
    throw new GridException("Transaction validation produced a runtime exception: " + this,e);
  }
}
