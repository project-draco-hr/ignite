{
  if (isRollbackOnly()) {
    if (timedOut())     throw new GridCacheTxTimeoutException("Cache transaction timed out: " + this);
    GridCacheTxState state=state();
    if (state == ROLLING_BACK || state == ROLLED_BACK)     throw new GridCacheTxRollbackException("Cache transaction is marked as rollback-only " + "(will be rolled back automatically): " + this);
    if (state == UNKNOWN)     throw new GridCacheTxHeuristicException("Cache transaction is in unknown state " + "(remote transactions will be invalidated): " + this);
    throw new IgniteCheckedException("Cache transaction marked as rollback-only: " + this);
  }
  if (remainingTime() == 0 && setRollbackOnly())   throw new GridCacheTxTimeoutException("Cache transaction timed out " + "(was rolled back automatically): " + this);
}
