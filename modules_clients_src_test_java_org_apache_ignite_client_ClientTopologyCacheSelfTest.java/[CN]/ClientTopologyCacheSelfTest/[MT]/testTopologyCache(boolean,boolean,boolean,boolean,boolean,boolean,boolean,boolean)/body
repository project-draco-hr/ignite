{
  GridClient client=client(metricsCache,attrsCache,autoFetchMetrics,autoFetchAttrs);
  try {
    assertEquals(metricsBeforeRefresh,metricsAvailable(client,false));
    assertEquals(attrsBeforeRefresh,attrsAvailable(client));
    client.compute().refreshTopology(true,true);
    client.data(CACHE_NAME).metrics();
    assertEquals(metricsAfterRefresh,metricsAvailable(client,true));
    assertEquals(attrsAfterRefresh,attrsAvailable(client));
  }
  finally {
    GridClientFactory.stop(client.id(),false);
  }
}
