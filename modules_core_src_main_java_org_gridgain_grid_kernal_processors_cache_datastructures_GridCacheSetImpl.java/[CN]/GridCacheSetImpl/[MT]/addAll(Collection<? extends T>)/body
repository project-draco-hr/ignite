{
  try {
    boolean add=false;
    Map<GridCacheSetItemKey,Boolean> addKeys=null;
    for (    T obj : c) {
      if (add) {
        if (addKeys == null)         addKeys=new HashMap<>(BATCH_SIZE);
        addKeys.put(itemKey(obj),true);
        if (addKeys.size() == BATCH_SIZE) {
          cache.putAll(addKeys);
          addKeys.clear();
        }
      }
 else       add|=add(obj);
    }
    if (!F.isEmpty(addKeys))     cache.putAll(addKeys);
    return add;
  }
 catch (  GridException e) {
    throw new GridRuntimeException(e);
  }
}
