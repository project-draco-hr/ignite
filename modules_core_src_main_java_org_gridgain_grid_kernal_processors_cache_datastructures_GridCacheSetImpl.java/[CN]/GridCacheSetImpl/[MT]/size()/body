{
  try {
    checkRemoved();
    if (ctx.isLocal() || ctx.isReplicated()) {
      GridConcurrentHashSet<GridCacheSetItemKey> set=ctx.dataStructures().setData(id);
      return set != null ? set.size() : 0;
    }
    GridCacheQueryAdapter qry=new GridCacheQueryAdapter<>(ctx,SET,null,null,null,new GridSetQueryPredicate<>(id,collocated),false);
    Collection<GridNode> nodes=dataNodes(ctx.affinity().affinityTopologyVersion());
    qry.projection(ctx.grid().forNodes(nodes));
    Collection<Integer> col=(Collection)qry.execute(new SumReducer()).get();
    int sum=0;
    for (    Integer val : col)     sum+=val;
    return sum;
  }
 catch (  GridException e) {
    throw new GridRuntimeException(e);
  }
}
