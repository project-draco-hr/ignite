{
  IgniteConfiguration cfg=super.getConfiguration(gridName);
  PortableTypeConfiguration typeCfg=new PortableTypeConfiguration();
  typeCfg.setClassName(TestObject.class.getName());
  typeCfg.setAffinityKeyFieldName("affKey");
  PortableMarshaller marsh=new PortableMarshaller();
  marsh.setTypeConfigurations(Collections.singleton(typeCfg));
  cfg.setMarshaller(marsh);
  if (!gridName.equals(getTestGridName(GRID_CNT))) {
    CacheConfiguration cacheCfg=new CacheConfiguration();
    cacheCfg.setCacheMode(PARTITIONED);
    cfg.setCacheConfiguration(cacheCfg);
  }
  ((TcpDiscoverySpi)cfg.getDiscoverySpi()).setIpFinder(ipFinder);
  return cfg;
}
