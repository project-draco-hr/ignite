{
  boolean marked=tx.setRollbackOnly();
  if (e instanceof GridCacheTxRollbackException) {
    if (marked) {
      try {
        tx.rollback();
      }
 catch (      IgniteCheckedException ex) {
        U.error(log,"Failed to automatically rollback transaction: " + tx,ex);
      }
    }
  }
  onDone(tx,e);
}
