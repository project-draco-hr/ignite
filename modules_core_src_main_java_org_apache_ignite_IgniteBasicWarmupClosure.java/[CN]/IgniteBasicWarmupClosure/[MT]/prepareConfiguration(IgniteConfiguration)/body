{
  if (F.isEmpty(gridCfg.getCacheConfiguration()))   return null;
  IgniteConfiguration cp=new IgniteConfiguration();
  cp.setClientConnectionConfiguration(null);
  Collection<CacheConfiguration> reduced=new ArrayList<>();
  for (  CacheConfiguration ccfg : gridCfg.getCacheConfiguration()) {
    if (CU.isSystemCache(ccfg.getName()))     continue;
    if (!matches(reduced,ccfg)) {
      CacheConfiguration ccfgCp=new CacheConfiguration(ccfg);
      if (ccfgCp.getDistributionMode() == GridCacheDistributionMode.CLIENT_ONLY)       ccfgCp.setDistributionMode(GridCacheDistributionMode.PARTITIONED_ONLY);
 else       if (ccfgCp.getDistributionMode() == GridCacheDistributionMode.NEAR_ONLY)       ccfgCp.setDistributionMode(GridCacheDistributionMode.NEAR_PARTITIONED);
      ccfgCp.setCacheStoreFactory(null);
      ccfgCp.setWriteBehindEnabled(false);
      reduced.add(ccfgCp);
    }
  }
  if (F.isEmpty(reduced))   return null;
  CacheConfiguration[] res=new CacheConfiguration[reduced.size()];
  reduced.toArray(res);
  cp.setCacheConfiguration(res);
  return cp;
}
