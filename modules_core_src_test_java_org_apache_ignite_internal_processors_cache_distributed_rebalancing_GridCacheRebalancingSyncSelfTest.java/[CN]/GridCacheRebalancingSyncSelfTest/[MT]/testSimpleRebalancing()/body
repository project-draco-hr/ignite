{
  IgniteKernal ignite=(IgniteKernal)startGrid(0);
  generateData(ignite,0,0);
  log.info("Preloading started.");
  long start=System.currentTimeMillis();
  startGrid(1);
  waitForRebalancing(0,2);
  waitForRebalancing(1,2);
  awaitPartitionMapExchange(true,true);
  checkPartitionMapExchangeFinished();
  checkPartitionMapMessagesAbsent();
  stopGrid(0);
  waitForRebalancing(1,3);
  awaitPartitionMapExchange(true,true);
  checkPartitionMapExchangeFinished();
  checkPartitionMapMessagesAbsent();
  startGrid(2);
  waitForRebalancing(1,4);
  waitForRebalancing(2,4);
  awaitPartitionMapExchange(true,true);
  checkPartitionMapExchangeFinished();
  checkPartitionMapMessagesAbsent();
  stopGrid(2);
  waitForRebalancing(1,5);
  awaitPartitionMapExchange(true,true);
  checkPartitionMapExchangeFinished();
  checkPartitionMapMessagesAbsent();
  long spend=(System.currentTimeMillis() - start) / 1000;
  checkData(grid(1),0,0);
  log.info("Spend " + spend + " seconds to rebalance entries.");
}
