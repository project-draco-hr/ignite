{
  int off0=off;
  for (int i=0, size=entries.size(); i < size; i++) {
    AbstractFileEntry e=entries.get(i);
    if (off0 > e.len)     off0-=e.len;
 else     if (off0 == 0 && buf.remaining() >= e.len) {
      e.serializeTo(buf);
      off+=e.len;
    }
 else {
      int off1=e.serializeTo(buf,off0);
      off+=off1 - off0;
      if (off1 != e.len)       break;
      off0=0;
    }
  }
  return off;
}
