{
  GridUnsafeMemory mem=new GridUnsafeMemory(0);
  Random rnd=new Random();
  int mapSize=16 << rnd.nextInt(6);
  Job job=Job.getInstance();
  job.setMapOutputKeyClass(IntWritable.class);
  job.setMapOutputValueClass(IntWritable.class);
  GridHadoopMultimap m=new GridHadoopMultimap(new GridHadoopV2Job(new GridHadoopJobId(UUID.randomUUID(),10),new GridHadoopDefaultJobInfo(job.getConfiguration())),mem,mapSize);
  GridHadoopMultimap.Adder a=m.startAdding();
  Multimap<Integer,Integer> mm=ArrayListMultimap.create();
  Multimap<Integer,Integer> vis=ArrayListMultimap.create();
  a.add(new IntWritable(10),new IntWritable(2));
  mm.put(10,2);
  check(m,mm,vis);
  a.close();
  X.println("Alloc: " + mem.allocatedSize());
  m.close();
  assertEquals(0,mem.allocatedSize());
}
