{
  String gridgainHome=U.getGridGainHome();
  println("GRIDGAIN_HOME is set to '" + gridgainHome + "'.");
  checkGridGainHome(gridgainHome);
  String hadoopHome=System.getenv("HADOOP_HOME");
  if (hadoopHome == null || hadoopHome.isEmpty())   exit("HADOOP_HOME environment variable is not set. Please set HADOOP_HOME to " + "valid Hadoop installation directory and run setup tool again.",null);
  hadoopHome=hadoopHome.replaceAll("\"","");
  println("HADOOP_HOME is set to '" + hadoopHome + "'.");
  File hadoopDir=new File(hadoopHome);
  if (!hadoopDir.exists())   exit("Hadoop installation folder does not exist.",null);
  if (!hadoopDir.isDirectory())   exit("HADOOP_HOME must point to a directory.",null);
  if (!hadoopDir.canRead())   exit("Hadoop installation folder can not be read. Please check permissions.",null);
  File hadoopCommonDir;
  String hadoopCommonHome=System.getenv("HADOOP_COMMON_HOME");
  if (F.isEmpty(hadoopCommonHome)) {
    hadoopCommonDir=new File(hadoopDir,"share/hadoop/common");
    println("HADOOP_COMMON_HOME is not set, will use '" + hadoopCommonDir.getPath() + "'.");
  }
 else {
    println("HADOOP_COMMON_HOME is set to '" + hadoopCommonHome + "'.");
    hadoopCommonDir=new File(hadoopCommonHome);
  }
  if (!hadoopCommonDir.canRead())   exit("Failed to read Hadoop common dir in '" + hadoopCommonHome + "'.",null);
  File hadoopCommonLibDir=new File(hadoopCommonDir,"lib");
  if (!hadoopCommonLibDir.canRead())   exit("Failed to read Hadoop 'lib' folder in '" + hadoopCommonLibDir.getPath() + "'.",null);
  if (U.isWindows()) {
    checkJavaPathSpaces();
    File hadoopBinDir=new File(hadoopDir,"bin");
    if (!hadoopBinDir.canRead())     exit("Failed to read subdirectory 'bin' in HADOOP_HOME.",null);
    File winutilsFile=new File(hadoopBinDir,WINUTILS_EXE);
    if (!winutilsFile.exists()) {
      if (ask("File '" + WINUTILS_EXE + "' does not exist. "+ "It may be replaced by a stub. Create it?")) {
        println("Creating file stub '" + winutilsFile.getAbsolutePath() + "'.");
        boolean ok=false;
        try {
          ok=winutilsFile.createNewFile();
        }
 catch (        IOException ignore) {
        }
        if (!ok)         exit("Failed to create '" + WINUTILS_EXE + "' file. Please check permissions.",null);
      }
 else       println("Ok. But Hadoop client probably will not work on Windows this way...");
    }
    processCmdFiles(hadoopDir,"bin","sbin","libexec");
  }
  File gridgainLibs=new File(new File(gridgainHome),"libs");
  if (!gridgainLibs.exists())   exit("GridGain 'libs' folder is not found.",null);
  Collection<File> jarFiles=new ArrayList<>();
  jarFiles.addAll(Arrays.asList(gridgainLibs.listFiles(new FilenameFilter(){
    @Override public boolean accept(    File dir,    String name){
      return name.endsWith(".jar");
    }
  }
)));
  addJarsInFolder(jarFiles,new File(gridgainLibs,"gridgain-filesystem"));
  addJarsInFolder(jarFiles,new File(gridgainLibs,"gridgain-hadoop"));
  boolean jarsLinksCorrect=true;
  for (  File file : jarFiles) {
    File link=new File(hadoopCommonLibDir,file.getName());
    jarsLinksCorrect&=isJarLinkCorrect(link,file);
    if (!jarsLinksCorrect)     break;
  }
  if (!jarsLinksCorrect) {
    if (ask("GridGain JAR files are not found in Hadoop 'lib' directory. " + "Create appropriate symbolic links?")) {
      File[] oldGridGainJarFiles=hadoopCommonLibDir.listFiles(new FilenameFilter(){
        @Override public boolean accept(        File dir,        String name){
          return name.startsWith("gridgain-");
        }
      }
);
      if (oldGridGainJarFiles.length > 0 && ask("The Hadoop 'lib' directory contains JARs from other GridGain " + "installation. They must be deleted to continue. Continue?")) {
        for (        File file : oldGridGainJarFiles) {
          println("Deleting file '" + file.getAbsolutePath() + "'.");
          if (!file.delete())           exit("Failed to delete file '" + file.getPath() + "'.",null);
        }
      }
      for (      File file : jarFiles) {
        File targetFile=new File(hadoopCommonLibDir,file.getName());
        try {
          println("Creating symbolic link '" + targetFile.getAbsolutePath() + "'.");
          Files.createSymbolicLink(targetFile.toPath(),file.toPath());
        }
 catch (        IOException e) {
          if (U.isWindows()) {
            warn("Ability to create symbolic links is required!");
            warn("On Windows platform you have to grant permission 'Create symbolic links'");
            warn("to your user or run the Accelerator as Administrator.");
          }
          exit("Creating symbolic link failed! Check permissions.",e);
        }
      }
    }
 else     println("Ok. But Hadoop client will not be able to talk to GridGain cluster without those JARs in classpath...");
  }
  File hadoopEtc=new File(hadoopDir,"etc" + File.separator + "hadoop");
  if (hadoopEtc.canWrite()) {
    if (ask("Replace 'core-site.xml' and 'mapred-site.xml' files with preconfigured templates " + "(existing files will be backed up)?")) {
      File gridgainDocs=new File(gridgainHome,"docs");
      if (!gridgainDocs.canRead())       exit("Failed to read GridGain 'docs' folder at '" + gridgainDocs.getAbsolutePath() + "'.",null);
      replace(new File(gridgainDocs,"core-site.gridgain.xml"),renameToBak(new File(hadoopEtc,"core-site.xml")));
      replace(new File(gridgainDocs,"mapred-site.gridgain.xml"),renameToBak(new File(hadoopEtc,"mapred-site.xml")));
    }
 else     println("Ok. You can configure them later, the templates are available at GridGain's 'docs' directory...");
  }
  println("Apache Hadoop setup is complete.");
}
