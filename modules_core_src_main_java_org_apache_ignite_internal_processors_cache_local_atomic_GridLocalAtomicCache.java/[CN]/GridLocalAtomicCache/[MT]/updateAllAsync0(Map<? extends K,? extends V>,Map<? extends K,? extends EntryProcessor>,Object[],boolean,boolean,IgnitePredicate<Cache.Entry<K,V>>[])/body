{
  final GridCacheOperation op=invokeMap != null ? TRANSFORM : UPDATE;
  final Collection<? extends K> keys=map != null ? map.keySet() : invokeMap != null ? invokeMap.keySet() : null;
  final Collection<?> vals=map != null ? map.values() : invokeMap != null ? invokeMap.values() : null;
  final boolean writeThrough=ctx.writeThrough();
  final ExpiryPolicy expiry=expiryPerCall();
  return asyncOp(new Callable<Object>(){
    @Override public Object call() throws Exception {
      return updateAllInternal(op,keys,vals,invokeArgs,expiry,retval,rawRetval,filter,writeThrough);
    }
  }
);
}
