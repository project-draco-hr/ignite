{
  List<GridCacheEntryEx> locked=new ArrayList<>(keys.size());
  while (true) {
    for (    K key : keys) {
      if (key == null)       throw new NullPointerException("Null key.");
      GridCacheEntryEx entry=entryEx(ctx.toCacheKeyObject(key));
      locked.add(entry);
    }
    for (int i=0; i < locked.size(); i++) {
      GridCacheEntryEx entry=locked.get(i);
      UNSAFE.monitorEnter(entry);
      if (entry.obsolete()) {
        for (int j=0; j <= i; j++)         UNSAFE.monitorExit(locked.get(j));
        locked.clear();
        break;
      }
    }
    if (!locked.isEmpty())     return locked;
  }
}
