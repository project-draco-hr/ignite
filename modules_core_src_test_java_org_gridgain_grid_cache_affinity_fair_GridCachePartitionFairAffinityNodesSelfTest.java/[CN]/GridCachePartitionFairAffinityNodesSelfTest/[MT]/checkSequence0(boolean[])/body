{
  try {
    startGrid(0);
    TreeSet<Integer> started=new TreeSet<>();
    started.add(0);
    for (    boolean start : seq) {
      if (start) {
        int nextIdx=nextIndex(started);
        startGrid(nextIdx);
        started.add(nextIdx);
      }
 else {
        int idx=started.last();
        stopGrid(idx);
        started.remove(idx);
      }
      info("Grid 0: " + grid(0).localNode().id());
      for (      int i : started) {
        if (i != 0) {
          info("Grid " + i + ": "+ grid(i).localNode().id());
          for (int part=0; part < parts; part++) {
            List<GridNode> firstNodes=(List<GridNode>)grid(0).cache(null).affinity().mapPartitionToPrimaryAndBackups(part);
            List<GridNode> secondNodes=(List<GridNode>)grid(i).cache(null).affinity().mapPartitionToPrimaryAndBackups(part);
            assertEquals(firstNodes.size(),secondNodes.size());
            for (int n=0; n < firstNodes.size(); n++)             assertEquals(firstNodes.get(n),secondNodes.get(n));
          }
        }
      }
    }
  }
  finally {
    stopAllGrids();
  }
}
