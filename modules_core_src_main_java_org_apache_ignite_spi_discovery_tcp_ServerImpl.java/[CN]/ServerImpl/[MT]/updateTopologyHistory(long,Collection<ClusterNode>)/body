{
synchronized (mux) {
    if (topHist.containsKey(topVer))     return null;
    topHist.put(topVer,top);
    while (topHist.size() > spi.topHistSize)     topHist.remove(topHist.firstKey());
    if (log.isDebugEnabled())     log.debug("Added topology snapshot to history, topVer=" + topVer + ", historySize="+ topHist.size());
    return new TreeMap<>(topHist);
  }
}
