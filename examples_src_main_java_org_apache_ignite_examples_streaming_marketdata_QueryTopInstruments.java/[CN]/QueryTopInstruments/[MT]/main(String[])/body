{
  Ignition.setClientMode(true);
  try (Ignite ignite=Ignition.start("examples/config/example-ignite.xml")){
    if (!ExamplesUtils.hasServerNodes(ignite))     return;
    IgniteCache<String,Instrument> instCache=ignite.getOrCreateCache(CacheConfig.instrumentCache());
    SqlFieldsQuery top3qry=new SqlFieldsQuery("select symbol, (latest - open) from Instrument order by (latest - open) desc limit 3");
    SqlFieldsQuery profitQry=new SqlFieldsQuery("select sum(latest - open) from Instrument");
    while (true) {
      List<List<?>> top3=instCache.query(top3qry).getAll();
      List<List<?>> profit=instCache.query(profitQry).getAll();
      List<?> row=profit.get(0);
      if (row.get(0) != null)       System.out.printf("Total profit: %.2f%n",row.get(0));
      ExamplesUtils.printQueryResults(top3);
      Thread.sleep(5000);
    }
  }
 }
