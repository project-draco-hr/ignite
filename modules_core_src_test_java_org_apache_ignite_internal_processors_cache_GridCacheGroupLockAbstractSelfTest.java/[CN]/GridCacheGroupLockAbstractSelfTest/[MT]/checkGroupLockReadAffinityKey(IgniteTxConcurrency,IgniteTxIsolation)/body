{
  UUID affinityKey=primaryKeyForCache(grid(0));
  final Cache<Object,String> cache=grid(0).cache(null);
  final CacheAffinityKey<String> key1=new CacheAffinityKey<>("key1",affinityKey);
  final CacheAffinityKey<String> key2=new CacheAffinityKey<>("key2",affinityKey);
  cache.put(affinityKey,"0");
  cache.put(key1,"0");
  cache.put(key2,"0");
  try (IgniteTx tx=cache.txStartAffinity(affinityKey,concurrency,isolation,0,3)){
    assertEquals("0",cache.get(affinityKey));
    assertEquals("0",cache.get(key1));
    assertEquals("0",cache.get(key2));
    cache.put(affinityKey,"1");
    cache.put(key1,"1");
    cache.put(key2,"1");
    assertEquals("1",cache.get(affinityKey));
    assertEquals("1",cache.get(key1));
    assertEquals("1",cache.get(key2));
    tx.commit();
  }
   assertEquals("1",cache.get(affinityKey));
  assertEquals("1",cache.get(key1));
  assertEquals("1",cache.get(key2));
}
