{
  Transaction tx=new DummyTx();
  ses.newSession(tx);
  store.write(new CacheEntryImpl<>("k1","v1"));
  store.sessionEnd(false);
  tx=new DummyTx();
  ses.newSession(tx);
  assertNull(store.load("k1"));
  assertNull(store.load("k2"));
  Collection<Cache.Entry<? extends Object,? extends Object>> col=new ArrayList<>();
  col.add(new CacheEntryImpl<>("k2","v2"));
  store.writeAll(col);
  store.sessionEnd(false);
  tx=new DummyTx();
  ses.newSession(tx);
  assertNull(store.load("k2"));
  col=new ArrayList<>();
  col.add(new CacheEntryImpl<>("k3","v3"));
  store.writeAll(col);
  store.sessionEnd(true);
  tx=new DummyTx();
  ses.newSession(tx);
  assertEquals("v3",store.load("k3"));
  store.write(new CacheEntryImpl<>("k4","v4"));
  store.sessionEnd(false);
  tx=new DummyTx();
  ses.newSession(tx);
  assertNull(store.load("k4"));
  assertEquals("v3",store.load("k3"));
  store.delete("k3");
  store.sessionEnd(false);
  tx=new DummyTx();
  ses.newSession(tx);
  assertEquals("v3",store.load("k3"));
  store.deleteAll(Arrays.asList("k3"));
  store.sessionEnd(false);
  tx=new DummyTx();
  ses.newSession(tx);
  assertEquals("v3",store.load("k3"));
}
