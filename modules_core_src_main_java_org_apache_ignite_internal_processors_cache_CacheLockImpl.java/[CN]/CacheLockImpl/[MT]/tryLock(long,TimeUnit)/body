{
  if (Thread.interrupted())   throw new InterruptedException();
  if (time <= 0)   return tryLock();
  GridCacheProjectionImpl<K,V> prev=gate.enter(prj);
  try {
    IgniteInternalFuture<Boolean> fut=delegate.lockAllAsync(keys,unit.toMillis(time));
    try {
      boolean res=fut.get();
      if (res)       incrementLockCounter();
      return res;
    }
 catch (    IgniteInterruptedException e) {
      if (!fut.cancel()) {
        if (fut.isDone()) {
          Boolean res=fut.get();
          Thread.currentThread().interrupt();
          if (res)           incrementLockCounter();
          return res;
        }
      }
      if (e.getCause() instanceof InterruptedException)       throw (InterruptedException)e.getCause();
      throw new InterruptedException();
    }
  }
 catch (  IgniteCheckedException e) {
    throw new CacheException(e.getMessage(),e);
  }
 finally {
    gate.leave(prev);
  }
}
