{
  GridNearAtomicUpdateResponse res=null;
synchronized (this) {
    GridNearAtomicUpdateRequest req;
    if (singleReq != null)     req=singleReq.nodeId().equals(nodeId) ? singleReq : null;
 else     req=mappings != null ? mappings.get(nodeId) : null;
    if (req != null) {
      res=new GridNearAtomicUpdateResponse(cctx.cacheId(),nodeId,req.futureVersion());
      ClusterTopologyCheckedException e=new ClusterTopologyCheckedException("Primary node left grid " + "before response is received: " + nodeId);
      e.retryReadyFuture(cctx.shared().nextAffinityReadyFuture(req.topologyVersion()));
      res.addFailedKeys(req.keys(),e);
    }
  }
  if (res != null)   onResult(nodeId,res,true);
}
