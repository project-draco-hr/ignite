{
  lastMsgRcvTime=U.currentTimeMillis();
  TcpClientFuture fut=pendingReqs.get(req.requestId());
  if (fut == null) {
    log.warning("Response for an unknown request is received, ignoring. " + "[req=" + req + ", ses="+ ses+ ']');
    return;
  }
  if (fut.forward()) {
    GridRouterResponse msg=new GridRouterResponse(req.messageArray(),req.requestId(),clientId,req.destinationId());
    removePending(msg.requestId());
    fut.onDone(msg);
  }
 else {
    GridClientMessage msg;
    if (keepPortablesMode != null && fut.keepPortables())     keepPortablesMode.set(true);
    try {
      msg=marsh.unmarshal(req.messageArray());
    }
 catch (    IOException e) {
      fut.onDone(new GridClientException("Failed to unmarshal message.",e));
      return;
    }
 finally {
      if (keepPortablesMode != null && fut.keepPortables())       keepPortablesMode.set(false);
    }
    msg.requestId(req.requestId());
    msg.clientId(req.clientId());
    msg.destinationId(req.destinationId());
    if (msg instanceof GridClientResponse)     handleClientResponse(fut,(GridClientResponse)msg);
 else     log.warning("Unsupported response type received: " + msg);
  }
}
