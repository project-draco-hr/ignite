{
  try {
    client=createClient(cfg);
  }
 catch (  GridClientException e) {
    throw new GridException("Failed to initialise embedded client.",e);
  }
  URL cfgUrl=U.resolveGridGainUrl(cfg.getJettyConfigurationPath());
  if (cfgUrl != null) {
    SSLContext sslCtx;
    try {
      GridSslContextFactory sslCtxFactory=cfg.getClientSslContextFactory();
      sslCtx=sslCtxFactory == null ? null : sslCtxFactory.createSslContext();
    }
 catch (    SSLException e) {
      throw new GridException("Failed to create SSL context.",e);
    }
    jettyHnd=new GridHttpRouterJettyHandler(client,sslCtx,cfg.getConnectionsTotal(),cfg.getConnectionsPerRoute(),log);
    startJetty(cfgUrl,jettyHnd);
  }
 else   throw new GridException("Can't find Jetty XML in path path: " + cfg.getJettyConfigurationPath());
  try {
    ObjectName objName=U.registerMBean(ManagementFactory.getPlatformMBeanServer(),"Router","HTTP Router " + id,getClass().getSimpleName(),this,GridHttpRouterMBean.class);
    if (log.isDebugEnabled())     log.debug("Registered MBean: " + objName);
    mbeanName=objName;
  }
 catch (  JMException e) {
    U.error(log,"Failed to register MBean.",e);
  }
}
