{
  for (int i=0; i < gridCount(); i++) {
    Grid g=grid(i);
    if (F.eq(g.name(),nearOnlyGridName)) {
      for (int k=0; k < 10000; k++) {
        GridCache<Object,Object> cache=g.cache(null);
        String key="key" + k;
        if (cacheMode() == PARTITIONED)         assertFalse(cache.entry(key).primary() || cache.entry(key).backup());
        assertFalse(cache.affinity().mapKeyToPrimaryAndBackups(key).contains(g.localNode()));
      }
    }
 else {
      boolean foundEntry=false;
      boolean foundAffinityNode=false;
      for (int k=0; k < 10000; k++) {
        GridCache<Object,Object> cache=g.cache(null);
        String key="key" + k;
        if (cache.entry(key).primary() || cache.entry(key).backup())         foundEntry=true;
        if (cache.affinity().mapKeyToPrimaryAndBackups(key).contains(g.localNode()))         foundAffinityNode=true;
      }
      assertTrue("Did not found primary or backup entry for grid: " + i,foundEntry);
      assertTrue("Did not found affinity node for grid: " + i,foundAffinityNode);
    }
  }
}
