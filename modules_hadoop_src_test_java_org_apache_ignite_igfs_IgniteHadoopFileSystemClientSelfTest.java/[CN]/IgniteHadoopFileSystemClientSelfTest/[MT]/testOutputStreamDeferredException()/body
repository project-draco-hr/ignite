{
  final byte[] data="test".getBytes();
  try {
    switchHandlerErrorFlag(true);
    HadoopIgfs client=new HadoopIgfsOutProc("127.0.0.1",10500,getTestGridName(0),"igfs",LOG,null);
    client.handshake(null);
    IgfsPath path=new IgfsPath("/test1.file");
    HadoopIgfsStreamDelegate delegate=client.create(path,true,false,1,1024,null);
    final HadoopIgfsOutputStream igfsOut=new HadoopIgfsOutputStream(delegate,LOG,IgfsLogger.disabledLogger(),0);
    igfsOut.write(data);
    U.sleep(500);
    GridTestUtils.assertThrows(null,new Callable<Object>(){
      @Override public Object call() throws Exception {
        igfsOut.write(data);
        return null;
      }
    }
,IOException.class,"Failed to write data to server (test).");
  }
  finally {
    switchHandlerErrorFlag(false);
  }
}
