{
  aff.backups(0);
  grids=2;
  aff.partitions(grids);
  startGrids();
  ClusterNode n1=F.first(aff.nodes(aff.partition(1),grid(0).nodes()));
  ClusterNode n2=F.first(aff.nodes(aff.partition(2),grid(0).nodes()));
  assertNotNull(n1);
  assertNotNull(n2);
  assertNotSame(n1,n2);
  assertFalse("Nodes cannot be equal: " + n1,n1.equals(n2));
  Ignite g1=grid(n1.id());
  Ignite g2=grid(n2.id());
  IgniteCache<Integer,String> cache1=g1.jcache(null);
  IgniteCache<Integer,String> cache2=g2.jcache(null);
  assertNull(cache1.getAndPut(1,"v1"));
  assertNull(cache1.getAndPut(2,"v2"));
  GridDhtCacheEntry<Integer,String> e1=(GridDhtCacheEntry<Integer,String>)dht(cache1).entryEx(1);
  GridDhtCacheEntry<Integer,String> e2=(GridDhtCacheEntry<Integer,String>)dht(cache2).entryEx(2);
  assertNotNull(e1.readers());
  assertTrue(cache1.containsKey(1));
  assertTrue(cache1.containsKey(2));
  assertNotNull(near(cache1).peek(1));
  assertNotNull(near(cache1).peek(2));
  assertNotNull(dht(cache1).peek(1));
  assertNull(dht(cache1).peek(2));
  assertNull(near(cache2).peek(1));
  assertNotNull(dht(cache2).peek(2));
  assertTrue(e2.readers().contains(n1.id()));
  assertFalse(e1.readers().contains(n2.id()));
  assertEquals("v1",cache2.get(1));
  assertNotNull(near(cache2).peek(1));
  assertTrue(e1.readers().contains(n2.id()));
  cache2.localEvict(Collections.singleton(1));
  assertNull(near(cache2).peek(1));
  assertNull(dht(cache2).peek(1));
  assertTrue(e1.readers().contains(n2.id()));
  assertNotNull(cache1.getAndPut(1,"z1"));
  assertFalse(e1.readers().contains(n2.id()));
}
