{
  GridTcpDiscoveryNode node=msg.node();
  if (locNodeId.equals(node.id())) {
    if (joinLatch.getCount() > 0) {
      Collection<GridTcpDiscoveryNode> top=msg.topology();
      if (top != null) {
        for (        GridTcpDiscoveryNode n : top) {
          n.visible(true);
          rmtNodes.put(n.id(),n);
        }
        Collection<List<Object>> dataList=msg.oldNodesDiscoveryData();
        if (dataList != null) {
          for (          List<Object> discoData : dataList)           exchange.onExchange(discoData);
        }
        locNode.setAttributes(node.attributes());
        locNode.visible(true);
      }
 else       if (log.isDebugEnabled())       log.debug("Discarding node added message with empty topology: " + msg);
    }
 else     if (log.isDebugEnabled())     log.debug("Discarding node added message (this message has already been processed) " + "[msg=" + msg + ", locNode="+ locNode+ ']');
  }
 else {
    boolean topChanged=rmtNodes.putIfAbsent(node.id(),node) == null;
    if (topChanged) {
      List<Object> data=msg.newNodeDiscoveryData();
      if (data != null)       exchange.onExchange(data);
    }
  }
}
