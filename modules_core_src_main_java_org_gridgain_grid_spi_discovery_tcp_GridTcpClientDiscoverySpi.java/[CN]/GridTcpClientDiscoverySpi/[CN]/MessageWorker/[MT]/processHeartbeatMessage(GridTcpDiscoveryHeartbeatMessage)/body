{
  if (locNodeId.equals(msg.creatorNodeId())) {
    if (msg.senderNodeId() == null) {
      Socket sock0=sock;
      if (sock0 != null) {
        try {
          writeToSocket(sock0,msg);
          int res=readReceipt(sock0,sockTimeout);
          if (log.isDebugEnabled())           log.debug("Heartbeat message sent [sock=" + sock0 + ", msg="+ msg+ ", res="+ res+ ']');
        }
 catch (        IOException|GridException e) {
          if (log.isDebugEnabled())           U.error(log,"Failed to send heartbeat message [sock=" + sock0 + ", msg="+ msg+ ']',e);
          U.closeQuiet(sock0);
          sock=null;
          interrupt();
        }
      }
 else       if (log.isDebugEnabled())       log.debug("Failed to send heartbeat message (node is disconnected): " + msg);
    }
 else     if (log.isDebugEnabled())     log.debug("Received heartbeat response: " + msg);
  }
 else {
    if (msg.hasMetrics()) {
      for (      Map.Entry<UUID,GridNodeMetrics> e : msg.metrics().entrySet()) {
        UUID nodeId=e.getKey();
        GridTcpDiscoveryNode node=rmtNodes.get(nodeId);
        if (node != null) {
          node.setMetrics(e.getValue());
          node.lastUpdateTime(U.currentTimeMillis());
          notifyDiscovery(EVT_NODE_METRICS_UPDATED,topVer,node);
        }
 else         if (log.isDebugEnabled())         log.debug("Received metrics from unknown node: " + nodeId);
      }
    }
  }
}
