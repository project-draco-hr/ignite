{
  waitTopologyUpdate();
  Grid mg=grid(0);
  GridCache<Integer,String> mc=mg.cache(null);
  int keyCnt=10;
  printAffinity(mg,keyCnt);
  info("Registering event listener...");
  mg.forRemotes().compute().run(new ListenerJob(keyCnt,mg.name())).get();
  for (int i=0; i < keyCnt; i++) {
    if (failFlag.get())     fail("testAffinityWithPut failed.");
    info("Before putting key [key=" + i + ", grid="+ mg.name()+ ']');
    mc.putx(i,Integer.toString(i));
    if (failFlag.get())     fail("testAffinityWithPut failed.");
  }
  Thread.sleep(1000);
  if (failFlag.get())   fail("testAffinityWithPut failed.");
}
