{
  return new TcpCommunicationSpi(){
    @Override public void sendMessage(    ClusterNode node,    Message msg) throws IgniteSpiException {
      Object origMsg=((GridIoMessage)msg).message();
      if (origMsg instanceof GridCacheQueryRequest) {
        if (latch.getCount() > 0)         assertEquals(expNodeId,node.id());
 else         assertEquals(expFallbackNodeId,node.id());
        try {
          latch.await();
        }
 catch (        InterruptedException e) {
          throw new IgniteSpiException(e);
        }
      }
      super.sendMessage(node,msg);
    }
  }
;
}
