{
  IgniteConfiguration cfg=super.getConfiguration(gridName);
  cfg.setPeerClassLoadingEnabled(peerClassLoadingEnabled());
  if (!gridName.equals(NO_CACHE_GRID_NAME)) {
    CacheConfiguration cacheCfg=defaultCacheConfiguration();
    cacheCfg.setCacheMode(cacheMode());
    cacheCfg.setAtomicityMode(atomicityMode());
    cacheCfg.setDistributionMode(distributionMode());
    cacheCfg.setRebalanceMode(ASYNC);
    cacheCfg.setWriteSynchronizationMode(FULL_SYNC);
    cacheCfg.setCacheStoreFactory(new FactoryBuilder.SingletonFactory(new TestStore()));
    cacheCfg.setReadThrough(true);
    cacheCfg.setWriteThrough(true);
    cacheCfg.setLoadPreviousValue(true);
    cacheCfg.setQueryIndexEnabled(false);
    cfg.setCacheConfiguration(cacheCfg);
  }
  TcpDiscoverySpi disco=new TcpDiscoverySpi();
  disco.setIpFinder(IP_FINDER);
  cfg.setDiscoverySpi(disco);
  cfg.setMarshaller(new OptimizedMarshaller(false));
  return cfg;
}
