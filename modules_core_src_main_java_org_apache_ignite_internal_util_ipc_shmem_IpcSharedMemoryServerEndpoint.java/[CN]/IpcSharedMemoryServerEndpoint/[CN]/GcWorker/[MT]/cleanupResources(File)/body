{
  RandomAccessFile lockFile=null;
  FileLock lock=null;
  try {
    lockFile=new RandomAccessFile(new File(workTokDir,LOCK_FILE_NAME),"rw");
    lock=lockFile.getChannel().lock();
    if (lock != null)     processTokenDirectory(workTokDir);
 else     if (log.isDebugEnabled())     log.debug("Token directory is being processed concurrently: " + workTokDir.getAbsolutePath());
  }
 catch (  OverlappingFileLockException ignored) {
    if (log.isDebugEnabled())     log.debug("Token directory is being processed concurrently: " + workTokDir.getAbsolutePath());
  }
catch (  InterruptedIOException ignored) {
    Thread.currentThread().interrupt();
  }
catch (  IOException e) {
    U.error(log,"Failed to process directory: " + workTokDir.getAbsolutePath(),e);
  }
 finally {
    U.releaseQuiet(lock);
    U.closeQuiet(lockFile);
  }
}
