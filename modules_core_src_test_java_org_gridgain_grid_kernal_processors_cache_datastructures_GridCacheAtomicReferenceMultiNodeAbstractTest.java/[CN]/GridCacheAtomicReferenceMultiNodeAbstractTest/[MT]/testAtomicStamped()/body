{
  final String stampedName=UUID.randomUUID().toString();
  final String val=UUID.randomUUID().toString();
  final String stamp=UUID.randomUUID().toString();
  final String newVal=UUID.randomUUID().toString();
  final String newStamp=UUID.randomUUID().toString();
  GridCacheAtomicStamped<String,String> stamped=grid(0).cache(null).dataStructures().atomicStamped(stampedName,val,stamp,true);
  final Grid grid=grid(0);
  grid.compute().call(new GridCallable<String>(){
    @Override public String call() throws GridException {
      GridCacheAtomicStamped<String,String> stamped=grid.cache(null).dataStructures().atomicStamped(stampedName,val,stamp,true);
      assertEquals(val,stamped.value());
      assertEquals(stamp,stamped.stamp());
      return stamped.value();
    }
  }
);
  stamped.compareAndSet("WRONG EXPECTED VALUE",newVal,"WRONG EXPECTED STAMP",newStamp);
  grid.compute().call(new GridCallable<String>(){
    @Override public String call() throws GridException {
      GridCacheAtomicStamped<String,String> stamped=grid.cache(null).dataStructures().atomicStamped(stampedName,val,stamp,true);
      assertEquals(val,stamped.value());
      assertEquals(stamp,stamped.stamp());
      return stamped.value();
    }
  }
);
  stamped.compareAndSet(val,newVal,stamp,newStamp);
  grid.compute().call(new GridCallable<String>(){
    @Override public String call() throws GridException {
      GridCacheAtomicStamped<String,String> stamped=grid.cache(null).dataStructures().atomicStamped(stampedName,val,stamp,true);
      assertEquals(newVal,stamped.value());
      assertEquals(newStamp,stamped.stamp());
      return stamped.value();
    }
  }
);
}
