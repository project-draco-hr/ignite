{
  info("*** STARTING TEST ***");
  startGrids();
  try {
    GridCache<Integer,String> c=grid(idx).cache(CACHE_NAME);
    for (int j=0; j < retries; j++) {
      for (int i=0; i < keyCnt; i++)       c.putx(i,Integer.toString(i));
      info("Stored items.");
      checkGet(c,j);
      info("Stopping node: " + idx);
      affinityBeforeStop(c);
      stopGrid(idx);
      info("Starting node: " + idx);
      Grid grid=startGrid(idx);
      c=grid.cache(CACHE_NAME);
      affinityAfterStart(c);
      checkGet(c,j);
    }
  }
  finally {
    stopGrids();
  }
}
