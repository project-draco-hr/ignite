{
  IgniteConfiguration cfg=super.getConfiguration(gridName);
  TcpDiscoverySpi spi=new TcpDiscoverySpi();
  spi.setIpFinder(ipFinder);
  cfg.setDiscoverySpi(spi);
  cfg.setIncludeProperties();
  cfg.setMarshaller(new OptimizedMarshaller(false));
  if (useCache) {
    CacheConfiguration cc=defaultCacheConfiguration();
    cc.setCacheMode(mode);
    cc.setAtomicityMode(TRANSACTIONAL);
    if (nearEnabled) {
      NearCacheConfiguration nearCfg=new NearCacheConfiguration();
      cc.setNearConfiguration(nearCfg);
    }
    cc.setWriteSynchronizationMode(FULL_SYNC);
    cc.setEvictSynchronized(false);
    if (store != null) {
      cc.setCacheStoreFactory(new FactoryBuilder.SingletonFactory(store));
      cc.setReadThrough(true);
      cc.setWriteThrough(true);
    }
    cfg.setCacheConfiguration(cc);
  }
 else   cfg.setCacheConfiguration();
  return cfg;
}
