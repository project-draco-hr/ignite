{
  List<IgniteInternalFuture<Object>> futs=new ArrayList<>();
  int gridCnt=4;
  for (int i=0; i < gridCnt; i++) {
    final IgniteEx ig=startGrid(i);
    futs.add(GridTestUtils.runAsync(new Callable<Object>(){
      @Override public Object call() throws Exception {
        ig.cache(null).localLoadCache(null);
        return null;
      }
    }
));
  }
  try {
    for (    IgniteInternalFuture<Object> fut : futs)     fut.get();
    for (int i=0; i < gridCnt; i++) {
      IgniteEx grid=grid(i);
      final IgniteCache<Object,Object> cache=grid.cache(null);
      GridTestUtils.waitForCondition(new PA(){
        @Override public boolean apply(){
          return cache.localSize(CachePeekMode.ONHEAP) <= 10;
        }
      }
,getTestTimeout());
    }
  }
  finally {
    stopAllGrids();
  }
}
