{
  GridOptimizedObjectOutputStream objOut=null;
  try {
    objOut=GridOptimizedObjectStreamRegistry.out();
    objOut.requireSerializable(requireSer);
    objOut.writeObject(obj);
    return objOut.out().array();
  }
 catch (  IOException e) {
    throw new GridException("Failed to serialize object: " + obj,e);
  }
 finally {
    GridOptimizedObjectStreamRegistry.closeOut(objOut);
  }
}
