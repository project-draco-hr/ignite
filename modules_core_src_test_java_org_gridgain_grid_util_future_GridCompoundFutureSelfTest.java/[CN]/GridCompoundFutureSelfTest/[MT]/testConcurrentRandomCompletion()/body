{
  GridTestKernalContext ctx=new GridTestKernalContext(log);
  GridCompoundFuture<Boolean,Boolean> fut=new GridCompoundFuture<>(ctx,CU.boolReducer());
  final ConcurrentLinkedDeque8<GridFutureAdapter<Boolean>> futs=new ConcurrentLinkedDeque8<>();
  for (int i=0; i < 1000; i++) {
    GridFutureAdapter<Boolean> part=new GridFutureAdapter<>(ctx,true);
    fut.add(part);
    futs.add(part);
  }
  fut.markInitialized();
  GridFuture<?> complete=multithreadedAsync(new Runnable(){
    @Override public void run(){
      GridFutureAdapter<Boolean> part;
      Random rnd=new Random();
      while ((part=futs.poll()) != null) {
        int op=rnd.nextInt(10);
        if (op < 8)         part.onDone(true);
 else         if (op == 8)         part.onDone(false);
 else         part.onDone(new GridException("TestMessage"));
      }
    }
  }
,20);
  complete.get();
  assertTrue(fut.isDone());
}
