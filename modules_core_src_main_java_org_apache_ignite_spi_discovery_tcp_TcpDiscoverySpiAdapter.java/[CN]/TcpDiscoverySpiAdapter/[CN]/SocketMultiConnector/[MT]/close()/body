{
  List<Runnable> unstartedTasks=executor.shutdownNow();
  connInProgress-=unstartedTasks.size();
  if (connInProgress > 0) {
    Thread thread=new Thread(new Runnable(){
      @Override public void run(){
        try {
          executor.awaitTermination(5,TimeUnit.MINUTES);
          Future<GridTuple3<InetSocketAddress,Socket,Exception>> fut;
          while ((fut=completionSrvc.poll()) != null) {
            try {
              GridTuple3<InetSocketAddress,Socket,Exception> tuple3=fut.get();
              if (tuple3 != null)               IgniteUtils.closeQuiet(tuple3.get2());
            }
 catch (            ExecutionException ignore) {
            }
          }
        }
 catch (        InterruptedException e) {
          Thread.currentThread().interrupt();
          throw new RuntimeException(e);
        }
      }
    }
);
    thread.setDaemon(true);
    thread.start();
  }
}
