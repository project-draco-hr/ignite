{
  System.out.println(">>> Calculating credit risk for portfolio [size=" + portfolio.length + ", horizon="+ horizon+ ", percentile="+ percentile+ ", iterations="+ num+ "] <<<");
  long start=System.currentTimeMillis();
  double[] losses=calculateLosses(portfolio,horizon,num);
  Arrays.sort(losses);
  double[] lossProbs=new double[losses.length];
  for (int i=0; i < losses.length; i++)   if (i == 0)   lossProbs[i]=getLossProbability(losses,0);
 else   if (losses[i] != losses[i - 1])   lossProbs[i]=getLossProbability(losses,i) + lossProbs[i - 1];
 else   lossProbs[i]=lossProbs[i - 1];
  double crdRisk=0;
  for (int i=0; i < lossProbs.length; i++)   if (lossProbs[i] > percentile) {
    crdRisk=losses[i - 1];
    break;
  }
  System.out.println(">>> Finished calculating portfolio risk [risk=" + crdRisk + ", time="+ (System.currentTimeMillis() - start)+ "ms]");
  return crdRisk;
}
