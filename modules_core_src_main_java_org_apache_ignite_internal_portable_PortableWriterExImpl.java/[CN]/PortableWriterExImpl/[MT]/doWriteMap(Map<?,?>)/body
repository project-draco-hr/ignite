{
  if (map == null)   doWriteByte(NULL);
 else {
    doWriteByte(MAP);
    doWriteInt(map.size());
    doWriteByte(ctx.mapType(map.getClass()));
    for (    Map.Entry<?,?> e : map.entrySet()) {
      doWriteObject(e.getKey(),false);
      doWriteObject(e.getValue(),false);
    }
  }
}
