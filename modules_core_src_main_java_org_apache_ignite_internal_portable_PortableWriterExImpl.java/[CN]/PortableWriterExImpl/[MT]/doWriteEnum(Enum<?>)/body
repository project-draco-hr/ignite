{
  if (val == null)   doWriteByte(NULL);
 else {
    PortableClassDescriptor desc=ctx.descriptorForClass(val.getClass());
    doWriteByte(ENUM);
    if (desc.registered())     doWriteInt(desc.typeId());
 else {
      doWriteInt(UNREGISTERED_TYPE_ID);
      doWriteString(val.getClass().getName());
    }
    doWriteInt(val.ordinal());
  }
}
