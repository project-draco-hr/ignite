{
  if (val == null)   doWriteByte(NULL);
 else {
    if (tryWriteAsHandle(val))     return;
    PortableContext.Type type=ctx.typeId(val.getClass().getComponentType());
    doWriteByte(OBJ_ARR);
    if (type.registered())     doWriteInt(type.id());
 else {
      doWriteInt(UNREGISTERED_TYPE_ID);
      doWriteString(val.getClass().getComponentType().getName());
    }
    doWriteInt(val.length);
    for (    Object obj : val)     doWriteObject(obj,false);
  }
}
