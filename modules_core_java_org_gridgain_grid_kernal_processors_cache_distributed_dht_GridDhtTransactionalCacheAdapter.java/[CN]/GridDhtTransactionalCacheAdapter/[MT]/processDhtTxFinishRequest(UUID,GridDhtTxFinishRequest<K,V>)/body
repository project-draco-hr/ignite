{
  if (req.onePhaseCommit() && beforePessimisticLock != null) {
    GridFuture<Object> f=beforePessimisticLock.apply(F.viewReadOnly(req.writes(),CU.<K,V>tx2key()),true);
    if (f != null && !f.isDone()) {
      f.listenAsync(new CI1<GridFuture<Object>>(){
        @Override public void apply(        GridFuture<Object> t){
          processDhtTxFinishRequest0(nodeId,req);
        }
      }
);
    }
 else     processDhtTxFinishRequest0(nodeId,req);
  }
 else   processDhtTxFinishRequest0(nodeId,req);
}
