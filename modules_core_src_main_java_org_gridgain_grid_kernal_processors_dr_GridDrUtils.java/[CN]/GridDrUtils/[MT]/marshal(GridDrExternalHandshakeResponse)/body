{
  int size=2;
  String errMsg=resp.errorMessage();
  if (errMsg != null)   size+=4 + errMsg.length();
  GridUnsafeDataOutput out=new GridUnsafeDataOutput(size);
  try {
    out.writeByte(TYP_HND_RESP);
    U.writeString(out,resp.errorMessage());
    return out.offset() == size ? out.internalArray() : out.array();
  }
 catch (  IOException e) {
    throw new GridException("Failed to marshal DR handshake response.",e);
  }
}
