{
  addTemplate=true;
  Ignite ignite0=startGrid(0);
  checkNoTemplateCaches(1);
  checkGetOrCreate(ignite0,"org.apache.ignite.test.cache1",4);
  checkGetOrCreate(ignite0,"org.apache.ignite.test.cache1",4);
  Ignite ignite1=startGrid(1);
  checkGetOrCreate(ignite1,"org.apache.ignite.test.cache1",4);
  checkGetOrCreate(ignite1,"org.apache.ignite.test.cache1",4);
  checkGetOrCreate(ignite1,"org.apache.ignite1",3);
  checkGetOrCreate(ignite1,"org.apache.ignite1",3);
  checkGetOrCreate(ignite0,"org.apache.ignite1",3);
  checkGetOrCreate(ignite0,"org.apache.ignite1",3);
  checkGetOrCreate(ignite0,"org.apache1",2);
  checkGetOrCreate(ignite1,"org.apache1",2);
  checkNoTemplateCaches(2);
  addTemplate=false;
  clientMode=true;
  Ignite ignite2=startGrid(2);
  assertNotNull(ignite2.cache("org.apache.ignite.test.cache1"));
  assertNotNull(ignite2.cache("org.apache.ignite1"));
  assertNotNull(ignite2.cache("org.apache1"));
  checkGetOrCreate(ignite2,"org.apache.ignite.test.cache1",4);
  checkGetOrCreate(ignite2,"org.apache.ignite1",3);
  checkGetOrCreate(ignite2,"org.apache1",2);
  checkGetOrCreate(ignite2,"org.apache.ignite.test.cache2",4);
  checkGetOrCreate(ignite2,"org.apache.ignite.cache2",3);
  checkGetOrCreate(ignite2,"org.apache2",2);
  CacheConfiguration template1=new CacheConfiguration();
  template1.setName(TEMPLATE3);
  template1.setBackups(5);
  ignite2.addCacheConfiguration(template1);
  checkGetOrCreate(ignite0,"org.apache.ignite.test2.cache1",5);
  checkGetOrCreate(ignite1,"org.apache.ignite.test2.cache1",5);
  checkGetOrCreate(ignite2,"org.apache.ignite.test2.cache1",5);
  Ignite ignite3=startGrid(3);
  checkGetOrCreate(ignite3,"org.apache.ignite.test2.cache1",5);
  checkNoTemplateCaches(4);
  CacheConfiguration template2=new CacheConfiguration();
  template2.setName("org.apache.ignite");
  template2.setBackups(6);
  ignite0.addCacheConfiguration(template2);
  checkGetOrCreate(ignite0,"org.apache.ignite",6);
  checkGetOrCreate(ignite1,"org.apache.ignite",6);
  checkGetOrCreate(ignite2,"org.apache.ignite",6);
  checkGetOrCreate(ignite3,"org.apache.ignite",6);
}
