{
  final Grid g1=startGrid("g1");
  Collection<Integer> allKeys=new ArrayList<>(100);
  GridCache<Integer,String> cache=g1.cache(null);
  for (int i=0; i < 100; i++) {
    cache.put(i,"val");
    allKeys.add(i);
  }
  Grid g2=startGrid("g2");
  Map<GridNode,Collection<Object>> keysMap=g1.cache(null).affinity().mapKeysToNodes(allKeys);
  Collection<Object> g2Keys=keysMap.get(g2.cluster().localNode());
  assertNotNull(g2Keys);
  assertFalse("There are no keys assigned to g2",g2Keys.isEmpty());
  Thread.sleep(5000);
  Collection<GridEvent> objEvts=g1.events().localQuery(F.<GridEvent>alwaysTrue(),EVT_CACHE_PRELOAD_OBJECT_UNLOADED);
  checkObjectUnloadEvents(objEvts,g1,g2Keys);
  Collection<GridEvent> partEvts=g1.events().localQuery(F.<GridEvent>alwaysTrue(),EVT_CACHE_PRELOAD_PART_UNLOADED);
  checkPartitionUnloadEvents(partEvts,g1,dht(g2.cache(null)).topology().localPartitions());
}
