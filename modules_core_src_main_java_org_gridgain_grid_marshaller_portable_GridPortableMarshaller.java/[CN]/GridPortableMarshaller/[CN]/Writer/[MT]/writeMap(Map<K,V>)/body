{
  if (map != null) {
    int handle=handles.lookup(map);
    if (handle >= 0) {
      out.writeByte(OBJECT_TYPE_REF);
      out.writeInt(handle);
    }
 else {
      out.writeByte(OBJECT_TYPE_OBJECT);
      out.writeInt(map.size());
      for (      Map.Entry<K,V> e : map.entrySet()) {
        writeObject(e.getKey());
        writeObject(e.getValue());
      }
    }
  }
 else   out.writeByte(OBJECT_TYPE_NULL);
}
