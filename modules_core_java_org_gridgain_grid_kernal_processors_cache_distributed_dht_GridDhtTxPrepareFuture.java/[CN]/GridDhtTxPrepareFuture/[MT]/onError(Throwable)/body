{
  if (err.compareAndSet(null,t)) {
    tx.setRollbackOnly();
    if (!tx.nearNodeId().equals(cctx.nodeId())) {
      GridCacheMessage<K,V> res=new GridNearTxPrepareResponse<>(tx.nearXidVersion(),tx.nearFutureId(),nearMiniId,tx.xidVersion(),Collections.<Integer>emptySet(),t);
      try {
        cctx.io().send(tx.nearNodeId(),res);
      }
 catch (      GridException e) {
        U.error(log,"Failed to send reply to originating near node (will rollback): " + tx.nearNodeId(),e);
        try {
          tx.rollback();
        }
 catch (        GridException ex) {
          U.error(log,"Failed to rollback due to failure to communicate back up nodes: " + tx,ex);
        }
      }
    }
    onComplete();
  }
}
