{
  IgniteConfiguration cfg=super.getConfiguration(gridName);
  if (cfg.isClientMode() != null && cfg.isClientMode()) {
    TcpDiscoveryVmIpFinder clientFinder=new TcpDiscoveryVmIpFinder();
    String firstSrvAddr=F.first(ipFinder.getRegisteredAddresses()).toString();
    if (firstSrvAddr.startsWith("/"))     firstSrvAddr=firstSrvAddr.substring(1);
    clientFinder.setAddresses(Collections.singletonList(firstSrvAddr));
    TcpClientDiscoverySpi discoverySpi=new TcpClientDiscoverySpi();
    discoverySpi.setIpFinder(clientFinder);
    cfg.setDiscoverySpi(discoverySpi);
  }
  cfg.setLocalHost("127.0.0.1");
  return cfg;
}
