{
  List<Map.Entry<K,V>> entries0=null;
  GridFutureAdapter<Object> curFut0;
synchronized (this) {
    curFut0=curFut;
    curFut0.listen(lsnr);
    for (    Map.Entry<K,V> entry : newEntries)     entries.add(entry);
    if (entries.size() >= bufSize) {
      entries0=entries;
      entries=newEntries();
      curFut=new GridFutureAdapter<>();
      curFut.listen(signalC);
    }
  }
  if (entries0 != null) {
    submit(entries0,curFut0);
    if (cancelled)     curFut0.onDone(new IgniteCheckedException("Data streamer has been cancelled: " + IgniteDataStreamerImpl.this));
  }
  return curFut0;
}
