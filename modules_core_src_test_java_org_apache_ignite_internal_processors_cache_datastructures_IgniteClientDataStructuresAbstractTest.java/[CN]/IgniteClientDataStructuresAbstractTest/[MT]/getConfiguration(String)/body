{
  IgniteConfiguration cfg=super.getConfiguration(gridName);
  ((TcpDiscoverySpi)cfg.getDiscoverySpi()).setIpFinder(ipFinder);
  if (gridName.equals(getTestGridName(NODE_CNT - 1))) {
    cfg.setClientMode(true);
    if (clientDiscovery()) {
      TcpDiscoveryVmIpFinder clientFinder=new TcpDiscoveryVmIpFinder();
      String firstSrvAddr=F.first(ipFinder.getRegisteredAddresses()).toString();
      if (firstSrvAddr.startsWith("/"))       firstSrvAddr=firstSrvAddr.substring(1);
      clientFinder.setAddresses(Collections.singletonList(firstSrvAddr));
      TcpClientDiscoverySpi discoverySpi=new TcpClientDiscoverySpi();
      discoverySpi.setIpFinder(clientFinder);
      cfg.setDiscoverySpi(discoverySpi);
    }
  }
  cfg.setLocalHost("127.0.0.1");
  return cfg;
}
