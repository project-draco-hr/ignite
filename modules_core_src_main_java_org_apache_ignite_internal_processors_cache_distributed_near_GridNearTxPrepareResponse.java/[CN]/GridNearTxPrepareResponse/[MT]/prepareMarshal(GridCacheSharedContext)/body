{
  super.prepareMarshal(ctx);
  if (ownedVals != null) {
    ownedValKeys=ownedVals.keySet();
    ownedValVals=ownedVals.values();
    for (    Map.Entry<IgniteTxKey,CacheVersionedValue> entry : ownedVals.entrySet()) {
      GridCacheContext cacheCtx=ctx.cacheContext(entry.getKey().cacheId());
      entry.getKey().prepareMarshal(cacheCtx);
      entry.getValue().prepareMarshal(cacheCtx.cacheObjectContext());
    }
  }
  if (retValBytes == null && retVal != null)   retValBytes=ctx.marshaller().marshal(retVal);
  if (filterFailedKeys != null) {
    for (    IgniteTxKey key : filterFailedKeys) {
      GridCacheContext cctx=ctx.cacheContext(key.cacheId());
      key.prepareMarshal(cctx);
    }
  }
}
