{
  boolean changed;
  Long lastMod;
  if (file.isDirectory()) {
    GridTuple<Long> dirLastModified=F.t(file.lastModified());
    changed=checkGarDirectoryChanged(file,dirLastModified);
    lastMod=dirLastModified.get();
  }
 else {
    lastMod=tstampCache.get(file);
    changed=lastMod == null || lastMod != file.lastModified();
    lastMod=file.lastModified();
  }
  if (changed) {
    tstampCache.put(file,lastMod);
    if (getLogger().isDebugEnabled()) {
      getLogger().debug("Discovered deployment file or directory: " + file);
    }
    String fileName=file.getName();
    try {
      File cpFile=createTempFile(fileName,getDeployDirectory());
      cpFile.deleteOnExit();
      if (file.isDirectory()) {
        cpFile=new File(cpFile.getParent(),"dir_" + cpFile.getName());
        cpFile.deleteOnExit();
      }
      U.copy(file,cpFile,true);
      String fileUri=getFileUri(file.getAbsolutePath());
      getListener().onNewOrUpdatedFile(cpFile,fileUri,lastMod);
    }
 catch (    IOException e) {
      U.error(getLogger(),"Error saving file: " + fileName,e);
    }
  }
}
