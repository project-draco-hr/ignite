{
  IgniteKernal g0=(IgniteKernal)startGrid(0);
  assertFalse(g0.context().discovery().hasNearCache(CACHE_NAME,0));
  assertFalse(g0.context().discovery().hasNearCache(null,0));
  assertFalse(g0.context().discovery().hasNearCache(CACHE_NAME,1));
  assertFalse(g0.context().discovery().hasNearCache(null,1));
  IgniteKernal g1=(IgniteKernal)startGrid(1);
  assertFalse(g0.context().discovery().hasNearCache(CACHE_NAME,1));
  assertTrue(g0.context().discovery().hasNearCache(CACHE_NAME,2));
  assertFalse(g0.context().discovery().hasNearCache(null,1));
  assertTrue(g0.context().discovery().hasNearCache(null,2));
  assertTrue(g1.context().discovery().hasNearCache(CACHE_NAME,2));
  assertTrue(g1.context().discovery().hasNearCache(null,2));
  IgniteKernal g2=(IgniteKernal)startGrid(2);
  assertFalse(g0.context().discovery().hasNearCache(CACHE_NAME,1));
  assertTrue(g0.context().discovery().hasNearCache(CACHE_NAME,2));
  assertTrue(g0.context().discovery().hasNearCache(CACHE_NAME,3));
  assertFalse(g0.context().discovery().hasNearCache(null,1));
  assertTrue(g0.context().discovery().hasNearCache(null,2));
  assertTrue(g0.context().discovery().hasNearCache(null,3));
  assertTrue(g1.context().discovery().hasNearCache(CACHE_NAME,2));
  assertTrue(g1.context().discovery().hasNearCache(CACHE_NAME,3));
  assertTrue(g1.context().discovery().hasNearCache(null,2));
  assertTrue(g1.context().discovery().hasNearCache(null,3));
  assertTrue(g2.context().discovery().hasNearCache(CACHE_NAME,3));
  assertTrue(g2.context().discovery().hasNearCache(null,3));
  stopGrid(1);
  assertFalse(g0.context().discovery().hasNearCache(CACHE_NAME,1));
  assertTrue(g0.context().discovery().hasNearCache(CACHE_NAME,2));
  assertTrue(g0.context().discovery().hasNearCache(CACHE_NAME,3));
  assertTrue(g0.context().discovery().hasNearCache(CACHE_NAME,4));
  assertFalse(g0.context().discovery().hasNearCache(null,1));
  assertTrue(g0.context().discovery().hasNearCache(null,2));
  assertTrue(g0.context().discovery().hasNearCache(null,3));
  assertTrue(g0.context().discovery().hasNearCache(null,4));
  assertTrue(g2.context().discovery().hasNearCache(CACHE_NAME,3));
  assertTrue(g2.context().discovery().hasNearCache(CACHE_NAME,4));
  assertTrue(g2.context().discovery().hasNearCache(null,3));
  assertTrue(g2.context().discovery().hasNearCache(null,4));
  stopGrid(2);
  assertFalse(g0.context().discovery().hasNearCache(CACHE_NAME,1));
  assertTrue(g0.context().discovery().hasNearCache(CACHE_NAME,2));
  assertTrue(g0.context().discovery().hasNearCache(CACHE_NAME,3));
  assertTrue(g0.context().discovery().hasNearCache(CACHE_NAME,4));
  assertFalse(g0.context().discovery().hasNearCache(CACHE_NAME,5));
  assertFalse(g0.context().discovery().hasNearCache(null,1));
  assertTrue(g0.context().discovery().hasNearCache(null,2));
  assertTrue(g0.context().discovery().hasNearCache(null,3));
  assertTrue(g0.context().discovery().hasNearCache(null,4));
  assertFalse(g0.context().discovery().hasNearCache(null,5));
}
