{
  rmMock.availableRes(new MockResource(1024,2));
  NMMock nmClient=new NMMock();
  appMaster.setRmClient(rmMock);
  appMaster.setNmClient(nmClient);
  appMaster.setFs(new MockFileSystem());
  props.cpusPerNode(8);
  props.memoryPerNode(5000);
  props.instances(3);
  props.hostnameConstraint(Pattern.compile("ignoreHost"));
  appMaster.onContainersAllocated(Collections.singletonList(createContainer("simple",8,5000)));
  assertEquals(0,rmMock.releasedResources().size());
  assertEquals(1,nmClient.startedContainer().size());
  appMaster.onContainersAllocated(Collections.singletonList(createContainer("ignoreHost",8,5000)));
  assertEquals(1,rmMock.releasedResources().size());
  assertEquals(1,nmClient.startedContainer().size());
}
