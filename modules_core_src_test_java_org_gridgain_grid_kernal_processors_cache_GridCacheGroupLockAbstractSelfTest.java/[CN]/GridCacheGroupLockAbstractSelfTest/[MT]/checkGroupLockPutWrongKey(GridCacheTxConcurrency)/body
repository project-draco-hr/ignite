{
  UUID affinityKey=primaryKeyForCache(grid(0));
  final GridCache<GridCacheAffinityKey<String>,String> cache=grid(0).cache(null);
  GridCacheTx tx=cache.txStartAffinity(affinityKey,concurrency,READ_COMMITTED,0,1);
  try {
    cache.put(new GridCacheAffinityKey<>("key1",UUID.randomUUID()),"val1");
    fail("Exception should be thrown");
  }
 catch (  GridException ignored) {
  }
 finally {
    tx.close();
  }
  assertNull(cache.tx());
}
