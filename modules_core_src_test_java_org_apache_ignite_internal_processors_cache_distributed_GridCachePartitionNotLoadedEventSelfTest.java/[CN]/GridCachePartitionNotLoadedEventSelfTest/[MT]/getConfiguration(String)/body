{
  IgniteConfiguration cfg=super.getConfiguration(gridName);
  TcpDiscoverySpi disco=new TcpDiscoverySpi();
  disco.setIpFinder(ipFinder);
  cfg.setDiscoverySpi(disco);
  if (gridName.matches(".*\\d")) {
    String idStr=UUID.randomUUID().toString();
    char[] chars=idStr.toCharArray();
    chars[chars.length - 3]='0';
    chars[chars.length - 2]='0';
    chars[chars.length - 1]=gridName.charAt(gridName.length() - 1);
    cfg.setNodeId(UUID.fromString(new String(chars)));
  }
  cfg.setCommunicationSpi(new TestTcpCommunicationSpi());
  CacheConfiguration<Integer,Integer> cacheCfg=new CacheConfiguration<>();
  cacheCfg.setCacheMode(PARTITIONED);
  cacheCfg.setBackups(backupCnt);
  cacheCfg.setWriteSynchronizationMode(FULL_SYNC);
  cfg.setCacheConfiguration(cacheCfg);
  return cfg;
}
