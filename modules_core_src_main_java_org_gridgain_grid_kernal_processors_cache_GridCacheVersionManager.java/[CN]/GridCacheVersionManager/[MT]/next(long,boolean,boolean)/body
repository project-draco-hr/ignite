{
  if (topVer == -1)   topVer=cctx.kernalContext().discovery().topologyVersion();
  if (addTime) {
    if (gridStartTime == 0)     gridStartTime=cctx.kernalContext().discovery().gridStartTime();
    topVer+=(gridStartTime - TOP_VER_BASE_TIME) / 1000;
  }
  long globalTime=cctx.config().getAtomicWriteOrderMode() == GridCacheAtomicWriteOrderMode.CLOCK ? cctx.kernalContext().clockSync().adjustedTime(topVer) : 0;
  int locNodeOrder=(int)cctx.localNode().order();
  if (txSerEnabled) {
synchronized (this) {
      long ord=forLoad ? loadOrder.incrementAndGet() : order.incrementAndGet();
      GridCacheVersion next=new GridCacheVersion((int)topVer,globalTime,ord,locNodeOrder,dataCenterId);
      last=next;
      return next;
    }
  }
 else {
    long ord=forLoad ? loadOrder.incrementAndGet() : order.incrementAndGet();
    GridCacheVersion next=new GridCacheVersion((int)topVer,globalTime,ord,locNodeOrder,dataCenterId);
    last=next;
    return next;
  }
}
