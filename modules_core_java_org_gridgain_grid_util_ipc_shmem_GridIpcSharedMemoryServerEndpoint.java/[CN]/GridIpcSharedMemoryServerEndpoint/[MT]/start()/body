{
  GridIpcSharedMemoryNativeLoader.load();
  pid=GridIpcSharedMemoryUtils.pid();
  if (pid == -1)   throw new GridGgfsIpcEndpointBindException("Failed to get PID of the current process.");
  if (size <= 0)   throw new GridGgfsIpcEndpointBindException("Space size should be positive: " + size);
  if (F.isEmpty(tokDirPath))   throw new GridGgfsIpcEndpointBindException("Token directory path is empty.");
  File workDir=new File(tokDirPath);
  String locNodeTokDir=locNodeId.toString() + "-" + GridIpcSharedMemoryUtils.pid();
  if (workDir.isAbsolute())   tokDir=new File(workDir,locNodeTokDir);
 else   if (!F.isEmpty(U.getGridGainHome()))   tokDir=new File(new File(U.getGridGainHome(),tokDirPath),locNodeTokDir);
 else   throw new GridGgfsIpcEndpointBindException("Failed to resolve token directory path: " + tokDirPath);
  if (!U.mkdirs(tokDir))   throw new GridGgfsIpcEndpointBindException("Failed to create token directory: " + tokDir.getAbsolutePath());
  if (!tokDir.canRead() || !tokDir.canWrite())   throw new GridGgfsIpcEndpointBindException("Cannot read from or write to token directory: " + tokDir.getAbsolutePath());
  if (port <= 0 || port >= 0xffff)   throw new GridGgfsIpcEndpointBindException("Port value is illegal: " + port);
  try {
    srvSock=new ServerSocket();
    srvSock.bind(new InetSocketAddress("127.0.0.1",port));
  }
 catch (  IOException e) {
    U.closeQuiet(srvSock);
    throw new GridGgfsIpcEndpointBindException("Failed to bind shared memory IPC endpoint (is port already " + "in use?): " + port,e);
  }
  gcWorker=new GcWorker(gridName,"ipc-shmem-gc",log);
  new GridThread(gcWorker).start();
  if (log.isInfoEnabled())   log.info("IPC shared memory server endpoint started [port=" + port + ", tokDir="+ tokDir.getAbsolutePath()+ ']');
}
