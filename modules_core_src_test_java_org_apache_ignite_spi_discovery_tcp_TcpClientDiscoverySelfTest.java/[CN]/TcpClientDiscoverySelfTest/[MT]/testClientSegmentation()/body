{
  clientsPerSrv=1;
  startServerNodes(3);
  startClientNodes(3);
  checkNodes(3,3);
  srvFailedLatch=new CountDownLatch(2 + 2);
  clientFailedLatch=new CountDownLatch(2 + 2);
  attachListeners(2,2);
  final CountDownLatch client2StoppedLatch=new CountDownLatch(1);
  IgnitionListener lsnr=new IgnitionListener(){
    @Override public void onStateChange(    @Nullable String name,    IgniteState state){
      if (state == IgniteState.STOPPED_ON_SEGMENTATION)       client2StoppedLatch.countDown();
    }
  }
;
  G.addListener(lsnr);
  try {
    failServer(2);
    await(srvFailedLatch);
    await(clientFailedLatch);
    await(client2StoppedLatch);
    checkNodes(2,2);
  }
  finally {
    G.removeListener(lsnr);
  }
}
