{
  Selector selector=null;
  ServerSocketChannel srvrCh=null;
  try {
    selector=SelectorProvider.provider().openSelector();
    if (addr != null) {
      srvrCh=ServerSocketChannel.open();
      srvrCh.configureBlocking(false);
      srvrCh.socket().bind(addr);
      srvrCh.register(selector,SelectionKey.OP_ACCEPT);
    }
    return selector;
  }
 catch (  BindException e) {
    U.close(srvrCh,log);
    U.close(selector,log);
    throw new GridNioBindException("Failed to initialize server socket (is address already in use?): " + addr,e);
  }
catch (  Throwable e) {
    U.close(srvrCh,log);
    U.close(selector,log);
    throw new GridException("Failed to initialize NIO selector.",e);
  }
}
