{
  int size=16 + U.GG_HEADER.length + req.protocolVersion().length()+ req.marshallerClassName().length();
  GridUnsafeDataOutput out=new GridUnsafeDataOutput(size);
  try {
    System.arraycopy(U.GG_HEADER,0,out.internalArray(),0,U.GG_HEADER.length);
    out.offset(U.GG_HEADER.length);
    writeSize(out,size - 4 - U.GG_HEADER.length);
    out.writeByte(TYP_HND_REQ);
    out.writeByte(req.dataCenterId());
    U.writeString(out,req.protocolVersion());
    U.writeString(out,req.marshallerClassName());
    return out.offset() == size ? out.internalArray() : out.array();
  }
 catch (  IOException e) {
    throw new GridException("Failed to marshal DR handshake request.",e);
  }
}
