{
  startGrids(4);
  try {
    for (int i=3; i >= 0; i--) {
      IgniteKernal g=(IgniteKernal)grid(i);
      NavigableMap<IgniteProductVersion,Collection<ClusterNode>> verMap=g.context().discovery().topologyVersionMap();
      assertEquals(4,verMap.size());
      assertEquals(4,verMap.get(IgniteProductVersion.fromString("1.0.0")).size());
      assertEquals(3,verMap.get(IgniteProductVersion.fromString("2.0.0")).size());
      assertEquals(2,verMap.get(IgniteProductVersion.fromString("3.0.0-ent-1385099743")).size());
      assertEquals(1,verMap.get(IgniteProductVersion.fromString("4.0.0-ent-1385099743")).size());
    }
  }
  finally {
    stopAllGrids();
  }
}
