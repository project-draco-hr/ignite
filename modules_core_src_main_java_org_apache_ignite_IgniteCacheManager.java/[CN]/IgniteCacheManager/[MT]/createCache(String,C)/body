{
  ensureNotClosed();
  if (cacheCfg == null)   throw new NullPointerException();
  if (cacheName == null)   throw new NullPointerException();
  if (!(cacheCfg instanceof CompleteConfiguration))   throw new UnsupportedOperationException("Configuration is not supported: " + cacheCfg);
  if (cacheCfg instanceof GridCacheConfiguration) {
    String cfgCacheName=((GridCacheConfiguration)cacheCfg).getName();
    if (cfgCacheName != null) {
      if (!cacheName.equals(cfgCacheName))       throw new IllegalArgumentException();
    }
 else {
      cacheCfg=(C)new GridCacheConfiguration((CompleteConfiguration)cacheCfg);
      ((GridCacheConfiguration)cacheCfg).setName(cacheName);
    }
  }
  IgniteCache<K,V> res;
synchronized (igniteMap) {
    if (igniteMap.containsKey(cacheName))     throw new CacheException("Cache already exists [cacheName=" + cacheName + ", manager="+ uri+ ']');
    Ignite ignite;
    if (uri.equals(cachingProvider.getDefaultURI())) {
      IgniteConfiguration cfg=new IgniteConfiguration();
      cfg.setGridName("grid-for-" + cacheName);
      cfg.setCacheConfiguration(new GridCacheConfiguration((CompleteConfiguration)cacheCfg));
      cfg.getCacheConfiguration()[0].setName(cacheName);
      try {
        ignite=Ignition.start(cfg);
      }
 catch (      IgniteCheckedException e) {
        throw new CacheException(e);
      }
    }
 else     throw new UnsupportedOperationException();
    res=ignite.jcache(cacheName);
    igniteMap.put(cacheName,new T2<>(ignite,new IgniteCacheMXBean(res)));
  }
  if (((CompleteConfiguration)cacheCfg).isManagementEnabled())   enableManagement(cacheName,true);
  if (((CompleteConfiguration)cacheCfg).isStatisticsEnabled())   enableStatistics(cacheName,true);
  return res;
}
