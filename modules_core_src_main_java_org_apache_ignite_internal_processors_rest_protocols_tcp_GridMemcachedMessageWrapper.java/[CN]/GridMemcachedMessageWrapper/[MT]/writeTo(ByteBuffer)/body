{
  stream.setBuffer(buf);
  if (!commState.typeWritten) {
    if (!buf.hasRemaining())     return false;
    stream.writeByte(directType());
    commState.typeWritten=true;
  }
  stream.writeByteArray(bytes,0,bytes.length);
  return stream.lastFinished();
}
