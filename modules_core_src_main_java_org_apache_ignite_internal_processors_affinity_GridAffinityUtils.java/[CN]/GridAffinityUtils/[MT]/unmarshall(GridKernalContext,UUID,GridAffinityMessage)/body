{
  GridDeployment dep=ctx.deploy().getGlobalDeployment(msg.deploymentMode(),msg.sourceClassName(),msg.sourceClassName(),msg.userVersion(),sndNodeId,msg.classLoaderId(),msg.loaderParticipants(),null);
  if (dep == null)   throw new IgniteDeploymentCheckedException("Failed to obtain affinity object (is peer class loading turned on?): " + msg);
  Object src=ctx.config().getMarshaller().unmarshal(msg.source(),U.resolveClassLoader(dep.classLoader(),ctx.config()));
  ctx.resource().inject(dep,dep.deployedClass(msg.sourceClassName()),src);
  return src;
}
