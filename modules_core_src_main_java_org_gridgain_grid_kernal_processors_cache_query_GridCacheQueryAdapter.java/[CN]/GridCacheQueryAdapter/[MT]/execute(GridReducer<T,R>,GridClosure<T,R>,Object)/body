{
  Collection<GridNode> nodes=nodes();
  if (log.isDebugEnabled())   log.debug("Executing query [query=" + this + ", nodes="+ nodes+ ']');
  if (cctx.deploymentEnabled()) {
    try {
      cctx.deploy().registerClasses(cls,filter,rmtReducer,rmtTransform);
      cctx.deploy().registerClasses(args);
    }
 catch (    GridException e) {
      return new GridCacheQueryErrorFuture<>(cctx.kernalContext(),e);
    }
  }
  GridCacheQueryBean bean=new GridCacheQueryBean(this,(GridReducer<Object,Object>)rmtReducer,(GridClosure<Object,Object>)rmtTransform,args);
  GridCacheQueryManager qryMgr=cctx.queries();
  boolean loc=nodes.size() == 1 && F.first(nodes).id().equals(cctx.localNodeId());
  if (type == SQL_FIELDS)   return (GridCacheQueryFuture<R>)(loc ? qryMgr.queryFieldsLocal(bean) : qryMgr.queryFieldsDistributed(bean,nodes));
 else   return (GridCacheQueryFuture<R>)(loc ? qryMgr.queryLocal(bean) : qryMgr.queryDistributed(bean,nodes));
}
