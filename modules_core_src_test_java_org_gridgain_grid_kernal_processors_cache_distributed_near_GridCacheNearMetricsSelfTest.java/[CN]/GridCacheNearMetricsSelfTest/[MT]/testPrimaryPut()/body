{
  Grid g0=grid(0);
  GridCache<Integer,Integer> cache0=g0.cache(null);
  int key;
  for (int i=0; ; i++) {
    if (cache0.affinity().isPrimary(g0.localNode(),i)) {
      cache0.put(i,i);
      cache0.get(i);
      key=i;
      info("Writes: " + cache0.metrics().writes());
      info("Reads: " + cache0.metrics().reads());
      info("Affinity nodes: " + U.nodes2names(cache0.affinity().mapKeyToPrimaryAndBackups(i)));
      break;
    }
  }
  for (int j=0; j < gridCount(); j++) {
    Grid g=grid(j);
    info("Checking grid: " + g.name());
    info("Writes: " + g.cache(null).metrics().writes());
    info("Reads: " + g.cache(null).metrics().reads());
    if (g.cache(null).affinity().isPrimaryOrBackup(g.localNode(),key))     assertEquals(1,g.cache(null).metrics().writes());
 else     assertEquals(0,g.cache(null).metrics().writes());
    if (g.cache(null).affinity().isPrimary(g.localNode(),key)) {
      assertEquals(2,g.cache(null).metrics().reads());
      assertEquals(1,g.cache(null).metrics().hits());
      assertEquals(1,g.cache(null).metrics().misses());
    }
 else {
      assertEquals(0,g.cache(null).metrics().reads());
      assertEquals(0,g.cache(null).metrics().hits());
      assertEquals(0,g.cache(null).metrics().misses());
    }
  }
}
