{
  Collection<DynamicCacheChangeRequest> reqs=new ArrayList<>(registeredCaches.size() + registeredTemplates.size());
  for (  DynamicCacheDescriptor desc : registeredCaches.values()) {
    DynamicCacheChangeRequest req=new DynamicCacheChangeRequest(desc.cacheConfiguration().getName(),null);
    req.startCacheConfiguration(desc.cacheConfiguration());
    req.cacheType(desc.cacheType());
    req.deploymentId(desc.deploymentId());
    reqs.add(req);
  }
  for (  DynamicCacheDescriptor desc : registeredTemplates.values()) {
    DynamicCacheChangeRequest req=new DynamicCacheChangeRequest(desc.cacheConfiguration().getName(),null);
    req.startCacheConfiguration(desc.cacheConfiguration());
    req.template(true);
    req.deploymentId(desc.deploymentId());
    reqs.add(req);
  }
  DynamicCacheChangeBatch req=new DynamicCacheChangeBatch(reqs);
  req.clientNodes(ctx.discovery().clientNodesMap());
  return req;
}
