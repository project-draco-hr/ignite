{
  final GridFutureAdapterEx<T> fut=new GridFutureAdapterEx<T>(){
    @Override public String toString(){
      return "ChainFuture[orig=" + GridFutureAdapterEx.this + ", doneCb="+ doneCb+ ']';
    }
  }
;
  listenAsync(new IgniteInClosure<GridFuture<R>>(){
    @Override public void apply(    GridFuture<R> t){
      try {
        fut.onDone(doneCb.apply(t));
      }
 catch (      GridClosureException e) {
        fut.onDone(e.unwrap());
      }
catch (      RuntimeException e) {
        U.warn(null,"Failed to notify chained future (is grid stopped?) [, doneCb=" + doneCb + ", err="+ e.getMessage()+ ']');
        fut.onDone(e);
        throw e;
      }
catch (      Error e) {
        U.warn(null,"Failed to notify chained future (is grid stopped?) [doneCb=" + doneCb + ", err="+ e.getMessage()+ ']');
        fut.onDone(e);
        throw e;
      }
    }
  }
);
  return fut;
}
