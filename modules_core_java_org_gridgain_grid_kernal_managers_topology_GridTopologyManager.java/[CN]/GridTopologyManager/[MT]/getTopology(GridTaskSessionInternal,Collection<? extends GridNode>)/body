{
  try {
    Collection<? extends GridNode> actualGrid=grid;
    GridPredicate<GridNode> nodeFilter=taskSes.getNodeFilter();
    if (nodeFilter != null)     actualGrid=F.view(actualGrid,nodeFilter);
    return getSpi(taskSes.getTopologySpi()).getTopology(taskSes,actualGrid);
  }
 catch (  GridSpiException e) {
    throw new GridException("Failed to get topology for task [taskSes=" + taskSes + ", grid="+ grid+ ']',e);
  }
}
