{
  if (!msgTypeDone) {
    if (!buf.hasRemaining())     return MSG_NOT_READ;
    byte type=readByte();
    msg=GridTcpCommunicationMessageFactory.create(type);
    msgTypeDone=true;
  }
  if (msg.readFrom(buf)) {
    GridTcpCommunicationMessageAdapter msg0=msg;
    msgTypeDone=false;
    msg=null;
    return msg0;
  }
 else   return MSG_NOT_READ;
}
