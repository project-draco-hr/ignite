{
  Ignite ignite1=null;
  Ignite ignite2=null;
  Ignite ignite3=null;
  try {
    ignite1=startGrid(1,new GridSpringResourceContextImpl(new GenericApplicationContext()));
    ignite2=startGrid(2,new GridSpringResourceContextImpl(new GenericApplicationContext()));
    ignite3=startGrid(3,new GridSpringResourceContextImpl(new GenericApplicationContext()));
    ignite1.compute().execute(SharedResourceTask1.class,null);
    ignite2.compute().execute(SharedResourceTask1.class,null);
    checkUsageCount(createClss,UserResource1.class,6);
    checkUsageCount(deployClss,UserResource1.class,6);
    checkUsageCount(createClss,UserResource2.class,6);
    checkUsageCount(deployClss,UserResource2.class,6);
    checkUsageCount(undeployClss,UserResource1.class,0);
    checkUsageCount(undeployClss,UserResource2.class,0);
    ignite1.compute().undeployTask(SharedResourceTask1.class.getName());
    Thread.sleep(3000);
    checkUsageCount(undeployClss,UserResource1.class,6);
    checkUsageCount(undeployClss,UserResource2.class,6);
    ignite2.compute().undeployTask(SharedResourceTask1.class.getName());
    Thread.sleep(3000);
    checkUsageCount(undeployClss,UserResource1.class,6);
    checkUsageCount(undeployClss,UserResource2.class,6);
  }
  finally {
    GridTestUtils.close(ignite1,log());
    GridTestUtils.close(ignite2,log());
    GridTestUtils.close(ignite3,log());
  }
}
