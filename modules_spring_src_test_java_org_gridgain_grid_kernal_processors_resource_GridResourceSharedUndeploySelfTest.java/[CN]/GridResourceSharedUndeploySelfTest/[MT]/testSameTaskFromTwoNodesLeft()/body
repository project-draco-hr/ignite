{
  Grid grid1=null;
  Grid grid2=null;
  Grid grid3=null;
  try {
    grid1=startGrid(1,new GridSpringResourceContextImpl(new GenericApplicationContext()));
    grid2=startGrid(2,new GridSpringResourceContextImpl(new GenericApplicationContext()));
    grid3=startGrid(3,new GridSpringResourceContextImpl(new GenericApplicationContext()));
    grid1.compute().execute(SharedResourceTask1.class,null).get();
    grid2.compute().execute(SharedResourceTask1.class,null).get();
    checkUsageCount(createClss,UserResource1.class,6);
    checkUsageCount(deployClss,UserResource1.class,6);
    checkUsageCount(createClss,UserResource2.class,6);
    checkUsageCount(deployClss,UserResource2.class,6);
    checkUsageCount(undeployClss,UserResource1.class,0);
    checkUsageCount(undeployClss,UserResource2.class,0);
    GridTestUtils.close(grid1,log());
    Thread.sleep(1000);
    checkUsageCount(undeployClss,UserResource1.class,2);
    checkUsageCount(undeployClss,UserResource2.class,2);
    GridTestUtils.close(grid2,log());
    Thread.sleep(1000);
    checkUsageCount(undeployClss,UserResource1.class,4);
    checkUsageCount(undeployClss,UserResource2.class,4);
  }
  finally {
    GridTestUtils.close(grid1,log());
    GridTestUtils.close(grid2,log());
    GridTestUtils.close(grid3,log());
  }
}
