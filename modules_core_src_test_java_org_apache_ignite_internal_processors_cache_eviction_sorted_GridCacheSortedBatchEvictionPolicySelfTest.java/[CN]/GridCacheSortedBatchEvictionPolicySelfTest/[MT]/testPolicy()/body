{
  try {
    startGrid();
    GridCacheEvictionAbstractTest.MockEntry e1=new GridCacheEvictionAbstractTest.MockEntry("1","1");
    GridCacheEvictionAbstractTest.MockEntry e2=new GridCacheEvictionAbstractTest.MockEntry("2","2");
    GridCacheEvictionAbstractTest.MockEntry e3=new GridCacheEvictionAbstractTest.MockEntry("3","3");
    GridCacheEvictionAbstractTest.MockEntry e4=new GridCacheEvictionAbstractTest.MockEntry("4","4");
    GridCacheEvictionAbstractTest.MockEntry e5=new GridCacheEvictionAbstractTest.MockEntry("5","5");
    SortedEvictionPolicy<String,String> p=policy();
    p.setMaxSize(3);
    p.setBatchSize(2);
    p.onEntryAccessed(false,e1);
    check(p.set(),e1);
    p.onEntryAccessed(false,e2);
    check(p.set(),e1,e2);
    p.onEntryAccessed(false,e3);
    check(p.set(),e1,e2,e3);
    p.onEntryAccessed(false,e4);
    check(p.set(),e1,e2,e3,e4);
    assertFalse(e1.isEvicted());
    assertFalse(e2.isEvicted());
    assertFalse(e3.isEvicted());
    assertFalse(e4.isEvicted());
    assertEquals(4,p.getCurrentSize());
    p.onEntryAccessed(false,e5);
    check(p.set(),e3,e4,e5);
    assertEquals(3,p.getCurrentSize());
    assertTrue(e1.isEvicted());
    assertTrue(e2.isEvicted());
    assertFalse(e3.isEvicted());
    assertFalse(e4.isEvicted());
    assertFalse(e5.isEvicted());
    p.onEntryAccessed(false,e1=new GridCacheEvictionAbstractTest.MockEntry("1","1"));
    check(p.set(),e1,e3,e4,e5);
    assertEquals(4,p.getCurrentSize());
    assertFalse(e1.isEvicted());
    assertFalse(e3.isEvicted());
    assertFalse(e4.isEvicted());
    assertFalse(e5.isEvicted());
    p.onEntryAccessed(false,e5);
    check(p.set(),e1,e3,e4,e5);
    assertFalse(e1.isEvicted());
    assertFalse(e3.isEvicted());
    assertFalse(e4.isEvicted());
    assertFalse(e5.isEvicted());
    p.onEntryAccessed(false,e1);
    assertEquals(4,p.getCurrentSize());
    check(p.set(),e1,e3,e4,e5);
    assertFalse(e1.isEvicted());
    assertFalse(e3.isEvicted());
    assertFalse(e4.isEvicted());
    assertFalse(e5.isEvicted());
    p.onEntryAccessed(true,e1);
    assertEquals(3,p.getCurrentSize());
    assertFalse(e3.isEvicted());
    assertFalse(e4.isEvicted());
    assertFalse(e5.isEvicted());
    p.onEntryAccessed(true,e4);
    assertEquals(2,p.getCurrentSize());
    assertFalse(e3.isEvicted());
    assertFalse(e5.isEvicted());
    p.onEntryAccessed(true,e5);
    assertEquals(1,p.getCurrentSize());
    assertFalse(e3.isEvicted());
    p.onEntryAccessed(true,e3);
    assertEquals(0,p.getCurrentSize());
    assertFalse(e3.isEvicted());
    info(p);
  }
  finally {
    stopAllGrids();
  }
}
