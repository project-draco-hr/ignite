{
  long qryReqId=reqIdGen.incrementAndGet();
  QueryRun r=new QueryRun();
  r.tbls=new ArrayList<>();
  try {
    r.conn=h2.connectionForSpace(null);
  }
 catch (  IgniteCheckedException e) {
    throw new IgniteException(e);
  }
  Collection<ClusterNode> nodes=ctx.grid().cluster().nodes();
  for (  GridCacheSqlQuery mapQry : qry.mapQueries()) {
    GridMergeTable tbl=createTable(r.conn,mapQry);
    tbl.getScanIndex(null).setNumberOfSources(nodes.size());
    r.tbls.add(tbl);
  }
  r.latch=new CountDownLatch(r.tbls.size() * nodes.size());
  this.runs.put(qryReqId,r);
  try {
    ctx.io().sendUserMessage(nodes,new GridQueryRequest(qryReqId,1000,qry.mapQueries()),GridTopic.TOPIC_QUERY,false,0);
    r.latch.await();
    GridCacheSqlQuery rdc=qry.reduceQuery();
    final ResultSet res=h2.executeSqlQueryWithTimer(r.conn,rdc.query(),F.asList(rdc.parameters()));
    return new GridFinishedFuture(ctx,new Iter(res));
  }
 catch (  IgniteCheckedException|InterruptedException e) {
    return new GridFinishedFuture<>(ctx,e);
  }
}
