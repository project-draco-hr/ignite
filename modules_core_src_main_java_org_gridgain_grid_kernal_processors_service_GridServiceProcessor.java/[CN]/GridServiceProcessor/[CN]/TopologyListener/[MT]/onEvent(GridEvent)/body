{
  if (!busyLock.enterBusy())   return;
  try {
    long topVer=((GridDiscoveryEvent)evt).topologyVersion();
    GridNode oldest=U.oldest(ctx.discovery().nodes(topVer),null);
    if (oldest.isLocal()) {
      final Collection<GridServiceConfiguration> retries=new ConcurrentLinkedQueue<>();
      for (      GridCacheEntry<GridServiceConfigurationKey,GridServiceConfiguration> e : cfgCache.entrySetx()) {
        GridServiceConfiguration cfg=e.getValue();
        try {
          reassign(cfg,topVer);
        }
 catch (        GridException ex) {
          if (!(e instanceof GridTopologyException))           LT.error(log,ex,"Failed to do service reassignment (will retry): " + cfg.getName());
          retries.add(cfg);
        }
      }
      if (!retries.isEmpty())       onReassignmentFailed(topVer,retries);
    }
  }
  finally {
    busyLock.leaveBusy();
  }
}
