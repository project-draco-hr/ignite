{
  depExe.submit(new BusyRunnable(){
    @Override public void run0(){
      long topVer=((GridDiscoveryEvent)evt).topologyVersion();
      GridNode oldest=U.oldest(ctx.discovery().nodes(topVer),null);
      if (oldest.isLocal()) {
        final Collection<GridServiceDeployment> retries=new ConcurrentLinkedQueue<>();
        for (        GridCacheEntry<Object,Object> e : depCache.entrySetx()) {
          if (!(e.getKey() instanceof GridServiceDeploymentKey))           continue;
          GridServiceDeployment dep=(GridServiceDeployment)e.getValue();
          try {
            svcName.set(dep.configuration().getName());
            ctx.cache().internalCache(CU.UTILITY_CACHE_NAME).context().affinity().affinityReadyFuture(topVer).get();
            reassign(dep,topVer);
          }
 catch (          GridException ex) {
            if (!(e instanceof GridTopologyException))             LT.error(log,ex,"Failed to do service reassignment (will retry): " + dep.configuration().getName());
            retries.add(dep);
          }
        }
        if (!retries.isEmpty())         onReassignmentFailed(topVer,retries);
      }
    }
  }
);
}
