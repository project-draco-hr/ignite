{
  if (!busyLock.enterBusy())   return;
  try {
    if (ctx.discovery().topologyVersion() != topVer)     return;
    for (Iterator<GridServiceConfiguration> it=retries.iterator(); it.hasNext(); ) {
      GridServiceConfiguration cfg=it.next();
      try {
        reassign(cfg,topVer);
        it.remove();
      }
 catch (      GridException e) {
        if (!(e instanceof GridTopologyException))         LT.error(log,e,"Failed to do service reassignment (will retry): " + cfg.getName());
      }
    }
    if (!retries.isEmpty()) {
      ctx.timeout().addTimeoutObject(new GridTimeoutObject(){
        private GridUuid id=GridUuid.randomUuid();
        private long start=System.currentTimeMillis();
        @Override public GridUuid timeoutId(){
          return id;
        }
        @Override public long endTime(){
          return start + RETRY_TIMEOUT;
        }
        @Override public void onTimeout(){
          onReassignmentFailed(topVer,retries);
        }
      }
);
    }
  }
  finally {
    busyLock.leaveBusy();
  }
}
