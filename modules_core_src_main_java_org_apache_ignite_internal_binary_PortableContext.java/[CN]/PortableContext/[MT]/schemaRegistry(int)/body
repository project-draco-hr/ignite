{
  Map<Integer,PortableSchemaRegistry> schemas0=schemas;
  if (schemas0 == null) {
synchronized (this) {
      schemas0=schemas;
      if (schemas0 == null) {
        schemas0=new HashMap<>();
        PortableSchemaRegistry reg=new PortableSchemaRegistry();
        schemas0.put(typeId,reg);
        schemas=schemas0;
        return reg;
      }
    }
  }
  PortableSchemaRegistry reg=schemas0.get(typeId);
  if (reg == null) {
synchronized (this) {
      reg=schemas.get(typeId);
      if (reg == null) {
        reg=new PortableSchemaRegistry();
        schemas0=new HashMap<>(schemas);
        schemas0.put(typeId,reg);
        schemas=schemas0;
      }
    }
  }
  return reg;
}
