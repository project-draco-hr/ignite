{
  GridCacheProjection<String,Integer> cache=cache();
  IgniteTx tx=txEnabled() ? cache.txStart(concurrency,READ_COMMITTED) : null;
  try {
    if (startVal)     cache.put("key",2);
    cache.transform("key",INCR_PROCESSOR);
    cache.transform("key",INCR_PROCESSOR);
    cache.transform("key",INCR_PROCESSOR);
    if (tx != null)     tx.commit();
  }
  finally {
    if (tx != null)     tx.close();
  }
  Integer exp=(startVal ? 2 : 0) + 3;
  assertEquals(exp,cache.get("key"));
  for (int i=0; i < gridCount(); i++) {
    if (cache(i).affinity().isPrimaryOrBackup(grid(i).localNode(),"key"))     assertEquals(exp,peek(cache(i),"key"));
  }
}
