{
  final GridHadoopJobId jobId=taskInfo.jobId();
  boolean lastMapperFinished=completedMappersCnt.incrementAndGet() == currMappers.size();
  if (status.state() == FAILED || status.state() == CRASHED) {
    transform(jobId,new RemoveMappersClosure(taskInfo.inputSplit(),status.failCause()));
    return;
  }
  if (job.hasCombiner() && get(job,SINGLE_COMBINER_FOR_ALL_MAPPERS,false) && status.state() != CANCELED) {
    if (lastMapperFinished) {
      GridHadoopTaskInfo info=new GridHadoopTaskInfo(ctx.localNodeId(),COMBINE,jobId,meta.taskNumber(ctx.localNodeId()),taskInfo.attempt(),null);
      ctx.taskExecutor().run(job,Collections.singletonList(info));
    }
  }
 else {
    GridInClosure<GridFuture<?>> cacheUpdater=new CIX1<GridFuture<?>>(){
      @Override public void applyx(      GridFuture<?> f){
        Throwable err=null;
        if (f != null) {
          try {
            f.get();
          }
 catch (          GridException e) {
            err=e;
          }
        }
        transform(jobId,new RemoveMappersClosure(taskInfo.inputSplit(),err));
      }
    }
;
    if (lastMapperFinished)     ctx.shuffle().flush(jobId).listenAsync(cacheUpdater);
 else     cacheUpdater.apply(null);
  }
}
