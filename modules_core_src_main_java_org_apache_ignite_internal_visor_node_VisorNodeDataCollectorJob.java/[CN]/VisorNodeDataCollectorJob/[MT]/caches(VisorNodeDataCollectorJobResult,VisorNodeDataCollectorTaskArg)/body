{
  try {
    IgniteConfiguration cfg=ignite.configuration();
    GridCacheProcessor cacheProc=ignite.context().cache();
    for (    String cacheName : cacheProc.cacheNames()) {
      if (arg.systemCaches() || !(isSystemCache(cacheName) || isIgfsCache(cfg,cacheName))) {
        long start0=U.currentTimeMillis();
        try {
          boolean compatibility=false;
          for (          ClusterNode node : ignite.cluster().nodes()) {
            if (node.version().compareToIgnoreTimestamp(VER_1_4_1) <= 0) {
              compatibility=true;
              break;
            }
          }
          VisorCache cache=(compatibility ? new VisorCache() : new VisorCacheV2()).from(ignite,cacheName,arg.sample());
          if (cache != null)           res.caches().add(cache);
        }
 catch (        IllegalStateException|IllegalArgumentException e) {
          if (debug && ignite.log() != null)           ignite.log().error("Ignored cache: " + cacheName,e);
        }
 finally {
          if (debug)           log(ignite.log(),"Collected cache: " + cacheName,getClass(),start0);
        }
      }
    }
  }
 catch (  Exception cachesEx) {
    res.cachesEx(cachesEx);
  }
}
