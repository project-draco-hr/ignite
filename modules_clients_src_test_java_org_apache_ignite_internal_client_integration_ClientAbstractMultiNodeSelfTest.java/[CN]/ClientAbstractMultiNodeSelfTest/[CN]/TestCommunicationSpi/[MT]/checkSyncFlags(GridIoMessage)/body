{
  if (!commSpiEnabled)   return;
  Object o=msg.message();
  if (!(o instanceof GridDistributedLockRequest))   return;
  IgniteKernal g=(IgniteKernal)G.ignite(ignite.configuration().getNodeId());
  GridCacheContext<Object,Object> cacheCtx=g.internalCache(REPLICATED_ASYNC_CACHE_NAME).context();
  IgniteTxManager tm=cacheCtx.tm();
  GridCacheVersion v=((GridCacheVersionable)o).version();
  IgniteInternalTx t=tm.tx(v);
  if (t.hasWriteKey(cacheCtx.txKey(cacheCtx.toCacheKeyObject("x1"))))   assertFalse("Invalid tx flags: " + t,t.syncCommit());
 else   if (t.hasWriteKey(cacheCtx.txKey(cacheCtx.toCacheKeyObject("x2"))))   assertTrue("Invalid tx flags: " + t,t.syncCommit());
 else   if (t.hasWriteKey(cacheCtx.txKey(cacheCtx.toCacheKeyObject("x3"))))   assertFalse("Invalid tx flags: " + t,t.syncCommit());
 else   if (t.hasWriteKey(cacheCtx.txKey(cacheCtx.toCacheKeyObject("x4"))))   assertTrue("Invalid tx flags: " + t,t.syncCommit());
}
