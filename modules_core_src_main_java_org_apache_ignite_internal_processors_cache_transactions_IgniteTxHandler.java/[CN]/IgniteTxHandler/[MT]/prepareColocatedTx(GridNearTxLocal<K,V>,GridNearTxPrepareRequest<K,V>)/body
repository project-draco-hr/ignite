{
  IgniteInternalFuture<Object> fut=new GridFinishedFutureEx<>();
  return new GridEmbeddedFuture<>(ctx.kernalContext(),fut,new C2<Object,Exception,IgniteInternalFuture<IgniteTxEx<K,V>>>(){
    @Override public IgniteInternalFuture<IgniteTxEx<K,V>> apply(    Object o,    Exception ex){
      if (ex != null)       throw new GridClosureException(ex);
      IgniteInternalFuture<IgniteTxEx<K,V>> fut=locTx.prepareAsyncLocal(req.reads(),req.writes(),req.transactionNodes(),req.last(),req.lastBackups());
      if (locTx.isRollbackOnly())       locTx.rollbackAsync();
      return fut;
    }
  }
,new C2<IgniteTxEx<K,V>,Exception,IgniteTxEx<K,V>>(){
    @Nullable @Override public IgniteTxEx<K,V> apply(    IgniteTxEx<K,V> tx,    Exception e){
      if (e != null) {
        if (tx != null)         tx.setRollbackOnly();
        if (!(e instanceof IgniteTxOptimisticCheckedException))         U.error(log,"Failed to prepare DHT transaction: " + tx,e);
      }
      return tx;
    }
  }
);
}
