{
  IgniteInternalFuture<Object> fut=new GridFinishedFuture<>();
  return new GridEmbeddedFuture<>(fut,new C2<Object,Exception,IgniteInternalFuture<GridNearTxPrepareResponse>>(){
    @Override public IgniteInternalFuture<GridNearTxPrepareResponse> apply(    Object o,    Exception ex){
      if (ex != null)       throw new GridClosureException(ex);
      IgniteInternalFuture<GridNearTxPrepareResponse> fut=locTx.prepareAsyncLocal(req.reads(),req.writes(),req.transactionNodes(),req.last(),req.lastBackups());
      if (locTx.isRollbackOnly())       locTx.rollbackAsync();
      return fut;
    }
  }
,new C2<GridNearTxPrepareResponse,Exception,GridNearTxPrepareResponse>(){
    @Nullable @Override public GridNearTxPrepareResponse apply(    GridNearTxPrepareResponse res,    Exception e){
      if (e != null) {
        locTx.setRollbackOnly();
        if (!(e instanceof IgniteTxOptimisticCheckedException))         U.error(log,"Failed to prepare transaction: " + locTx,e);
      }
      return res;
    }
  }
);
}
