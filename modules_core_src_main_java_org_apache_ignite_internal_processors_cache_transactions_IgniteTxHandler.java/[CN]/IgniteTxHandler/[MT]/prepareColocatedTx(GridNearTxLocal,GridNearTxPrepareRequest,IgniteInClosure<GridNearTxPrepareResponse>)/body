{
  IgniteInternalFuture<Object> fut=new GridFinishedFutureEx<>();
  return new GridEmbeddedFuture<>(ctx.kernalContext(),fut,new C2<Object,Exception,IgniteInternalFuture<IgniteInternalTx>>(){
    @Override public IgniteInternalFuture<IgniteInternalTx> apply(    Object o,    Exception ex){
      if (ex != null)       throw new GridClosureException(ex);
      IgniteInternalFuture<IgniteInternalTx> fut=locTx.prepareAsyncLocal(req.reads(),req.writes(),req.transactionNodes(),req.last(),req.lastBackups(),completeCb);
      if (locTx.isRollbackOnly())       locTx.rollbackAsync();
      return fut;
    }
  }
,new C2<IgniteInternalTx,Exception,IgniteInternalTx>(){
    @Nullable @Override public IgniteInternalTx apply(    IgniteInternalTx tx,    Exception e){
      if (e != null) {
        if (tx != null)         tx.setRollbackOnly();
        if (!(e instanceof IgniteTxOptimisticCheckedException))         U.error(log,"Failed to prepare DHT transaction: " + tx,e);
      }
      return tx;
    }
  }
);
}
