{
  Ignite ignite=grid(0);
  IgniteCache<Object,Object> cache=ignite.jcache(null);
  IgniteCache<Object,Object> cacheAsync=cache.withAsync();
  int key=keyForTest();
  cache.put(key,0);
  TestCommunicationSpi commSpi=(TestCommunicationSpi)grid(1).configuration().getCommunicationSpi();
  commSpi.skipNearResponse=true;
  cacheAsync.put(key,1);
  IgniteFuture<Object> fut=cacheAsync.future();
  Map<UUID,GridCommunicationClient> clients=U.field(commSpi,"clients");
  GridTcpNioCommunicationClient client=(GridTcpNioCommunicationClient)clients.get(grid(0).localNode().id());
  client.session().close().get();
  try {
    fut.get();
    fail();
  }
 catch (  IgniteException e) {
    if (!(e.getCause() instanceof CacheAtomicUpdateTimeoutCheckedException))     throw e;
  }
}
