{
  this.backups=backups;
  this.func=func;
  startGrids(nodesCnt);
  try {
    IgniteCache<Object,Object> cache=grid(0).jcache(null);
    Collection<UUID> members=new HashSet<>();
    for (int i=0; i < 10000; i++) {
      Collection<ClusterNode> nodes=affinity(cache).mapKeyToPrimaryAndBackups(i);
      assertEquals(backups + 1,nodes.size());
      for (      ClusterNode n : nodes)       members.add(n.id());
    }
    assertEquals(nodesCnt,members.size());
  }
  finally {
    stopAllGrids();
  }
}
