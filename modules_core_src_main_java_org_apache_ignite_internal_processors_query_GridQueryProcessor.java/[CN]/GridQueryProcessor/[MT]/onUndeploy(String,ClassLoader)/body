{
  if (idx == null)   return;
  if (!busyLock.enterBusy())   throw new IllegalStateException("Failed to process undeploy event (grid is stopping).");
  try {
    Iterator<Map.Entry<TypeId,TypeDescriptor>> it=types.entrySet().iterator();
    while (it.hasNext()) {
      Map.Entry<TypeId,TypeDescriptor> e=it.next();
      if (!F.eq(e.getKey().space,space))       continue;
      TypeDescriptor desc=e.getValue();
      if (ldr.equals(U.detectClassLoader(desc.valCls)) || ldr.equals(U.detectClassLoader(desc.keyCls))) {
        idx.unregisterType(e.getKey().space,desc);
        it.remove();
      }
    }
  }
  finally {
    busyLock.leaveBusy();
  }
}
