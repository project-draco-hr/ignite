{
  IgniteConfiguration cfg=super.getConfiguration(gridName);
  cfg.setLocalHost("127.0.0.1");
  if (gridName.startsWith("server")) {
    GridTcpDiscoverySpi disco=new GridTcpDiscoverySpi();
    disco.setIpFinder(IP_FINDER);
    cfg.setDiscoverySpi(disco);
  }
 else   if (gridName.startsWith("client")) {
    GridTcpClientDiscoverySpi disco=new GridTcpClientDiscoverySpi();
    GridTcpDiscoveryVmIpFinder ipFinder=new GridTcpDiscoveryVmIpFinder();
    String addr=new ArrayList<>(IP_FINDER.getRegisteredAddresses()).get((clientIdx.get() - 1) / clientsPerSrv).toString();
    if (addr.startsWith("/"))     addr=addr.substring(1);
    ipFinder.setAddresses(Arrays.asList(addr));
    disco.setIpFinder(ipFinder);
    cfg.setDiscoverySpi(disco);
  }
  return cfg;
}
