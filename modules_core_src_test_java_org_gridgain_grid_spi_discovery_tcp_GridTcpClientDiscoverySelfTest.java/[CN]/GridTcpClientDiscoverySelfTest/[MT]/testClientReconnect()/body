{
  clientsPerSrv=1;
  startServerNodes(3);
  startClientNodes(3);
  checkNodes(3,3);
  srvFailedLatch=new CountDownLatch(2);
  clientFailedLatch=new CountDownLatch(2);
  srvJoinLatch=new CountDownLatch(2);
  clientJoinLatch=new CountDownLatch(2);
  attachListeners(2,2);
  ((GridTcpDiscoverySpi)G.grid("server-2").configuration().getDiscoverySpi()).simulateNodeFailure();
  await(srvFailedLatch);
  await(clientFailedLatch);
  await(srvJoinLatch);
  await(clientJoinLatch);
  checkNodes(2,3);
}
