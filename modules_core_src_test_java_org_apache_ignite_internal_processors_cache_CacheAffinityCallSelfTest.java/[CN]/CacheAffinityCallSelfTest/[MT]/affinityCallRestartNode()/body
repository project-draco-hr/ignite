{
  final int ITERS=10;
  for (int i=0; i < ITERS; i++) {
    log.info("Iteration: " + i);
    Integer key=primaryKey(grid(0).cache(CACHE_NAME));
    AffinityTopologyVersion topVer=grid(0).context().discovery().topologyVersionEx();
    IgniteInternalFuture<Object> fut=GridTestUtils.runAsync(new Callable<Object>(){
      @Override public Object call() throws Exception {
        U.sleep(500);
        stopGrid(0);
        return null;
      }
    }
,"stop-thread");
    while (!fut.isDone())     grid(1).compute().affinityCall(CACHE_NAME,key,new CheckCallable(key,topVer));
    fut.get();
    if (i < ITERS - 1)     startGrid(0);
  }
  stopAllGrids();
}
