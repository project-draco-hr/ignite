{
  try {
    depMode=SHARED;
    Ignite g1=startGrid(1);
    Ignite g2=startGrid(2);
    Ignite g0=startGrid(GRID_NAME);
    ClassLoader ldr=getExternalClassLoader();
    Class cls=ldr.loadClass(TEST_TASK_3);
    String key="";
    for (int i=0; i < 1000; i++) {
      key="1" + i;
      if (g1.affinity(null).mapKeyToNode(key).id().equals(g2.cluster().localNode().id()))       break;
    }
    g0.compute().execute(cls,new T2<>(g1.cluster().localNode(),key));
    stopGrid(GRID_NAME);
    for (int i=0; i < 10; i++) {
      if (g1.cache(null).localSize() == 0 && g2.cache(null).localSize() == 0)       break;
      U.sleep(500);
    }
    assertEquals(0,g1.cache(null).localSize());
    assertEquals(g2.configuration().getMarshaller() instanceof BinaryMarshaller ? 1 : 0,g2.cache(null).localSize());
    startGrid(3);
  }
  finally {
    stopAllGrids();
  }
}
