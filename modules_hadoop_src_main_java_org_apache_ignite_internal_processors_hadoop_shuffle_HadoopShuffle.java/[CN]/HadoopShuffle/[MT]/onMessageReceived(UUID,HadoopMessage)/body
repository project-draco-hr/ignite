{
  if (msg instanceof HadoopShuffleMessage) {
    HadoopShuffleMessage m=(HadoopShuffleMessage)msg;
    try {
      job(m.jobId()).onShuffleMessage(m);
    }
 catch (    IgniteCheckedException e) {
      U.error(log,"Message handling failed.",e);
    }
    try {
      send0(src,new HadoopShuffleAck(m.id(),m.jobId()));
    }
 catch (    IgniteCheckedException e) {
      U.error(log,"Failed to reply back to shuffle message sender [snd=" + src + ", msg="+ msg+ ']',e);
    }
  }
 else   if (msg instanceof HadoopShuffleAck) {
    HadoopShuffleAck m=(HadoopShuffleAck)msg;
    try {
      job(m.jobId()).onShuffleAck(m);
    }
 catch (    IgniteCheckedException e) {
      U.error(log,"Message handling failed.",e);
    }
  }
 else   throw new IllegalStateException("Unknown message type received to Hadoop shuffle [src=" + src + ", msg="+ msg+ ']');
  return true;
}
