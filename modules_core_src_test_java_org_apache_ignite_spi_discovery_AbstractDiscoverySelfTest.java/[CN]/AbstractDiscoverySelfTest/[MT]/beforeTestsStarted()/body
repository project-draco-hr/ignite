{
  try {
    for (int i=0; i < getSpiCount(); i++) {
      DiscoverySpi spi=getSpi(i);
      IgniteTestResources rsrcMgr=new IgniteTestResources(getMBeanServer(i));
      rsrcMgr.inject(spi);
      spi.setNodeAttributes(Collections.<String,Object>singletonMap(TEST_ATTRIBUTE_NAME,"true"),fromString("99.99.99"));
      spi.setListener(new DiscoverySpiListener(){
        @SuppressWarnings({"NakedNotify"}) @Override public void onDiscovery(        int type,        long topVer,        ClusterNode node,        Collection<ClusterNode> topSnapshot,        Map<Long,Collection<ClusterNode>> topHist,        Serializable data){
          info("Discovery event [type=" + type + ", node="+ node+ ']');
synchronized (mux) {
            mux.notifyAll();
          }
        }
      }
);
      spi.setDataExchange(new DiscoverySpiDataExchange(){
        @Override public Map<Integer,byte[]> collect(        UUID nodeId){
          return new HashMap<>();
        }
        @Override public void onExchange(        UUID joiningNodeId,        UUID nodeId,        Map<Integer,byte[]> data,        ClassLoader clsLdr){
        }
      }
);
      spi.spiStart(getTestGridName() + i);
      spis.add(spi);
      spiRsrcs.add(rsrcMgr);
      spi.onContextInitialized(initSpiContext());
    }
  }
 catch (  Throwable e) {
    e.printStackTrace();
  }
  spiStartTime=System.currentTimeMillis();
}
