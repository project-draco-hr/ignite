{
  try (FSDataOutputStream out=fs.create(file,true,bufSize,replication,fs.getDefaultBlockSize())){
    long written=0;
    byte[] data=new byte[bufSize];
    while (written < len) {
      int chunk=(int)Math.min(len - written,bufSize);
      out.write(data,0,chunk);
      written+=chunk;
      if (progress != null)       progress.addAndGet(chunk);
    }
    out.flush();
  }
 catch (  Exception e) {
    e.printStackTrace();
    throw e;
  }
}
