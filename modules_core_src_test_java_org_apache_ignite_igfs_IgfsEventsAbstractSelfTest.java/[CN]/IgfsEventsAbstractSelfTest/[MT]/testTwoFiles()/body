{
  final List<Event> evtList=new ArrayList<>();
  final int evtsCnt=4 + 3 + 2+ 2;
  final CountDownLatch latch=new CountDownLatch(evtsCnt);
  grid(1).events().localListen(lsnr=new IgnitePredicate<Event>(){
    @Override public boolean apply(    Event evt){
      log.info("Received event [evt=" + evt + ']');
      evtList.add(evt);
      latch.countDown();
      return true;
    }
  }
,EVTS_IGFS);
  IgfsPath dir=new IgfsPath("/dir1");
  IgfsPath file1=new IgfsPath(dir,"file1");
  igfs.create(file1,true).close();
  IgfsPath file2=new IgfsPath(dir,"file2");
  igfs.create(file2,true).close();
  assertTrue(igfs.exists(dir));
  assertTrue(igfs.exists(file1));
  assertTrue(igfs.exists(file2));
  assertTrue(igfs.delete(file1,false));
  assertTrue(igfs.delete(file2,false));
  assertTrue(latch.await(10,TimeUnit.SECONDS));
  assertEquals(evtsCnt,evtList.size());
  IgfsEvent evt=(IgfsEvent)evtList.get(0);
  assertEquals(EVT_IGFS_DIR_CREATED,evt.type());
  assertEquals(new IgfsPath("/dir1"),evt.path());
  assertTrue(evt.isDirectory());
  evt=(IgfsEvent)evtList.get(1);
  assertEquals(EVT_IGFS_FILE_CREATED,evt.type());
  assertEquals(new IgfsPath("/dir1/file1"),evt.path());
  evt=(IgfsEvent)evtList.get(2);
  assertEquals(EVT_IGFS_FILE_OPENED_WRITE,evt.type());
  assertEquals(new IgfsPath("/dir1/file1"),evt.path());
  evt=(IgfsEvent)evtList.get(3);
  assertEquals(EVT_IGFS_FILE_CLOSED_WRITE,evt.type());
  assertEquals(new IgfsPath("/dir1/file1"),evt.path());
  assertEquals(0,evt.dataSize());
  evt=(IgfsEvent)evtList.get(4);
  assertEquals(EVT_IGFS_FILE_CREATED,evt.type());
  assertEquals(new IgfsPath("/dir1/file2"),evt.path());
  evt=(IgfsEvent)evtList.get(5);
  assertEquals(EVT_IGFS_FILE_OPENED_WRITE,evt.type());
  assertEquals(new IgfsPath("/dir1/file2"),evt.path());
  evt=(IgfsEvent)evtList.get(6);
  assertEquals(EVT_IGFS_FILE_CLOSED_WRITE,evt.type());
  assertEquals(new IgfsPath("/dir1/file2"),evt.path());
  assertEquals(0,evt.dataSize());
  assertOneToOne(evtList.subList(7,11),new EventPredicate(EVT_IGFS_FILE_DELETED,new IgfsPath("/dir1/file1")),new EventPredicate(EVT_IGFS_FILE_PURGED,new IgfsPath("/dir1/file1")),new EventPredicate(EVT_IGFS_FILE_DELETED,new IgfsPath("/dir1/file2")),new EventPredicate(EVT_IGFS_FILE_PURGED,new IgfsPath("/dir1/file2")));
}
