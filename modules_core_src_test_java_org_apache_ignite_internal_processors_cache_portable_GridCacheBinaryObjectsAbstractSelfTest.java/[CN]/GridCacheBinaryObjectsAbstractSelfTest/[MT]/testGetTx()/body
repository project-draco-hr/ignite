{
  if (atomicityMode() != TRANSACTIONAL)   return;
  IgniteCache<Integer,TestObject> c=jcache(0);
  for (int i=0; i < ENTRY_CNT; i++)   c.put(i,new TestObject(i));
  for (int i=0; i < ENTRY_CNT; i++) {
    try (Transaction tx=grid(0).transactions().txStart(PESSIMISTIC,REPEATABLE_READ)){
      TestObject obj=c.get(i);
      assertEquals(i,obj.val);
      tx.commit();
    }
   }
  for (int i=0; i < ENTRY_CNT; i++) {
    try (Transaction tx=grid(0).transactions().txStart(PESSIMISTIC,READ_COMMITTED)){
      TestObject obj=c.get(i);
      assertEquals(i,obj.val);
      tx.commit();
    }
   }
  IgniteCache<Integer,BinaryObject> kpc=keepPortableCache();
  for (int i=0; i < ENTRY_CNT; i++) {
    try (Transaction tx=grid(0).transactions().txStart(PESSIMISTIC,REPEATABLE_READ)){
      BinaryObject po=kpc.get(i);
      assertEquals(i,(int)po.field("val"));
      tx.commit();
    }
   }
  for (int i=0; i < ENTRY_CNT; i++) {
    try (Transaction tx=grid(0).transactions().txStart(PESSIMISTIC,READ_COMMITTED)){
      BinaryObject po=kpc.get(i);
      assertEquals(i,(int)po.field("val"));
      tx.commit();
    }
   }
}
