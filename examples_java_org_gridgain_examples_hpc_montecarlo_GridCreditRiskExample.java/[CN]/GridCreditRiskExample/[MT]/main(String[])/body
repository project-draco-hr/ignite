{
  try (Grid g=GridGain.start("examples/config/example-default.xml")){
    GridCredit[] portfolio=new GridCredit[5000];
    Random rnd=new Random();
    for (int i=0; i < portfolio.length; i++) {
      portfolio[i]=new GridCredit(50000 * rnd.nextDouble(),rnd.nextInt(1000),rnd.nextDouble() / 10,rnd.nextDouble() / 20 + 0.02);
    }
    int horizon=365;
    int iter=10000;
    double percentile=0.95;
    long start=System.currentTimeMillis();
    double crdRisk=g.compute().reduce(SPREAD,closures(g.nodes().size(),portfolio,horizon,iter,percentile),new GridReducer<Double,Double>(){
      /** 
 * Collected values sum. 
 */
      private double sum;
      /** 
 * Collected values count. 
 */
      private int cnt;
      /** 
 * {@inheritDoc} 
 */
      @Override public synchronized boolean collect(      Double e){
        sum+=e;
        cnt++;
        return true;
      }
      /** 
 * {@inheritDoc} 
 */
      @Override public synchronized Double apply(){
        return sum / cnt;
      }
    }
).get();
    System.out.println("Credit risk [crdRisk=" + crdRisk + ", duration="+ (System.currentTimeMillis() - start)+ "ms]");
  }
 }
