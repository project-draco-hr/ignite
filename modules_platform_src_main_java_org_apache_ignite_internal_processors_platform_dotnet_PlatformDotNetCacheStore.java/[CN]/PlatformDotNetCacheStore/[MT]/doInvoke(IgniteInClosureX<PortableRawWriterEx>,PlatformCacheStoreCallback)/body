{
  try (PlatformMemory mem=platformCtx.memory().allocate()){
    PlatformOutputStream out=mem.output();
    PortableRawWriterEx writer=platformCtx.writer(out);
    task.apply(writer);
    out.synchronize();
    return platformCtx.gateway().cacheStoreInvoke(ptr,mem.pointer(),cb);
  }
 }
