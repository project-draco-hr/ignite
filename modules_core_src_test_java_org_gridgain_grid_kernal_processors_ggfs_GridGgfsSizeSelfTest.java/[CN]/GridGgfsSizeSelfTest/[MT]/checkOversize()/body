{
  ggfsMaxData=BLOCK_SIZE;
  startUp();
  final GridGgfsPath path=new GridGgfsPath("/file");
  GridGgfsOutputStream os=ggfs(0).create(path,false);
  os.write(chunk(BLOCK_SIZE - 1));
  os.close();
  os=ggfs(0).append(path,false);
  os.write(chunk(1));
  os.close();
  GridTestUtils.assertThrows(log(),new Callable<Object>(){
    @Override public Object call() throws Exception {
      GridGgfsOutputStream osErr=ggfs(0).append(path,false);
      try {
        osErr.write(chunk(BLOCK_SIZE));
        osErr.close();
        return null;
      }
 catch (      IOException e) {
        Throwable e0=e;
        while (e0.getCause() != null)         e0=e0.getCause();
        throw (Exception)e0;
      }
 finally {
        U.closeQuiet(osErr);
      }
    }
  }
,GridGgfsOutOfSpaceException.class,"Failed to write data block (GGFS maximum data size exceeded) [used=" + ggfsMaxData + ", allowed="+ ggfsMaxData+ ']');
}
