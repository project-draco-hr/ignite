{
  ClassPathXmlApplicationContext ctx=new ClassPathXmlApplicationContext("org/apache/ignite/loadtests/capacity/spring-capacity-cache.xml");
  IgniteConfiguration cfg=(IgniteConfiguration)ctx.getBean("grid.cfg");
  try (Ignite g=G.start(cfg)){
    Cache<Integer,Integer> c=g.cache(null);
    long init=mem.getHeapMemoryUsage().getUsed();
    printHeap(init);
    int cnt=0;
    for (; cnt < 3000000; cnt++) {
      c.put(cnt,cnt);
      if (cnt % 10000 == 0) {
        X.println("Stored count: " + cnt);
        printHeap(init);
        if (cnt > 2100000 && cnt % 100000 == 0)         System.gc();
      }
    }
    System.gc();
    Thread.sleep(1000);
    printHeap(init);
    MemoryUsage heap=mem.getHeapMemoryUsage();
    long used=heap.getUsed() - init;
    long entrySize=cnt > 0 ? used / cnt : 0;
    X.println("Average entry size: " + entrySize);
  }
 }
