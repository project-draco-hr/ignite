{
  Ignite g=startGrid(0);
  try {
    IgniteCache<Object,Object> cache=g.jcache(null);
    for (int i=0; i < 10; i++)     cache.put(i,i);
    for (int i=0; i < 10; i++) {
      GridCacheEntryEx<Object,Object> entry=((IgniteKernal)g).context().cache().internalCache().peekEx(i);
      if (entry != null)       assertFalse("Entry is locked after implicit transaction commit: " + entry,entry.lockedByAny());
    }
    assertFalse(cache.toString().isEmpty());
    assertFalse(cache.iterator().toString().isEmpty());
    try (IgniteTx tx=g.transactions().txStart(PESSIMISTIC,REPEATABLE_READ)){
      assertEquals(1,cache.get(1));
      cache.put(2,22);
      assertFalse(tx.toString().isEmpty());
      assertFalse(cache.toString().isEmpty());
      tx.commit();
    }
   }
  finally {
    stopAllGrids();
  }
}
