{
  Ignite g=startGrid(0);
  try {
    GridCache<Object,Object> cache=g.cache(null);
    for (int i=0; i < 10; i++)     cache.put(i,i);
    for (int i=0; i < 10; i++) {
      GridCacheEntryEx<Object,Object> entry=((GridKernal)g).context().cache().internalCache().peekEx(i);
      if (entry != null)       assertFalse("Entry is locked after implicit transaction commit: " + entry,entry.lockedByAny());
    }
    Set<CacheEntry<Object,Object>> entries=cache.entrySet();
    assertNotNull(entries);
    assertFalse(entries.toString().isEmpty());
    try (IgniteTx tx=cache.txStart(PESSIMISTIC,REPEATABLE_READ)){
      assertEquals(1,cache.get(1));
      cache.put(2,22);
      assertFalse(tx.toString().isEmpty());
      entries=cache.entrySet();
      assertNotNull(entries);
      assertFalse(entries.toString().isEmpty());
      tx.commit();
    }
   }
  finally {
    stopAllGrids();
  }
}
