{
  TimerTask task=new TimerTask(){
    @Override public void run(){
      final IgniteStreamer streamer=g.streamer("popular-numbers");
      try {
        Collection<StreamerIndexEntry<Integer,Integer,Long>> col=streamer.context().reduce(new IgniteClosure<StreamerContext,Collection<StreamerIndexEntry<Integer,Integer,Long>>>(){
          @Override public Collection<StreamerIndexEntry<Integer,Integer,Long>> apply(          StreamerContext ctx){
            StreamerIndex<Integer,Integer,Long> view=ctx.<Integer>window().index();
            return view.entries(-1 * POPULAR_NUMBERS_CNT);
          }
        }
,new PopularNumbersReducer());
        for (        StreamerIndexEntry<Integer,Integer,Long> cntr : col)         System.out.printf("%3d=%d\n",cntr.key(),cntr.value());
        System.out.println("----------------");
      }
 catch (      GridException e) {
        e.printStackTrace();
      }
    }
  }
;
  timer.schedule(task,3000,3000);
  return task;
}
