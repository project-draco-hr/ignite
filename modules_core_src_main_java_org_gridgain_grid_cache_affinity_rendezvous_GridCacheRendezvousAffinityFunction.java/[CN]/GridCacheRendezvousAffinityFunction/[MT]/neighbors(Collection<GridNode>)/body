{
  Map<String,Collection<GridNode>> macMap=new HashMap<>(topSnapshot.size(),1.0f);
  for (  GridNode node : topSnapshot) {
    String macs=node.attribute(GridNodeAttributes.ATTR_MACS);
    Collection<GridNode> nodes=macMap.get(macs);
    if (nodes == null) {
      nodes=new HashSet<>();
      macMap.put(macs,nodes);
    }
    nodes.add(node);
  }
  Map<UUID,Collection<GridNode>> neighbors=new HashMap<>(topSnapshot.size(),1.0f);
  for (  Collection<GridNode> group : macMap.values()) {
    for (    GridNode node : group)     neighbors.put(node.id(),group);
  }
  return neighbors;
}
