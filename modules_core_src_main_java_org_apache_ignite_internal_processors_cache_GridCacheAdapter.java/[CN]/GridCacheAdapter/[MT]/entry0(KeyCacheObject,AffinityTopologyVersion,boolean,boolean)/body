{
  GridCacheMapEntry cur=map.getEntry(key);
  if (cur == null || cur.obsolete()) {
    GridTriple<GridCacheMapEntry> t=map.putEntryIfObsoleteOrAbsent(topVer,key,null,create);
    cur=t.get1();
    GridCacheEntryEx created=t.get2();
    GridCacheEntryEx doomed=t.get3();
    if (doomed != null && ctx.events().isRecordable(EVT_CACHE_ENTRY_DESTROYED))     ctx.events().addEvent(doomed.partition(),doomed.key(),locNodeId,(IgniteUuid)null,null,EVT_CACHE_ENTRY_DESTROYED,null,false,null,false,null,null,null,true);
    if (created != null) {
      if (ctx.events().isRecordable(EVT_CACHE_ENTRY_CREATED))       ctx.events().addEvent(created.partition(),created.key(),locNodeId,(IgniteUuid)null,null,EVT_CACHE_ENTRY_CREATED,null,false,null,false,null,null,null,true);
      if (touch)       ctx.evicts().touch(cur,topVer);
    }
  }
  return cur;
}
