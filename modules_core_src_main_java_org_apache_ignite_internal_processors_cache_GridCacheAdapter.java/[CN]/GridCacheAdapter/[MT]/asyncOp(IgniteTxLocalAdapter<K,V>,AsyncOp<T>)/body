{
  IgniteFuture<T> fail=asyncOpAcquire();
  if (fail != null)   return fail;
  FutureHolder holder=lastFut.get();
  holder.lock();
  try {
    IgniteFuture fut=holder.future();
    if (fut != null && !fut.isDone()) {
      final IgniteTxLocalAdapter<K,V> tx0=tx;
      IgniteFuture<T> f=new GridEmbeddedFuture<>(fut,new C2<T,Exception,IgniteFuture<T>>(){
        @Override public IgniteFuture<T> apply(        T t,        Exception e){
          return op.op(tx0);
        }
      }
,ctx.kernalContext());
      saveFuture(holder,f);
      return f;
    }
    IgniteFuture<T> f=op.op(tx);
    saveFuture(holder,f);
    if (tx.implicit())     ctx.tm().txContextReset();
    return f;
  }
  finally {
    holder.unlock();
  }
}
