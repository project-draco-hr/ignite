{
  assertEmpty(mgr.directoryListing(ROOT_ID));
  GridGgfsFileInfo dir=new GridGgfsFileInfo(true,null);
  GridGgfsFileInfo file=new GridGgfsFileInfo(new GridGgfsFileInfo(400,null,false,null),1);
  assertNull(mgr.putIfAbsent(ROOT_ID,"dir",dir));
  assertNull(mgr.putIfAbsent(ROOT_ID,"file",file));
  assertEquals(F.asMap("dir",new GridGgfsListingEntry(dir),"file",new GridGgfsListingEntry(file)),mgr.directoryListing(ROOT_ID));
  assertEquals(dir,mgr.info(dir.id()));
  assertEquals(file,mgr.info(file.id()));
  for (  IgniteBiTuple<IgniteUuid,String> tup : Arrays.asList(F.t(dir.id(),"dir"),F.t(file.id(),"file"))) {
    IgniteUuid fileId=tup.get1();
    String fileName=tup.get2();
    for (    Map<String,String> props : Arrays.asList(null,Collections.<String,String>emptyMap()))     expectsUpdatePropertiesFail(fileId,props,AssertionError.class,"Expects not-empty file's properties");
    String key1=UUID.randomUUID().toString();
    String key2=UUID.randomUUID().toString();
    GridGgfsFileInfo info=mgr.info(fileId);
    assertNull("Expects empty properties are not stored: " + info,getFieldValue(info,"props"));
    assertEquals("Expects empty properties are not stored: " + info,Collections.emptyMap(),info.properties());
    info=mgr.updateProperties(ROOT_ID,fileId,fileName,F.asMap(key1,"1"));
    assertEquals("Unexpected stored properties: " + info,F.asMap(key1,"1"),info.properties());
    info=mgr.updateProperties(ROOT_ID,fileId,fileName,F.asMap(key2,"2"));
    assertEquals("Unexpected stored properties: " + info,F.asMap(key1,"1",key2,"2"),info.properties());
    info=mgr.updateProperties(ROOT_ID,fileId,fileName,F.<String,String>asMap(key1,null));
    assertEquals("Unexpected stored properties: " + info,F.asMap(key2,"2"),info.properties());
    info=mgr.updateProperties(ROOT_ID,fileId,fileName,F.<String,String>asMap(key2,null));
    assertNull("Expects empty properties are not stored: " + info,getFieldValue(info,"props"));
    assertEquals("Expects empty properties are not stored: " + info,Collections.emptyMap(),info.properties());
    assertNull(mgr.updateProperties(ROOT_ID,fileId,"not_exists",F.<String,String>asMap(key2,null)));
  }
  mgr.removeIfEmpty(ROOT_ID,"dir",dir.id(),new GridGgfsPath("/dir"),true);
  mgr.removeIfEmpty(ROOT_ID,"file",file.id(),new GridGgfsPath("/file"),true);
  assertNull(mgr.updateProperties(ROOT_ID,dir.id(),"dir",F.asMap("p","7")));
  assertNull(mgr.updateProperties(ROOT_ID,file.id(),"file",F.asMap("q","8")));
}
