{
  int partCnt=GridCacheConsistentHashAffinityFunction.DFLT_PARTITION_COUNT;
  GridCacheAffinityFunction aff=grid(0).configuration().getCacheConfiguration()[0].getAffinity();
  GridCache<Object,Object> cache=grid(0).cache(null);
  for (int i=0; i < partCnt; i++) {
    assertEquals(i,aff.partition(i));
    Collection<GridNode> nodes=cache.affinity().mapKeyToPrimaryAndBackups(i);
    assertEquals(2,nodes.size());
    GridNode primary=F.first(nodes);
    GridNode backup=F.last(nodes);
    assertFalse(F.eq(primary.attribute(SPLIT_ATTRIBUTE_NAME),backup.attribute(SPLIT_ATTRIBUTE_NAME)));
  }
}
