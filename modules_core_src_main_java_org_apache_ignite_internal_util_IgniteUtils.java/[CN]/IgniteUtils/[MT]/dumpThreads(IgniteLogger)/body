{
  ThreadMXBean mxBean=ManagementFactory.getThreadMXBean();
  final Set<Long> deadlockedThreadsIds=getDeadlockedThreadIds(mxBean);
  if (deadlockedThreadsIds.size() == 0)   warn(log,"No deadlocked threads detected.");
 else   warn(log,"Deadlocked threads detected (see thread dump below) " + "[deadlockedThreadsCnt=" + deadlockedThreadsIds.size() + ']');
  ThreadInfo[] threadInfos=mxBean.dumpAllThreads(mxBean.isObjectMonitorUsageSupported(),mxBean.isSynchronizerUsageSupported());
  GridStringBuilder sb=new GridStringBuilder("Thread dump at ").a(new SimpleDateFormat("yyyy/MM/dd HH:mm:ss z").format(new Date(U.currentTimeMillis()))).a(NL);
  for (  ThreadInfo info : threadInfos) {
    printThreadInfo(info,sb,deadlockedThreadsIds);
    sb.a(NL);
    if (info.getLockedSynchronizers() != null && info.getLockedSynchronizers().length > 0) {
      printSynchronizersInfo(info.getLockedSynchronizers(),sb);
      sb.a(NL);
    }
  }
  sb.a(NL);
  warn(log,sb.toString());
}
