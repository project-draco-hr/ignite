{
  localSpi.set(this);
  try {
    Connection conn=connectionForThread(schema(spaceName));
    setFilters(filters != null ? filters : EMPTY_FILTER);
    T2<PreparedStatement,ResultSet> res=executeSqlQueryWithTimer(conn,qry,params);
    if (res == null)     return new GridIndexingFieldsResultAdapter(null,new GridEmptyCloseableIterator<List<GridIndexingEntity<?>>>());
    ResultSet rs=res.get2();
    List<GridIndexingFieldMetadata> meta;
    try {
      ResultSetMetaData rsMeta=rs.getMetaData();
      meta=new ArrayList<>(rsMeta.getColumnCount());
      for (int i=1; i <= rsMeta.getColumnCount(); i++) {
        String schemaName=rsMeta.getSchemaName(i);
        String typeName=rsMeta.getTableName(i);
        String name=rsMeta.getColumnLabel(i);
        String type=rsMeta.getColumnClassName(i);
        meta.add(new SqlFieldMetadata(schemaName,typeName,name,type));
      }
    }
 catch (    SQLException e) {
      throw new GridSpiException("Failed to get meta data.",e);
    }
    return new GridIndexingFieldsResultAdapter(meta,new FieldsIterator(rs,res.get1()));
  }
 catch (  SQLException e) {
    onSqlException();
    throw new GridSpiException("Failed to query fields: " + qry,e);
  }
 finally {
    setFilters(null);
    localSpi.remove();
  }
}
