{
  if (!validateTypeDescriptor(spaceName,type))   return false;
  for (  TableDescriptor table : tables(schema(spaceName)))   if (table.type().valueClass().getClass().getName().equals(type.valueClass().getName()))   throw new GridSpiException("Failed to register type in query index because" + " class is already registered (most likely that class with the same name" + " was not properly undeployed): "+ type);
  TableDescriptor tbl=new TableDescriptor(spaceName,type);
  Statement stmt=null;
  try {
    Connection conn=connectionForThread(null);
    stmt=conn.createStatement();
    Schema schema=schemas.get(tbl.schema());
    if (schema == null) {
      schema=new Schema(spaceName);
      Schema existing=schemas.putIfAbsent(tbl.schema(),schema);
      if (existing != null)       schema=existing;
    }
    createTable(schema,tbl,conn);
    schema.put(tbl.name(),tbl);
  }
 catch (  SQLException e) {
    onSqlException();
    throw new GridSpiException("Failed to register query type: " + type,e);
  }
 finally {
    U.close(stmt,log);
  }
  return true;
}
