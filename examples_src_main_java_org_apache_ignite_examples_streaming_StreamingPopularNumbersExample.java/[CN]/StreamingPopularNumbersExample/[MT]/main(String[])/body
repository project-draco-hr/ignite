{
  Ignition.setClientMode(true);
  try (Ignite ignite=Ignition.start("examples/config/example-ignite.xml")){
    System.out.println();
    System.out.println(">>> Cache popular numbers example started.");
    CacheConfiguration<Integer,Long> cfg=new CacheConfiguration<>();
    cfg.setCacheMode(CacheMode.PARTITIONED);
    cfg.setName(STREAM_NAME);
    cfg.setIndexedTypes(Integer.class,Long.class);
    cfg.setExpiryPolicyFactory(FactoryBuilder.factoryOf(new CreatedExpiryPolicy(new Duration(SECONDS,1))));
    try (IgniteCache<Integer,Long> stmCache=ignite.createCache(cfg)){
      if (ignite.cluster().forDataNodes(STREAM_NAME).nodes().isEmpty()) {
        System.err.println("Data nodes not found (start data nodes with ExampleNodeStartup class)");
        return;
      }
      ExecutorService exe=startStreaming(ignite);
      long start=System.currentTimeMillis();
      while (System.currentTimeMillis() - start < DURATION) {
        SqlFieldsQuery top10=new SqlFieldsQuery("select _key, _val from Long order by _val desc limit 10");
        List<List<?>> results=stmCache.queryFields(top10).getAll();
        for (        List<?> res : results)         System.out.println(res.get(0) + "=" + res.get(1));
        System.out.println("----------------");
        Thread.sleep(5000);
      }
      finished=true;
      exe.shutdown();
    }
 catch (    CacheException e) {
      e.printStackTrace();
      System.out.println("Destroying cache for name '" + STREAM_NAME + "'. Please try again.");
      ignite.destroyCache(STREAM_NAME);
    }
  }
 }
