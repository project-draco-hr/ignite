{
  try {
    boolean cancelled=false;
    while (!cancelled) {
      try {
        GridGgfsFileWorkerTask task=queue.poll(1000,TimeUnit.MILLISECONDS);
        if (task == null)         continue;
        task.execute();
        if (lastTask)         cancelled=true;
      }
 catch (      GridException e) {
        err=e;
        cancelled=true;
      }
catch (      InterruptedException ignore) {
        Thread.currentThread().interrupt();
        cancelled=true;
      }
    }
  }
  finally {
    try {
      onComplete();
    }
  finally {
      U.closeQuiet(writer);
      completeLatch.countDown();
    }
  }
}
